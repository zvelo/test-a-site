!function(){/**
 * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */
var t,e,n;!function(r){function i(t,e){return b.call(t,e)}function o(t,e){var n,r,i,o,s,a,u,l,h,c,p,f=e&&e.split("/"),d=m.map,g=d&&d["*"]||{};if(t&&"."===t.charAt(0))if(e){for(f=f.slice(0,f.length-1),t=t.split("/"),s=t.length-1,m.nodeIdCompat&&E.test(t[s])&&(t[s]=t[s].replace(E,"")),t=f.concat(t),h=0;h<t.length;h+=1)if(p=t[h],"."===p)t.splice(h,1),h-=1;else if(".."===p){if(1===h&&(".."===t[2]||".."===t[0]))break;h>0&&(t.splice(h-1,2),h-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((f||g)&&d){for(n=t.split("/"),h=n.length;h>0;h-=1){if(r=n.slice(0,h).join("/"),f)for(c=f.length;c>0;c-=1)if(i=d[f.slice(0,c).join("/")],i&&(i=i[r])){o=i,a=h;break}if(o)break;!u&&g&&g[r]&&(u=g[r],l=h)}!o&&u&&(o=u,a=l),o&&(n.splice(0,a,o),t=n.join("/"))}return t}function s(t,e){return function(){var n=w.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),f.apply(r,n.concat([t,e]))}}function a(t){return function(e){return o(e,t)}}function u(t){return function(e){y[t]=e}}function l(t){if(i(v,t)){var e=v[t];delete v[t],_[t]=!0,p.apply(r,e)}if(!i(y,t)&&!i(_,t))throw new Error("No "+t);return y[t]}function h(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function c(t){return function(){return m&&m.config&&m.config[t]||{}}}var p,f,d,g,y={},v={},m={},_={},b=Object.prototype.hasOwnProperty,w=[].slice,E=/\.js$/;d=function(t,e){var n,r=h(t),i=r[0];return t=r[1],i&&(i=o(i,e),n=l(i)),i?t=n&&n.normalize?n.normalize(t,a(e)):o(t,e):(t=o(t,e),r=h(t),i=r[0],t=r[1],i&&(n=l(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:n}},g={require:function(t){return s(t)},exports:function(t){var e=y[t];return"undefined"!=typeof e?e:y[t]={}},module:function(t){return{id:t,uri:"",exports:y[t],config:c(t)}}},p=function(t,e,n,o){var a,h,c,p,f,m,b=[],w=typeof n;if(o=o||t,"undefined"===w||"function"===w){for(e=!e.length&&n.length?["require","exports","module"]:e,f=0;f<e.length;f+=1)if(p=d(e[f],o),h=p.f,"require"===h)b[f]=g.require(t);else if("exports"===h)b[f]=g.exports(t),m=!0;else if("module"===h)a=b[f]=g.module(t);else if(i(y,h)||i(v,h)||i(_,h))b[f]=l(h);else{if(!p.p)throw new Error(t+" missing "+h);p.p.load(p.n,s(o,!0),u(h),{}),b[f]=y[h]}c=n?n.apply(y[t],b):void 0,t&&(a&&a.exports!==r&&a.exports!==y[t]?y[t]=a.exports:c===r&&m||(y[t]=c))}else t&&(y[t]=n)},t=e=f=function(t,e,n,i,o){if("string"==typeof t)return g[t]?g[t](e):l(d(t,e).f);if(!t.splice){if(m=t,m.deps&&f(m.deps,m.callback),!e)return;e.splice?(t=e,e=n,n=null):t=r}return e=e||function(){},"function"==typeof n&&(n=i,i=o),i?p(r,t,e,n):setTimeout(function(){p(r,t,e,n)},4),f},f.config=function(t){return f(t)},t._defined=y,n=function(t,e,n){e.splice||(n=e,e=[]),i(y,t)||i(v,t)||(v[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("poly/lib/_base",["require","exports","module"],function(t,e){var n;n={}.toString,e.isFunction=function(t){return"function"==typeof t},e.isString=function(t){return"[object String]"==n.call(t)},e.toString=function(t){return n.apply(t)},e.createCaster=function(t,e){return function(n){if(null==n)throw new TypeError(e+" method called on null or undefined");return t(n)}}}),n("poly/function",["./lib/_base"],function(t){function e(e){var n=r[e];return t.isFunction(o[n])}var n,r,i=[].slice,o=Function.prototype;return r={"function-bind":"bind"},e("function-bind")||(n=function(t){var e=i.call(arguments,1),n=this,r=function(){},o=function(){return n.apply(this instanceof r?this:t||{},e.concat(i.call(arguments)))};return r.prototype=this.prototype||{},o.prototype=new r,o},o.bind=n),{}}),function(){function t(t){var e,n,r,s='{"A":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}',u="json"==t;if(u||"json-stringify"==t||"json-parse"==t){if("json-stringify"==t||u){if(e="function"==typeof a.stringify&&T){(r=function(){return 1}).toJSON=r;try{e="0"===a.stringify(0)&&"0"===a.stringify(new Number)&&'""'==a.stringify(new String)&&a.stringify(o)===i&&a.stringify(i)===i&&a.stringify()===i&&"1"===a.stringify(r)&&"[1]"==a.stringify([r])&&"[null]"==a.stringify([i])&&"null"==a.stringify(null)&&"[null,null,null]"==a.stringify([i,o,null])&&a.stringify({A:[r,!0,!1,null,"\x00\b\n\f\r	"]})==s&&"1"===a.stringify(null,r)&&"[\n 1,\n 2\n]"==a.stringify([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==a.stringify(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==a.stringify(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==a.stringify(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==a.stringify(new Date(-1))}catch(l){e=!1}}if(!u)return e}if("json-parse"==t||u){if("function"==typeof a.parse)try{if(0===a.parse("0")&&!a.parse(!1)&&(r=a.parse(s),n=5==r.A.length&&1==r.A[0])){try{n=!a.parse('"	"')}catch(l){}if(n)try{n=1!=a.parse("01")}catch(l){}}}catch(l){n=!1}if(!u)return n}return e&&n}}var e,r,i,o={}.toString,s="function"==typeof n&&n.amd,a=!s&&"object"==typeof exports&&exports;a||s?"object"==typeof JSON&&JSON?s?a=JSON:(a.stringify=JSON.stringify,a.parse=JSON.parse):s&&(a=this.JSON={}):a=this.JSON||(this.JSON={});var u,l,h,c,p,f,d,g,y,v,m,_,b,w,E,x,T=new Date(-0xc782b5b800cec);try{T=-109252==T.getUTCFullYear()&&0===T.getUTCMonth()&&1==T.getUTCDate()&&10==T.getUTCHours()&&37==T.getUTCMinutes()&&6==T.getUTCSeconds()&&708==T.getUTCMilliseconds()}catch(k){}t("json")||(T||(w=Math.floor,E=[0,31,59,90,120,151,181,212,243,273,304,334],x=function(t,e){return E[e]+365*(t-1970)+w((t-1969+(e=+(e>1)))/4)-w((t-1901+e)/100)+w((t-1601+e)/400)}),(e={}.hasOwnProperty)||(e=function(t){var n,r={};return(r.__proto__=null,r.__proto__={toString:1},r).toString!=o?e=function(t){var e=this.__proto__,n=t in(this.__proto__=null,this);return this.__proto__=e,n}:(n=r.constructor,e=function(t){var e=(this.constructor||n).prototype;return t in this&&!(t in e&&this[t]===e[t])}),r=null,e.call(this,t)}),r=function(t,n){var r,i,s,a,u=0;(r=function(){this.valueOf=0}).prototype.valueOf=0,i=new r;for(s in i)e.call(i,s)&&u++;return r=i=null,u?a=2==u?function(t,n){var r,i={},s="[object Function]"==o.call(t);for(r in t)s&&"prototype"==r||e.call(i,r)||!(i[r]=1)||!e.call(t,r)||n(r)}:function(t,n){var r,i,s="[object Function]"==o.call(t);for(r in t)s&&"prototype"==r||!e.call(t,r)||(i="constructor"===r)||n(r);(i||e.call(t,r="constructor"))&&n(r)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],a=function(t,n){var r,s,a="[object Function]"==o.call(t);for(r in t)a&&"prototype"==r||!e.call(t,r)||n(r);for(s=i.length;r=i[--s];e.call(t,r)&&n(r));}),a(t,n)},t("json-stringify")||(u={"\\":"\\\\",'"':'\\"',"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},l=function(t,e){return("000000"+(e||0)).slice(-t)},h=function(t){for(var e,n='"',r=0;e=t.charAt(r);r++)n+='\\"\b\f\n\r	'.indexOf(e)>-1?u[e]:u[e]=" ">e?"\\u00"+l(2,e.charCodeAt(0).toString(16)):e;return n+'"'},c=function(t,n,s,a,u,p,f){var d,g,y,v,m,_,b,E,T,k,C,S,j,M,A,O,R=n[t];if("object"==typeof R&&R)if(d=o.call(R),"[object Date]"!=d||e.call(R,"toJSON"))"function"==typeof R.toJSON&&("[object Number]"!=d&&"[object String]"!=d&&"[object Array]"!=d||e.call(R,"toJSON"))&&(R=R.toJSON(t));else if(R>-1/0&&1/0>R){if(x){for(v=w(R/864e5),g=w(v/365.2425)+1970-1;x(g+1,0)<=v;g++);for(y=w((v-x(g,0))/30.42);x(g,y+1)<=v;y++);v=1+v-x(g,y),m=(R%864e5+864e5)%864e5,_=w(m/36e5)%24,b=w(m/6e4)%60,E=w(m/1e3)%60,T=m%1e3}else g=R.getUTCFullYear(),y=R.getUTCMonth(),v=R.getUTCDate(),_=R.getUTCHours(),b=R.getUTCMinutes(),E=R.getUTCSeconds(),T=R.getUTCMilliseconds();R=(0>=g||g>=1e4?(0>g?"-":"+")+l(6,0>g?-g:g):l(4,g))+"-"+l(2,y+1)+"-"+l(2,v)+"T"+l(2,_)+":"+l(2,b)+":"+l(2,E)+"."+l(3,T)+"Z"}else R=null;if(s&&(R=s.call(n,t,R)),null===R)return"null";if(d=o.call(R),"[object Boolean]"==d)return""+R;if("[object Number]"==d)return R>-1/0&&1/0>R?""+R:"null";if("[object String]"==d)return h(R);if("object"==typeof R){for(j=f.length;j--;)if(f[j]===R)throw TypeError();if(f.push(R),k=[],M=p,p+=u,"[object Array]"==d){for(S=0,j=R.length;j>S;A||(A=!0),S++)C=c(S,R,s,a,u,p,f),k.push(C===i?"null":C);O=A?u?"[\n"+p+k.join(",\n"+p)+"\n"+M+"]":"["+k.join(",")+"]":"[]"}else r(a||R,function(t){var e=c(t,R,s,a,u,p,f);e!==i&&k.push(h(t)+":"+(u?" ":"")+e),A||(A=!0)}),O=A?u?"{\n"+p+k.join(",\n"+p)+"\n"+M+"}":"{"+k.join(",")+"}":"{}";return f.pop(),O}},a.stringify=function(t,e,n){var r,i,s,a,u,l;if("function"==typeof e||"object"==typeof e&&e)if("[object Function]"==o.call(e))i=e;else if("[object Array]"==o.call(e))for(s={},a=0,u=e.length;u>a;l=e[a++],("[object String]"==o.call(l)||"[object Number]"==o.call(l))&&(s[l]=1));if(n)if("[object Number]"==o.call(n)){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else"[object String]"==o.call(n)&&(r=n.length<=10?n:n.slice(0,10));return c("",(l={},l[""]=t,l),i,s,r,"",[])}),t("json-parse")||(p=String.fromCharCode,f={"\\":"\\",'"':'"',"/":"/",b:"\b",t:"	",n:"\n",f:"\f",r:"\r"},d=function(){throw _=b=null,SyntaxError()},g=function(){for(var t,e,n,r,i,o=b,s=o.length;s>_;)if(t=o.charAt(_),"	\r\n ".indexOf(t)>-1)_++;else{if("{}[]:,".indexOf(t)>-1)return _++,t;if('"'==t){for(e="@",_++;s>_;)if(t=o.charAt(_)," ">t)d();else if("\\"==t)if(t=o.charAt(++_),'\\"/btnfr'.indexOf(t)>-1)e+=f[t],_++;else if("u"==t){for(n=++_,r=_+4;r>_;_++)t=o.charAt(_),t>="0"&&"9">=t||t>="a"&&"f">=t||t>="A"&&"F">=t||d();e+=p("0x"+o.slice(n,_))}else d();else{if('"'==t)break;e+=t,_++}if('"'==o.charAt(_))return _++,e;d()}else{if(n=_,"-"==t&&(i=!0,t=o.charAt(++_)),t>="0"&&"9">=t){for("0"==t&&(t=o.charAt(_+1),t>="0"&&"9">=t)&&d(),i=!1;s>_&&(t=o.charAt(_),t>="0"&&"9">=t);_++);if("."==o.charAt(_)){for(r=++_;s>r&&(t=o.charAt(r),t>="0"&&"9">=t);r++);r==_&&d(),_=r}if(t=o.charAt(_),"e"==t||"E"==t){for(t=o.charAt(++_),("+"==t||"-"==t)&&_++,r=_;s>r&&(t=o.charAt(r),t>="0"&&"9">=t);r++);r==_&&d(),_=r}return+o.slice(n,_)}if(i&&d(),"true"==o.slice(_,_+4))return _+=4,!0;if("false"==o.slice(_,_+5))return _+=5,!1;if("null"==o.slice(_,_+4))return _+=4,null;d()}}return"$"},y=function(t){var e,n;if("$"==t&&d(),"string"==typeof t){if("@"==t.charAt(0))return t.slice(1);if("["==t){for(e=[];t=g(),"]"!=t;n||(n=!0))n&&(","==t?(t=g(),"]"==t&&d()):d()),","==t&&d(),e.push(y(t));return e}if("{"==t){for(e={};t=g(),"}"!=t;n||(n=!0))n&&(","==t?(t=g(),"}"==t&&d()):d()),(","==t||"string"!=typeof t||"@"!=t.charAt(0)||":"!=g())&&d(),e[t.slice(1)]=y(g());return e}d()}return t},m=function(t,e,n){var r=v(t,e,n);r===i?delete t[e]:t[e]=r},v=function(t,e,n){var i,s=t[e];if("object"==typeof s&&s)if("[object Array]"==o.call(s))for(i=s.length;i--;)m(s,i,n);else r(s,function(t){m(s,t,n)});return n.call(t,e,s)},a.parse=function(t,e){var n,r;return _=0,b=t,n=y(g()),"$"!=g()&&d(),_=b=null,e&&"[object Function]"==o.call(e)?v((r={},r[""]=n,r),"",e):n})),s&&n("poly/support/json3",[],function(){return a})}.call(this),n("poly/json",["./support/json3"],function(t){return t}),n("poly/array",["./lib/_base"],function(t){function e(e){return"[object String]"==t.toString(e)?e.split(""):u(e)}function n(t){return"[object Array]"==f.call(t)}function r(e){var n=a[e];return t.isFunction(p[n])}function i(){return 1}function o(t){return t}function s(n,r,i,o,s,a){var u,l,h,p;if(u=e(n),l=u.length>>>0,s===c&&(s=0),a||(a=1),p=0>a?-1:l,!t.isFunction(r))throw new TypeError(r+" is not a function");if(s==p)return!1;if(p>=s^a>0)throw new TypeError("Invalid length or starting index");for(h=s;h!=p;h+=a)if(h in u&&!i(r.call(o,u[h],h,u),h,u[h]))return!1;return!0}var a,u,l,h,c,p=Array.prototype,f={}.toString;a={"array-foreach":"forEach","array-every":"every","array-some":"some","array-map":"map","array-filter":"filter","array-reduce":"reduce","array-reduceright":"reduceRight","array-indexof":"indexOf","array-lastindexof":"lastIndexOf"},u=t.createCaster(Object,"Array"),r("array-foreach")||(p.forEach=function(t){s(this,t,i,arguments[1])}),r("array-every")||(p.every=function(t){return s(this,t,o,arguments[1])}),r("array-some")||(p.some=function(t){return s(this,t,function(t){return!t},arguments[1])}),r("array-map")||(p.map=function(t){var e,n;return e=this,n=new Array(e.length),s(e,t,function(t,e){return n[e]=t,1},arguments[1]),n}),r("array-filter")||(p.filter=function(t){var e,n;return e=this,n=[],s(e,t,function(t,e,r){return t&&n.push(r),1},arguments[1]),n}),r("array-reduce")&&r("array-reduceright")||(l=function(t,n,r,a){var u,l,h;if(l=h=n>0?-1:e(this).length>>>0,a)u=r;else if(s(this,o,function(t,e){u=t,h=e},null,l+n,n),h==l)throw new TypeError;return s(this,function(e,n,r){u=t(u,e,n,r)},i,null,h+n,n),u},r("array-reduce")||(p.reduce=function(t){return l.call(this,t,1,arguments[1],arguments.length>1)}),r("array-reduceright")||(p.reduceRight=function(t){return l.call(this,t,-1,arguments[1],arguments.length>1)})),r("array-indexof")&&r("array-lastindexof")||(h=function(t,n,r,i){var a=e(t).length>>>0,u=-1;return r=isNaN(r)?i?0:a-1:Number(r),0>r&&(r=a+r-1),s(t,o,function(t,e){return t===n&&(u=e),-1==u},null,r,i?1:-1),u},r("array-indexof")||(p.indexOf=function(t){return h(this,t,arguments[1],!0)}),r("array-lastindexof")||(p.lastIndexOf=function(t){return h(this,t,arguments[1],!1)})),Array.isArray||(Array.isArray=n)}),n("poly/string",["./lib/_base"],function(t){function e(e){var n=o[e];return t.isFunction(u[n])}function n(){return!1}function r(t,e){return t.replace(e,"")}function i(){s("string-trim")||(u.trim=function(){return r(r(a(this),h),l)}),s("string-trimleft")||(u.trimLeft=function(){return r(a(this),h)}),s("string-trimright")||(u.trimRight=function(){return r(a(this),l)})}var o,s,a,u=String.prototype;o={"string-trim":"trim","string-trimleft":"trimLeft","string-trimright":"trimRight"},s=e,a=t.createCaster(String,"String");var l,h;return l=/\s+$/,h=/^\s+/,i(),{setWhitespaceChars:function(t){l=new RegExp(t+"$"),h=new RegExp("^"+t),s=n,i()}}}),function(t){n("poly/date",["./lib/_base"],function(e){function n(e){var n=h[e];return n in t||n in u}function r(t){return!isFinite(t)}function i(t){return(10>t?"0":"")+t}function o(t){var e;return e=p,t.replace(d,function(t,n,r,i,o,s,a,u,l,h,f){var d=0;return n>=0&&100>n&&(n=+n+400,d=-126227808e5),e=Date.UTC(n,(r||1)-1,i||1,o||0,s||0,a||0,u||0)+d,h=+(l+h),f=+(l+f),(h||f)&&(e-=36e5*(h+f/60),(h>23||-23>h||f>59)&&(e=p),e>c&&(e=p)),""}),e}function s(){var n=function(){return function(r,i,o,s,a,u,l){var h,c;return this instanceof n?(h=arguments.length,c=0===h?new t:1===h?new t(e.isString(r)?n.parse(r):r):new t(r,i,o==y?1:o,s||0,a||0,u||0,l||0),c.constructor=n,c):t.apply(this,arguments)}}();f()?Date!=t&&(Date=t):(n.now=t.now,n.UTC=t.UTC,n.prototype=u,n.prototype.constructor=n,n.parse=function(t){var e;return e=o(""+t),r(e)&&(e=l(t)),e},a(n,t),Date=n)}function a(t,e){for(var n in e)g.call(e,n)&&!g.call(t,n)&&(t[n]=e[n])}var u,l,h,c,p,f,d,g,y;return u=t.prototype,l=t.parse,g=Object.prototype.hasOwnProperty,c=864e13,p=0/0,f=function(){return t.parse("+275760-09-13T00:00:00.000Z")==c},d=/^([+\-]\d{6}|\d{4})(?:-(\d{2}))?(?:-(\d{2}))?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:.(\d{1,3}))?)?(?:Z|([+\-])(\d{2})(?::(\d{2}))?)?)?$/,h={"date-now":"now","date-tojson":"toJSON","date-toisostring":"toISOString"},n("date-now")||(t.now=function(){return+new Date}),n("date-toisostring")||(u.toISOString=function(){if(r(this))throw new RangeError("toISOString called on invalid value");return[this.getUTCFullYear(),"-",i(this.getUTCMonth()+1),"-",i(this.getUTCDate()),"T",i(this.getUTCHours()),":",i(this.getUTCMinutes()),":",i(this.getUTCSeconds()),".",(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2),"Z"].join("")}),n("date-tojson")||(u.toJSON=function(){return this.toISOString()}),s(),{setIsoCompatTest:function(t){f=t,s()}}})}(Date),/** @license MIT License (c) copyright 2011-2013 original author or authors */
function(t){t("when/when",["require"],function(t){function e(t,e,n,r){return i(t).then(e,n,r)}function n(t){return new r(t,D.PromiseStatus&&D.PromiseStatus())}function r(t,e){function n(){return h?h.inspect():C()}function r(t,e,n,r,i){function o(o){o._when(t,e,n,r,i)}c?c.push(o):S(function(){o(h)})}function i(t){if(c){var n=c;c=V,h=l(a,t),S(function(){e&&d(h,e),u(n,h)})}}function o(t){i(new p(t))}function s(t){if(c){var e=c;S(function(){u(e,new f(t))})}}var a,h,c=[];a=this,this._status=e,this.inspect=n,this._when=r;try{t(i,o,s)}catch(g){o(g)}}function i(t){return t instanceof r?t:o(t)}function o(t){return n(function(e){e(t)})}function s(t){return e(t,function(t){return new p(t)})}function a(){function t(t,n,s){e.resolve=e.resolver.resolve=function(e){return i?o(e):(i=!0,t(e),r)},e.reject=e.resolver.reject=function(t){return i?o(new p(t)):(i=!0,n(t),r)},e.notify=e.resolver.notify=function(t){return s(t),t}}var e,r,i;return e={promise:V,resolve:V,reject:V,notify:V,resolver:{resolve:V,reject:V,notify:V}},e.promise=r=n(t),e}function u(t,e){for(var n=0;n<t.length;n++)t[n](e)}function l(t,e){if(e===t)return new p(new TypeError);if(e instanceof r)return e;try{var n=e===Object(e)&&e.then;return"function"==typeof n?h(n,e):new c(e)}catch(i){return new p(i)}}function h(t,e){return n(function(n,r){S(function(){try{H(t,e,n,r)}catch(i){r(i)}})})}function c(t){this.value=t}function p(t){this.value=t}function f(t){this.value=t}function d(t,e){function n(){e.fulfilled()}function r(t){e.rejected(t)}t.then(n,r)}function g(t){return t&&"function"==typeof t.then}function y(t,r,i,o,s){return e(t,function(t){function a(n,i,o){function s(t){f(t)}function a(t){p(t)}var u,l,h,c,p,f,d,g;if(d=t.length>>>0,u=Math.max(0,Math.min(r,d)),h=[],l=d-u+1,c=[],u)for(f=function(t){c.push(t),--l||(p=f=M,i(c))},p=function(t){h.push(t),--u||(p=f=M,n(h))},g=0;d>g;++g)g in t&&e(t[g],a,s,o);else n(h)}return n(a).then(i,o,s)})}function v(t,e,n,r){function i(t){return e?e(t[0]):t[0]}return y(t,1,i,n,r)}function m(t,e,n,r){return E(t,M).then(e,n,r)}function _(){return E(arguments,M)}function b(t){return E(t,T,k)}function w(t,e){return E(t,e)}function E(t,n,i){return e(t,function(t){function o(r,o,s){function a(t,a){e(t,n,i).then(function(t){u[a]=t,--h||r(u)},o,s)}var u,l,h,c;if(h=l=t.length>>>0,u=[],!h)return void r(u);for(c=0;l>c;c++)c in t?a(t[c],c):--h}return new r(o)})}function x(t,n){var r=H(N,arguments,1);return e(t,function(t){var i;return i=t.length,r[0]=function(t,r,o){return e(t,function(t){return e(r,function(e){return n(t,e,o,i)})})},P.apply(t,r)})}function T(t){return{state:"fulfilled",value:t}}function k(t){return{state:"rejected",reason:t}}function C(){return{state:"pending"}}function S(t){1===U.push(t)&&z(j)}function j(){u(U),U=[]}function M(t){return t}function A(t){throw"function"==typeof D.reportUnhandled?D.reportUnhandled():S(function(){throw t}),t}e.promise=n,e.resolve=o,e.reject=s,e.defer=a,e.join=_,e.all=m,e.map=w,e.reduce=x,e.settle=b,e.any=v,e.some=y,e.isPromise=g,e.isPromiseLike=g,O=r.prototype,O.then=function(t,e,n){var i=this;return new r(function(r,o,s){i._when(r,s,t,e,n)},this._status&&this._status.observed())},O["catch"]=O.otherwise=function(t){return this.then(V,t)},O["finally"]=O.ensure=function(t){function e(){return o(t())}return"function"==typeof t?this.then(e,e)["yield"](this):this},O.done=function(t,e){this.then(t,e)["catch"](A)},O["yield"]=function(t){return this.then(function(){return t})},O.tap=function(t){return this.then(t)["yield"](this)},O.spread=function(t){return this.then(function(e){return m(e,function(e){return t.apply(V,e)})})},O.always=function(t,e){return this.then(t,t,e)},R=Object.create||function(t){function e(){}return e.prototype=t,new e},c.prototype=R(O),c.prototype.inspect=function(){return T(this.value)},c.prototype._when=function(t,e,n){try{t("function"==typeof n?n(this.value):this.value)}catch(r){t(new p(r))}},p.prototype=R(O),p.prototype.inspect=function(){return k(this.value)},p.prototype._when=function(t,e,n,r){try{t("function"==typeof r?r(this.value):this)}catch(i){t(new p(i))}},f.prototype=R(O),f.prototype._when=function(t,e,n,r,i){try{e("function"==typeof i?i(this.value):this.value)}catch(o){e(o)}};var O,R,P,N,H,z,U,I,L,q,D,F,B,J,V;if(B=t,U=[],D="undefined"!=typeof console?console:e,"object"==typeof process&&process.nextTick)z=process.nextTick;else if(J="function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver)z=function(t,e,n){var r=t.createElement("div");return new e(n).observe(r,{attributes:!0}),function(){r.setAttribute("x","x")}}(document,J,j);else try{z=B("vertx").runOnLoop||B("vertx").runOnContext}catch(K){F=setTimeout,z=function(t){F(t,0)}}return I=Function.prototype,L=I.call,H=I.bind?L.bind(L):function(t,e){return t.apply(e,N.call(arguments,2))},q=[],N=q.slice,P=q.reduce||function(t){var e,n,r,i,o;if(o=0,e=Object(this),i=e.length>>>0,n=arguments,n.length<=1)for(;;){if(o in e){r=e[o++];break}if(++o>=i)throw new TypeError}else r=n[1];for(;i>o;++o)o in e&&(r=t(r,e[o],o,e));return r},e})}("function"==typeof n&&n.amd?n:function(t){module.exports=t(e)}),n("when",["when/when"],function(t){return t}),function(){var t;t=function(){var t,e,n;t=document.createElement("zveloFakeElement"),n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(e in n)if(null!=t.style[e])return n[e]}(),n("element",["when"],function(e){var n,r;return r=function(){function r(t,e){var n;if(this.el=t,this._animate=e,null==this._animate&&(this._animate=!0),null!=this.el)switch(typeof this.el){case"string":n=document.createElement("div"),n.innerHTML=this.el,this.el=n.firstChild;break;case"object":this.el instanceof r&&(this.el=this.el.el)}}return r.prototype.animate=function(t){return null==t?this._animate:(this._animate=t,this)},r.prototype.html=function(t){return null==this.el?this:null==t?this.el.innerHTML:(this.el.innerHTML="",this.el.innerHTML=t,this.el.style.display="block",this)},r.prototype.text=function(){var t,e,r,i;if(3===(r=this.el.nodeType)||4===r)return this.el.nodeValue;if(1!==(i=this.el.nodeType)&&9!==i&&11!==i)return"";if("string"==typeof this.el.textContent)return this.el.textContent;for(e="",t=n(this.el.firstChild);t.el;)e+=t.text(),t=n(t.el.nextSibling);return e},r.prototype.on=function(t,e){return null==this.el?this:("addEventListener"in this.el?this.el.addEventListener(t,e,!1):this.el.attachEvent("on"+t,e),this)},r.prototype.off=function(t,e){return null==this.el?this:("removeEventListener"in this.el?this.el.removeEventListener(t,e,!1):this.el.detachEvent("on"+t,e),this)},r.prototype.find=function(t){return null==this.el?this:n(this.el.querySelector(t))},r.prototype.attr=function(t,e){return null==this.el?this:null==e?this.el.getAttribute(t):(this.el.setAttribute(t,e),this)},r.prototype.hasClass=function(t){return null==this.el?!1:(" "+this.el.className+" ").indexOf(" "+t+" ")>-1},r.prototype.addClass=function(t,n,r){var i,o,s;return null==this.el?this:(null==r&&(r=this),s=e.defer(),i=s.promise,o=s.resolver,null!=n&&i.then(n.bind(r)),this.hasClass(t)?o.resolve(this):(this.el.className+=" "+t,this._onComplete(o)),this)},r.prototype.removeClass=function(t,n,r){var i,o,s,a;return null==this.el?this:(null==r&&(r=this),a=e.defer(),i=a.promise,s=a.resolver,null!=n&&i.then(n.bind(r)),this.hasClass(t)?(o=new RegExp("(?:^|\\s)"+t+"(?!\\S)","g"),this.el.className=this.el.className.replace(o,""),this._onComplete(s)):s.resolve(this),this)},r.prototype._onComplete=function(t){return this._animate?this._onTransitionEnd(t):t.resolve(this)},r.prototype._onTransitionEnd=function(e){var n;return null==t?e.resolve(this):(n=function(){return this.off(t,n),e.resolve(this)}.bind(this),this.on(t,n))},r.prototype.append=function(t){return null==this.el||null==t?this:(t=n(t),null==t.el?this:(this.el.appendChild(t.el),this))},r.prototype.remove=function(t){var e;return t=n(t),null!=(e=this.el)&&e.removeChild(t.el),this},r.prototype.display=function(t){var e;return null!=(e=this.el)&&(e.style.display=t),this},r.prototype.focus=function(){var t;return null!=(t=this.el)&&t.focus(),this},r.prototype.blur=function(){var t;return null!=(t=this.el)&&t.blur(),this},r.prototype.value=function(t){return null==this.el?this:null==t?this.el.value:(this.el.value=t,this)},r.prototype.options=function(t){var e,n,r;return null==t?null!=(e=this.el)?e.options:void 0:null!=(n=this.el)&&null!=(r=n.options)?r[t]:void 0},r.prototype.selectedIndex=function(){var t;return null!=(t=this.el)?t.selectedIndex:void 0},r.prototype.reflow=function(){var t;return null!=(t=this.el)&&t.offsetWidth,this},r}(),n=function(t,e){return new r(t,e)},n.transitionEnd=t,n})}.call(this),function(){n("placeholders",["element"],function(t){var e,n,r,i,o,s,a,u,l,h,c,p,f,d,g,y,v,m,_,b,w,E,x,T,k,C,S,j,M,A,O,R,P,N,H,z,U,I,L;return j=function(t,e){var n;return t.createTextRange?(n=t.createTextRange(),n.move("character",e),n.select()):t.selectionStart?(t.focus(),t.setSelectionRange(e,e)):void 0},c=function(t,e){var n;try{return t.type=e,!0}catch(r){return n=r,!1}},_=function(t,e){return-1!==t.indexOf(e)},L=["text","search","url","tel","email","password","number","textarea"],h=[27,33,34,35,36,37,38,39,40,8,46],P="#ccc",R="placeholdersjs",p=new RegExp("(?:^|\\s)"+R+"(?!\\S)"),n="data-placeholder-value",e="data-placeholder-active",o="data-placeholder-type",i="data-placeholder-submit",r="data-placeholder-bound",s="data-placeholder-focus",a="data-placeholder-live",I=document.createElement("input"),y=document.getElementsByTagName("head")[0],N=document.documentElement,w=!0,v=!0,b=void 0,O=function(){},m=function(t){var r;return t.value!==t.getAttribute(n)||"true"!==t.getAttribute(e)?!1:(t.setAttribute(e,"false"),t.value="",t.className=t.className.replace(p,""),r=t.getAttribute(o),r&&(t.type=r),!0)},U=function(t){var r,i;return i=t.getAttribute(n),""===t.value&&i?(t.setAttribute(e,"true"),t.value=i,t.className+=" "+R,r=t.getAttribute(o),r?t.type="text":"password"===t.type&&c(t,"text")&&t.setAttribute(o,"password"),!0):!1},g=function(t,e){var r,i,o,s,a,u,l,h;if(null!=t?t.getAttribute(n):void 0)return e(t);for(i=t?t.getElementsByTagName("input"):inputs,o=t?t.getElementsByTagName("textarea"):textareas,s=0,u=i.length;u>s;s++)r=i[s],e(r);for(h=[],a=0,l=o.length;l>a;a++)r=o[a],h.push(e(r));return h},f=function(t){return g(t,m)},d=function(t){return g(t,U)},T=function(t){return function(){return v&&t.value===t.getAttribute(n)&&"true"===t.getAttribute(e)?j(t,0):m(t)}},E=function(t){return function(){return U(t)}},k=function(t){return function(r){return"true"===t.getAttribute(e)&&_(h,r.keyCode)?(b=t.value,b===t.getAttribute(n)?(r.preventDefault&&r.preventDefault(),!1):void 0):void 0}},C=function(t){return function(){var r;return"true"===t.getAttribute(e)&&t.value!==b&&(t.className=t.className.replace(p,""),t.value=t.value.replace(t.getAttribute(n),""),t.setAttribute(e,!1),r=t.getAttribute(o),r&&(t.type=r)),""===t.value?(t.blur(),j(t,0)):void 0}},x=function(t){return function(){return t===document.activeElement&&t.value===t.getAttribute(n)&&"true"===t.getAttribute(e)?j(t,0):void 0}},S=function(t){return function(){return f(t)}},A=function(e,o){var s;return e=t(e),e.el.form&&(s=t(e.el.form),s.attr(i)||s.on("submit",S(s.el)).attr(i,"true")),e.on("focus",T(e.el)).on("blur",E(e.el)),v&&e.on("keydown",k(e.el)).on("keyup",C(e.el)).on("click",x(e.el)),e.attr(r,"true"),e.attr(n,o),U(e.el)},z=function(t){var e;return(e=t.attributes.placeholder)?(e=e.nodeValue,e&&_(L,t.type)?A(t,e):void 0):void 0},l=function(t){var e;return e=t.attributes.placeholder,e&&(e=e.nodeValue,e&&_(L,t.type)&&(t.getAttribute(r)||A(t,e),e!==t.getAttribute(n)||"password"===t.type&&!t.getAttribute(o)))?("password"===t.type&&!t.getAttribute(o)&&c(t,"text")&&t.setAttribute(o,"password"),t.value===t.getAttribute(n)&&(t.value=e),t.setAttribute(n,e)):void 0},M=void 0!==I.placeholder,u={nativeSupport:M,disable:M?O:f,enable:M?O:d},H=function(){var t,e,n,r,i,o,u,h,c,p,f;if(!M){for(e=document.getElementsByTagName("input"),o=document.getElementsByTagName("textarea"),v="false"===N.getAttribute(s),w="false"!==N.getAttribute(a),r=document.createElement("style"),r.type="text/css",i=document.createTextNode("."+R+" {"+("  color: "+P+";")+"}"),r.styleSheet?r.styleSheet.cssText=i.nodeValue:r.appendChild(i),y.insertBefore(r,y.firstChild),h=0,p=e.length;p>h;h++)t=e[h],z(t);for(c=0,f=o.length;f>c;c++)t=o[c],z(t);return n=function(){var n,r,i,s;for(n=0,i=e.length;i>n;n++)t=e[n],l(t);for(r=0,s=o.length;s>r;r++)t=o[r],l(t);return w?void 0:clearInterval(u)},u=setInterval(n,100)}},H(),u})}.call(this),/*

Copyright (C) 2011 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/
function(t){var e={};e.VERSION="1.0.0",e.COMPILER_REVISION=4,e.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},e.helpers={},e.partials={};var r=Object.prototype.toString,i="[object Function]",o="[object Object]";e.registerHelper=function(t,n,i){if(r.call(t)===o){if(i||n)throw new e.Exception("Arg not supported with multiple helpers");e.Utils.extend(this.helpers,t)}else i&&(n.not=i),this.helpers[t]=n},e.registerPartial=function(t,n){r.call(t)===o?e.Utils.extend(this.partials,t):this.partials[t]=n},e.registerHelper("helperMissing",function(e){if(2===arguments.length)return t;throw new Error("Missing helper: '"+e+"'")}),e.registerHelper("blockHelperMissing",function(t,n){var o=n.inverse||function(){},s=n.fn,a=r.call(t);return a===i&&(t=t.call(this)),t===!0?s(this):t===!1||null==t?o(this):"[object Array]"===a?t.length>0?e.helpers.each(t,n):o(this):s(t)}),e.K=function(){},e.createFrame=Object.create||function(t){e.K.prototype=t;var n=new e.K;return e.K.prototype=null,n},e.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(t,n){if(e.logger.level<=t){var r=e.logger.methodMap[t];"undefined"!=typeof console&&console[r]&&console[r].call(console,n)}}},e.log=function(t,n){e.logger.log(t,n)},e.registerHelper("each",function(t,n){var o,s=n.fn,a=n.inverse,u=0,l="",h=r.call(t);if(h===i&&(t=t.call(this)),n.data&&(o=e.createFrame(n.data)),t&&"object"==typeof t)if(t instanceof Array)for(var c=t.length;c>u;u++)o&&(o.index=u),l+=s(t[u],{data:o});else for(var p in t)t.hasOwnProperty(p)&&(o&&(o.key=p),l+=s(t[p],{data:o}),u++);return 0===u&&(l=a(this)),l}),e.registerHelper("if",function(t,n){var o=r.call(t);return o===i&&(t=t.call(this)),!t||e.Utils.isEmpty(t)?n.inverse(this):n.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn})}),e.registerHelper("with",function(t,n){var o=r.call(t);return o===i&&(t=t.call(this)),e.Utils.isEmpty(t)?void 0:n.fn(t)}),e.registerHelper("log",function(t,n){var r=n.data&&null!=n.data.level?parseInt(n.data.level,10):1;e.log(r,t)});var s=["description","fileName","lineNumber","message","name","number","stack"];e.Exception=function(){for(var t=Error.prototype.constructor.apply(this,arguments),e=0;e<s.length;e++)this[s[e]]=t[s[e]]},e.Exception.prototype=new Error,e.SafeString=function(t){this.string=t},e.SafeString.prototype.toString=function(){return this.string.toString()};var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},u=/[&<>"'`]/g,l=/[&<>"'`]/,h=function(t){return a[t]||"&amp;"};e.Utils={extend:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},escapeExpression:function(t){return t instanceof e.SafeString?t.toString():null==t||t===!1?"":(t=t.toString(),l.test(t)?t.replace(u,h):t)},isEmpty:function(t){return t||0===t?"[object Array]"===r.call(t)&&0===t.length?!0:!1:!0}},e.VM={template:function(t){var n={escapeExpression:e.Utils.escapeExpression,invokePartial:e.VM.invokePartial,programs:[],program:function(t,n,r){var i=this.programs[t];return r?i=e.VM.program(t,n,r):i||(i=this.programs[t]=e.VM.program(t,n)),i},merge:function(t,n){var r=t||n;return t&&n&&(r={},e.Utils.extend(r,n),e.Utils.extend(r,t)),r},programWithDepth:e.VM.programWithDepth,noop:e.VM.noop,compilerInfo:null};return function(r,i){i=i||{};var o=t.call(n,e,r,i.helpers,i.partials,i.data),s=n.compilerInfo||[],a=s[0]||1,u=e.COMPILER_REVISION;if(a!==u){if(u>a){var l=e.REVISION_CHANGES[u],h=e.REVISION_CHANGES[a];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+l+") or downgrade your runtime to an older version ("+h+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+s[1]+")."}return o}},programWithDepth:function(t,e,n){var r=Array.prototype.slice.call(arguments,3),i=function(t,i){return i=i||{},e.apply(this,[t,i.data||n].concat(r))};return i.program=t,i.depth=r.length,i},program:function(t,e,n){var r=function(t,r){return r=r||{},e(t,r.data||n)};return r.program=t,r.depth=0,r},noop:function(){return""},invokePartial:function(n,r,i,o,s,a){var u={helpers:o,partials:s,data:a};if(n===t)throw new e.Exception("The partial "+r+" could not be found");if(n instanceof Function)return n(i,u);if(e.compile)return s[r]=e.compile(n,{data:a!==t}),s[r](i,u);throw new e.Exception("The partial "+r+" could not be compiled when running in runtime-only mode")}},e.template=e.VM.template,"object"==typeof module&&module.exports?module.exports=e:"function"==typeof n&&n.amd?n("handlebars",[],function(){return e}):this.Handlebars=e}.call(this),n("templates",["handlebars"],function(t){return this.JST=this.JST||{},this.JST.lookup=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return'<form>\n  <div class="lookup inner-container">\n    <span>\n      <label for="zvelo-url-input">http://</label>\n    </span>\n    <span class="remaining">\n      <input type="text"\n             id="zvelo-url-input"\n             title="Enter a URL to lookup its categorization"\n             placeholder="zvelo.com (just start typing&hellip;)"\n             autocomplete="off"\n             spellcheck="false">\n    </span>\n  </div>\n  <div class="controls">\n    <button type="submit" class="btn btn-large btn-primary">Lookup</button>\n  </div>\n</form>\n'},useData:!0}),this.JST.modal=t.template({1:function(t,e,n,r){var i,o="function",s=e.helperMissing,a=this.escapeExpression;return" "+a((i=null!=(i=e["class"]||(null!=t?t["class"]:t))?i:s,typeof i===o?i.call(t,{name:"class",hash:{},data:r}):i))},3:function(){return'    <button type="button" class="close">×</button>\n'},5:function(t,e,n,r){var i,o="function",s=e.helperMissing,a=this.escapeExpression;return'    <button class="btn btn-primary">'+a((i=null!=(i=e.btn||(null!=t?t.btn:t))?i:s,typeof i===o?i.call(t,{name:"btn",hash:{},data:r}):i))+"</button>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,r){var i,o,s="function",a=e.helperMissing,u=this.escapeExpression,l='<div class="modal hide fade';return i=e["if"].call(t,null!=t?t["class"]:t,{name:"if",hash:{},fn:this.program(1,r),inverse:this.noop,data:r}),null!=i&&(l+=i),l+='">\n  <div class="modal-header">\n',i=e["if"].call(t,null!=t?t.close:t,{name:"if",hash:{},fn:this.program(3,r),inverse:this.noop,data:r}),null!=i&&(l+=i),l+="\n    <h3>"+u((o=null!=(o=e.header||(null!=t?t.header:t))?o:a,typeof o===s?o.call(t,{name:"header",hash:{},data:r}):o))+'</h3>\n  </div>\n  <div class="modal-body">\n    <p>',o=null!=(o=e.body||(null!=t?t.body:t))?o:a,i=typeof o===s?o.call(t,{name:"body",hash:{},data:r}):o,null!=i&&(l+=i),l+='</p>\n  </div>\n  <div class="modal-footer">\n',i=e["if"].call(t,null!=t?t.btn:t,{name:"if",hash:{},fn:this.program(5,r),inverse:this.noop,data:r}),null!=i&&(l+=i),l+"  </div>\n</div>\n"},useData:!0}),this.JST.report=t.template({1:function(t){var e=this.lambda,n=this.escapeExpression;return'        <option value="'+n(e(null!=t?t.id:t,t))+'">'+n(e(null!=t?t.name:t,t))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,r){var i,o,s="function",a=e.helperMissing,u=this.escapeExpression,l='<form>\n  <div class="inner-container '+u((o=null!=(o=e.page||(null!=t?t.page:t))?o:a,typeof o===s?o.call(t,{name:"page",hash:{},data:r}):o))+'">\n    <p class="lead url">'+u((o=null!=(o=e.url||(null!=t?t.url:t))?o:a,typeof o===s?o.call(t,{name:"url",hash:{},data:r}):o))+'</p>\n\n    <div class="categories">\n      <select>\n        <option value="">-- Suggest a Category --</option>\n';return i=e.each.call(t,null!=t?t.categories:t,{name:"each",hash:{},fn:this.program(1,r),inverse:this.noop,data:r}),null!=i&&(l+=i),l+'      </select>\n    </div>\n  </div>\n\n  <div class="controls">\n    <button type="submit" class="btn btn-large btn-danger report">Report Miscategorization</button>\n    <button type="button" class="btn btn-large btn-primary lookup">Return to Lookup</button>\n  </div>\n</form>\n'},useData:!0}),this.JST.result=t.template({1:function(t,e,n,r){var i,o='    <div class="categories">\n';return i=e.each.call(t,null!=t?t.categories:t,{name:"each",hash:{},fn:this.program(2,r),inverse:this.noop,data:r}),null!=i&&(o+=i),o+"    </div>\n"},2:function(t){var e=this.lambda,n=this.escapeExpression;return'      <span class="category" title="'+n(e(t,t))+'">'+n(e(t,t))+"</span>\n"},4:function(){return'    <p class="uncategorized">\n    This URL has not yet been categorized. It has been submitted for classification.\n    </p>\n'},6:function(t,e,n,r){var i,o="function",s=e.helperMissing,a=this.escapeExpression;return'  <div class="span3 reputation reputation'+a((i=null!=(i=e.reputationId||(null!=t?t.reputationId:t))?i:s,typeof i===o?i.call(t,{name:"reputationId",hash:{},data:r}):i))+'">\n    <div class="reputation-img-container">\n      <div class="aspect"></div>\n      <div class="img"></div>\n    </div>\n    <p title="'+a((i=null!=(i=e.reputation||(null!=t?t.reputation:t))?i:s,typeof i===o?i.call(t,{name:"reputation",hash:{},data:r}):i))+'">'+a((i=null!=(i=e.reputation||(null!=t?t.reputation:t))?i:s,typeof i===o?i.call(t,{name:"reputation",hash:{},data:r}):i))+"</p>\n  </div>\n"},8:function(){return'  <button class="btn btn-large btn-warning report" title="Report this URL as miscategorized">Miscategorized?</button>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,n,r){var i,o,s="function",a=e.helperMissing,u=this.escapeExpression,l='<div class="inner-container row-fluid">\n  <div class="span9">\n    <p class="lead url" title="'+u((o=null!=(o=e.url||(null!=t?t.url:t))?o:a,typeof o===s?o.call(t,{name:"url",hash:{},data:r}):o))+'">'+u((o=null!=(o=e.url||(null!=t?t.url:t))?o:a,typeof o===s?o.call(t,{name:"url",hash:{},data:r}):o))+"</p>\n\n";return i=e["if"].call(t,null!=t?t.reputationId:t,{name:"if",hash:{},fn:this.program(1,r),inverse:this.program(4,r),data:r}),null!=i&&(l+=i),l+="  </div>\n\n",i=e["if"].call(t,null!=t?t.reputationId:t,{name:"if",hash:{},fn:this.program(6,r),inverse:this.noop,data:r}),null!=i&&(l+=i),l+='</div>\n\n<div class="controls">\n  <button class="btn btn-large btn-primary lookup" title="Lookup another URL">Lookup Another URL</button>\n',i=e["if"].call(t,null!=t?t.reputationId:t,{name:"if",hash:{},fn:this.program(8,r),inverse:this.noop,data:r}),null!=i&&(l+=i),l+"</div>\n"},useData:!0}),this.JST}),function(t,e){function r(){for(y=!0,clearTimeout(l);u=m.pop();)u();g&&(e[p]="complete");for(var t;t=d.shift();)t()}function i(){if(!e.body)return!1;c||(c=e.createTextNode(""));try{return e.body.removeChild(e.body.appendChild(c)),c=h,!0}catch(t){return!1}}function o(){var t;return t=f[e[p]]&&i(),!y&&t&&r(),t}function s(){o(),y||(l=setTimeout(s,v))}var a,u,l,h,c,p="readyState",f={loaded:1,interactive:1,complete:1},d=[],g=e&&"string"!=typeof e[p],y=!1,v=10,m=[];a="addEventListener"in t?function(t,e){return t.addEventListener(e,o,!1),function(){t.removeEventListener(e,o,!1)}}:function(t,e){return t.attachEvent("on"+e,o),function(){t.detachEvent(e,o)}},e&&(o()||(m=[a(t,"load"),a(e,"readystatechange"),a(t,"DOMContentLoaded")],l=setTimeout(s,v))),n("domReady",[],function(){function t(t){y?t():d.push(t)}return t.then=t,t.amd=!0,t})}(this,this.document),function(){var t={}.hasOwnProperty;n("zvelonet/lib/semver",[],function(){var e,n,r,i,o,s,a,u,l,h,c,p,f,d,g,y,v,m,_,b,w,E,x,T,k,C,S,j,M,A,O,R;k="\\s*[v=]*\\s*([0-9]+)\\.([0-9]+)\\.([0-9]+)(-[0-9]+-?)?([a-zA-Z-+][a-zA-Z0-9-.:]*)?",s="^((<|>)?=?)s*("+k+")$|^$",R="[v=]*([0-9]+|x|X|\\*)(?:\\.([0-9]+|x|X|\\*)(?:\\.([0-9]+|x|X|\\*)([a-zA-Z-][a-zA-Z0-9-.:]*)?)?)?",O="((?:<|>)=?)?\\s*"+R,a="(?:~>?)",u=""+a+O,h={parse:new RegExp("^\\s*"+k+"\\s*$"),parsePackage:new RegExp("^\\s*([^/]+)[-@]("+k+")\\s*$"),parseRange:new RegExp("^\\s*("+k+")\\s+-\\s+("+k+")\\s*$"),validComparator:new RegExp("^"+s+"$"),parseXRange:new RegExp("^"+O+"$"),parseSpermy:new RegExp("^"+u+"$")},m=function(t){return(""+(t||"")).match(h.parse)},j=function(t){var e;return e=t,[e[1]||"",e[2]||"",e[3]||""].join(".")+(e[4]||"")+(e[5]||"")},C=/(<|>)?=?\s*\*/g,S="",e=new RegExp("((<|>)?=|<|>)\\s*("+k+"|"+R+")","g"),n="$1$3",E=function(t){return t.trim().replace(h.parseXRange,function(t,e,n,r,i){var o,s;return o=!n||"x"===n.toLowerCase()||"*"===n||!r||"x"===r.toLowerCase()||"*"===r||!i||"x"===i.toLowerCase()||"*"===i,s=t,e&&o?((!n||"*"===n||"x"===n.toLowerCase())&&(n=0),(!r||"*"===r||"x"===r.toLowerCase())&&(r=0),(!i||"*"===i||"x"===i.toLowerCase())&&(i=0),s=""+e+n+"."+r+"."+i+"-"):n&&"*"!==n&&"x"!==n.toLowerCase()?r&&"*"!==r&&"x"!==r.toLowerCase()?i&&"*"!==i&&"x"!==i.toLowerCase()||(s=">="+n+"."+r+".0- <"+n+"."+(+r+1)+".0-"):s=">="+n+".0.0- <"+(+n+1)+".0.0-":s="*",s})},x=function(t){return t.split(/\s+/).map(E).join(" ")},b=function(t){return t.trim().replace(h.parseSpermy,function(t,e,n,r,i,o){if(e)throw new Error("Using '"+e+"' with ~ makes no sense. Don't do it.");return n&&"x"!==n.toLowerCase()?r&&"x"!==r.toLowerCase()?i&&"x"!==i.toLowerCase()?(o=o||"-",">="+n+"."+r+"."+(i+o)+" <"+n+"."+(+r+1)+".0-"):">="+n+"."+r+".0- <"+n+"."+(+r+1)+".0-":">="+n+".0.0- <"+(+n+1)+".0.0-":""})},v=function(t){return null==t?-1:parseInt((t||"0").replace(/[^0-9]+/g,""),10)},c=function(t,e){var n,r,i,o;if(t=m(t),e=m(e),!t||!e)return!1;for(n=o=1;4>=o;n=++o){if(t[n]=v(t[n]),e[n]=v(e[n]),t[n]>e[n])return!0;if(t[n]!==e[n])return!1}return r=t[5]||"",i=e[5]||"",r===i?null:r?i?r>i:!1:!0},d=function(t,e){return c(e,t)},p=function(t,e){return!d(t,e)},g=function(t,e){return!c(t,e)},i=function(t,e){return null===c(t,e)},y=function(t,e){return null!==c(t,e)},r=function(t,e){var n;return n=c(t,e),null===n?0:n?1:-1},A=function(t){return"string"!=typeof t?null:m(t)&&t.trim().replace(/^[v=]+/,"")},_=">=$1 <=$7",M=function(t){var r;return r=(t||"").trim().replace(h.parseRange,_).replace(e,n).split(/\s+/).join(" ").split("||").map(function(t){return t.replace(new RegExp("("+a+")\\s+"),"$1").split(" ").map(x).map(b).map(w).join(" ").trim()}).map(function(t){return t.trim().split(/\s+/).filter(function(t){return t.match(h.validComparator)})}).filter(function(t){return t.length})},T=function(t,e){var n,r,o,s,a,u,l,h,p;if(t=A(t),!t)return!1;for(e=M(e),u=0,h=e.length;h>u;u++){for(r=e[u],o=!1,l=0,p=r.length;p>l&&(s=r[l],n=function(){switch(s.charAt(0)){case">":return c;case"<":return d;default:return!1}}(),i=s.charAt("="===!!n),a=!!i+!!n,n||(i=!0),s=s.substr(a),s=""===s?s:A(s),o=""===s||i&&s===t||n&&n(t,s),o);l++);if(o)return!0}return!1},w=function(t){return t.trim().replace(C,S)},o={expressions:h,rangeReplace:_,compare:r,satisfies:T,replaceStars:w,toComparators:M,eq:i,neq:y,gt:c,gte:p,lt:d,lte:g,rcompare:function(t,e){return r(e,t)},clean:function(t){return t=m(t),t?j(t):t},validPackage:function(t){return"string"!=typeof t?null:t.match(h.parsePackage)&&t.trim()},validRange:function(t){var e;return t=w(t),e=M(t),0===e.length?null:e.map(function(t){return t.join(" ")}).join("||")},maxSatisfying:function(t,e){return t.filter(function(t){return T(t,e)}).sort(r).pop()||null},inc:function(t,e){var n,r,i,o,s;if(t=m(t),!t)return null;if(o={major:1,minor:2,patch:3,build:4},i=o[e],null==i)return null;for(n=v(t[i]),t[i]=-1===n?1:n+1,r=s=i;4>=i?4>=s:s>=4;r=4>=i?++s:--s)-1!==v(t[r])&&(t[r]="0");return t[4]&&(t[4]="-"+t[4]),t[5]="",j(t)},cmp:function(t,e,n){switch(e){case">":return c(t,n);case"<":return d(t,n);case">=":return p(t,n);case"<=":return g(t,n);case"==":return i(t,n);case"!=":return y(t,n);case"is":return t===n;case"===":return t===n;case"isnt":return t!==n;case"!==":return t!==n;default:throw new Error("Y U NO USE VALID COMPARATOR!? "+e)}}};for(f in h)t.call(h,f)&&(l=h[f],o[f]=function(t){return(""+(t||"")).match(l)});return o})}.call(this),function(){var t;t=this,n("zvelonet/lib/log",[],function(){return function(){return t.console?console.log(Array.prototype.slice.call(arguments)):void 0}})}.call(this),function(){var t;t="zvelo",n("zvelonet/lib/storage",["./log"],function(e){var n;return n={makeKey:function(e,n){if(null==e)throw new Error("storage cannot use unspecified index");return null==n&&(n=t),""+n+"."+e},inUse:function(){return null!=("undefined"!=typeof window&&null!==window?window.localStorage:void 0)?!0:!1},write:function(t,r,i){var o,s;if(!n.inUse())return!1;s=n.makeKey(t,i),e("storage: writing "+s);try{return localStorage.setItem(s,JSON.stringify(r)),!0}catch(a){return o=a,o===QUOTA_EXCEEDED_ERR&&e("storage: localStorage quota exceeded"),!1}},read:function(t,r,i){var o,s,a,u;if(!n.inUse())return r;if(s=n.makeKey(t,i),a=localStorage.getItem(s),null==a&&null!=r)return e("storage: "+s+" was missing, storing default"),n.write(t,r,i),r;try{return u=JSON.parse(a),e("storage: read "+s),u}catch(l){return o=l,r}},"delete":function(t,e){var r;if(n.inUse())return r=n.makeKey(t,e),localStorage.removeItem(r)}}})}.call(this),function(t){function e(t,e,n){for(var r=(n||0)-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function r(t,n){var r=typeof n;if(t=t.cache,"boolean"==r||null==n)return t[n];"number"!=r&&"string"!=r&&(r="object");var i="number"==r?n:z+n;return t=t[r]||(t[r]={}),"object"==r?t[i]&&e(t[i],n)>-1?0:-1:t[i]?0:-1}function i(t){var e=this.cache,n=typeof t;if("boolean"==n||null==t)e[t]=!0;else{"number"!=n&&"string"!=n&&(n="object");var r="number"==n?t:z+t,i=e[n]||(e[n]={});"object"==n?(i[r]||(i[r]=[])).push(t)==this.array.length&&(e[n]=!1):i[r]=!0}}function o(t){var e=-1,n=t.length,r=a();r["false"]=r["null"]=r["true"]=r.undefined=!1;var o=a();for(o.array=t,o.cache=r,o.push=i;++e<n;)o.push(t[e]);return r.object===!1?(h(o),null):o}function s(){return P.pop()||[]}function a(){return N.pop()||{args:"",array:null,bottom:"",cache:null,"false":!1,firstArg:"",init:"",loop:"","null":!1,number:null,object:null,push:null,shadowedProps:null,string:null,top:"","true":!1,undefined:!1,useHas:!1,useKeys:!1}}function u(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function l(t){t.length=0,P.length<I&&P.push(t)}function h(t){var e=t.cache;e&&h(e),t.array=t.cache=t.object=t.number=t.string=null,N.length<I&&N.push(t)}function c(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,i=n-e||0,o=Array(0>i?0:i);++r<i;)o[r]=t[e+r];return o}function p(){}function f(){var t=a();t.shadowedProps=D,t.array=t.bottom=t.loop=t.top="",t.init="iterable",t.useHas=!0,t.useKeys=!!je;for(var e,n=0;e=arguments[n];n++)for(var r in e)t[r]=e[r];var i=t.args;t.firstArg=/^[^,]+/.exec(i)[0];var o=Function("errorClass, errorProto, hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+i+") {\n"+Ee(t)+"\n}");return h(t),o(K,ne,ue,y,Ce,E,je,p,re,G,be,Q,ie,he)}function d(){var t=(t=p.indexOf)===S?e:t;return t}function g(t){return function(e,n,r,i){return"boolean"!=typeof n&&null!=n&&(i=r,r=i&&i[n]===e?R:n,n=!1),null!=r&&(r=p.createCallback(r,i)),t(e,n,r,i)}}function y(t){return he.call(t)==F}function v(t,e,n,r,i,o){var a=t;if("boolean"!=typeof e&&null!=e&&(r=n,n=e,e=!1),"function"==typeof n){if(n="undefined"==typeof r?n:p.createCallback(n,r,1),a=n(a),"undefined"!=typeof a)return a;a=t}var h=w(a);if(h){var f=he.call(a);if(!Z[f]||!we.nodeClass&&u(a))return a;var d=Ce(a)}if(!h||!e)return h?d?c(a):Ae({},a):a;var g=_e[f];switch(f){case J:case V:return new g(+a);case X:case Q:return new g(a);case Y:return g(a.source,L.exec(a))}var y=!i;i||(i=s()),o||(o=s());for(var m=i.length;m--;)if(i[m]==t)return o[m];return a=d?g(a.length):{},d&&(ue.call(t,"index")&&(a.index=t.index),ue.call(t,"input")&&(a.input=t.input)),i.push(t),o.push(a),(d?Me:Re)(t,function(t,r){a[r]=v(t,e,n,R,i,o)}),y&&(l(i),l(o)),a}function m(t){var e=!0;if(!t)return e;var n=he.call(t),r=t.length;return n==B||n==Q||(we.argsClass?n==F:y(t))||n==$&&"number"==typeof r&&b(t.splice)?!r:(Re(t,function(){return e=!1}),e)}function _(t,e,n,r,i,o){var a=n===H;if("function"==typeof n&&!a){n=p.createCallback(n,r,2);var h=n(t,e);if("undefined"!=typeof h)return!!h}if(t===e)return 0!==t||1/t==1/e;var c=typeof t,f=typeof e;if(t===t&&(!t||"function"!=c&&"object"!=c)&&(!e||"function"!=f&&"object"!=f))return!1;if(null==t||null==e)return t===e;var d=he.call(t),g=he.call(e);if(d==F&&(d=$),g==F&&(g=$),d!=g)return!1;switch(d){case J:case V:return+t==+e;case X:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case Y:case Q:return t==String(e)}var v=d==B;if(!v){if(ue.call(t,"__wrapped__ ")||ue.call(e,"__wrapped__"))return _(t.__wrapped__||t,e.__wrapped__||e,n,r,i,o);if(d!=$||!we.nodeClass&&(u(t)||u(e)))return!1;var m=!we.argsObject&&y(t)?Object:t.constructor,w=!we.argsObject&&y(e)?Object:e.constructor;if(m!=w&&!(b(m)&&m instanceof m&&b(w)&&w instanceof w))return!1}var E=!i;i||(i=s()),o||(o=s());for(var x=i.length;x--;)if(i[x]==t)return o[x]==e;var T=0;if(h=!0,i.push(t),o.push(e),v){if(x=t.length,T=e.length,h=T==t.length,!h&&!a)return h;for(;T--;){var k=x,C=e[T];if(a)for(;k--&&!(h=_(t[k],C,n,r,i,o)););else if(!(h=_(t[T],C,n,r,i,o)))break}return h}return Oe(e,function(e,s,a){return ue.call(a,s)?(T++,h=ue.call(t,s)&&_(t[s],e,n,r,i,o)):void 0}),h&&!a&&Oe(t,function(t,e,n){return ue.call(n,e)?h=--T>-1:void 0}),E&&(l(i),l(o)),h}function b(t){return"function"==typeof t}function w(t){return!(!t||!G[typeof t])}function E(t){return"string"==typeof t||he.call(t)==Q}function x(t,e,n){if(e=p.createCallback(e,n),!Ce(t)){var r;return Me(t,function(t,n,i){return e(t,n,i)?(r=t,!1):void 0}),r}for(var i=-1,o=t.length;++i<o;){var s=t[i];if(e(s,i,t))return s}}function T(t,e,n){if(e&&"undefined"==typeof n&&Ce(t))for(var r=-1,i=t.length;++r<i&&e(t[r],r,t)!==!1;);else Me(t,e,n);return t}function C(t){var e=t?t.length:0;return"number"==typeof e?e:je(t).length}function S(t,n,r){if("number"==typeof r){var i=t?t.length:0;r=0>r?ge(0,i+r):r||0}else if(r){var o=j(t,n);return t[o]===n?o:-1}return t?e(t,n,r):-1}function j(t,e,n,r){var i=0,o=t?t.length:i;for(n=n?p.createCallback(n,r,1):O,e=n(e);o>i;){var s=i+o>>>1;n(t[s])<e?i=s+1:o=s}return i}function M(t){return Ce(t)||(arguments[0]=t?ye.call(t):ee),Pe(se.apply(ee,arguments))}function A(t,e,n){if(null==t)return O;var r=typeof t;if("function"!=r){if("object"!=r)return function(e){return e[t]};var i=je(t);return function(e){for(var n=i.length,r=!1;n--&&(r=_(e[i[n]],t[i[n]],H)););return r}}return"undefined"==typeof e||q&&!q.test(ae.call(t))?t:1===n?function(n){return t.call(e,n)}:2===n?function(n,r){return t.call(e,n,r)}:4===n?function(n,r,i,o){return t.call(e,n,r,i,o)}:function(n,r,i){return t.call(e,n,r,i)}}function O(t){return t}var R,P=[],N=[],H={},z=+new Date+"",U=75,I=40,L=/\w*$/,q=(q=/\bthis\b/)&&q.test(function(){return this})&&q,D=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],F="[object Arguments]",B="[object Array]",J="[object Boolean]",V="[object Date]",K="[object Error]",W="[object Function]",X="[object Number]",$="[object Object]",Y="[object RegExp]",Q="[object String]",Z={};Z[W]=!1,Z[F]=Z[B]=Z[J]=Z[V]=Z[X]=Z[$]=Z[Y]=Z[Q]=!0;var G={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},te=G[typeof global]&&global;!te||te.global!==te&&te.window!==te||(t=te);var ee=[],ne=Error.prototype,re=Object.prototype,ie=String.prototype,oe=(t._,RegExp("^"+String(re.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$")),se=(Math.ceil,t.clearTimeout,ee.concat),ae=(Math.floor,Function.prototype.toString),ue=re.hasOwnProperty,le=(ee.push,re.propertyIsEnumerable),he=(t.setTimeout,re.toString),ce=oe.test(ce=he.bind)&&ce,pe=oe.test(pe=Object.create)&&pe,fe=oe.test(fe=Array.isArray)&&fe,de=(t.isFinite,t.isNaN,oe.test(de=Object.keys)&&de),ge=Math.max,ye=(Math.min,Math.random,ee.slice),ve=oe.test(t.attachEvent),me=ce&&!/\n|true/.test(ce+ve),_e={};_e[B]=Array,_e[J]=Boolean,_e[V]=Date,_e[W]=Function,_e[$]=Object,_e[X]=Number,_e[Y]=RegExp,_e[Q]=String;var be={};be[B]=be[V]=be[X]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},be[J]=be[Q]={constructor:!0,toString:!0,valueOf:!0},be[K]=be[W]=be[Y]={constructor:!0,toString:!0},be[$]={constructor:!0},function(){for(var t=D.length;t--;){var e=D[t];for(var n in be)ue.call(be,n)&&!ue.call(be[n],e)&&(be[n][e]=!1)}}();var we=p.support={};!function(){var t=function(){this.x=1},e=[];t.prototype={valueOf:1,y:1};for(var n in new t)e.push(n);for(n in arguments);we.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),we.argsClass=y(arguments),we.enumErrorProps=le.call(ne,"message")||le.call(ne,"name"),we.enumPrototypes=le.call(t,"prototype"),we.fastBind=ce&&!me,we.nonEnumArgs=0!=n,we.nonEnumShadows=!/valueOf/.test(e),we.unindexedChars="x"[0]+Object("x")[0]!="xx";try{we.nodeClass=!(he.call(document)==$&&!({toString:0}+""))}catch(r){we.nodeClass=!0}}(1);var Ee=function(t){var e="var index, iterable = "+t.firstArg+", result = "+t.init+";\nif (!iterable) return result;\n"+t.top+";";t.array?(e+="\nvar length = iterable.length; index = -1;\nif ("+t.array+") {  ",we.unindexedChars&&(e+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),e+="\n  while (++index < length) {\n    "+t.loop+";\n  }\n}\nelse {  "):we.nonEnumArgs&&(e+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+t.loop+";\n    }\n  } else {  "),we.enumPrototypes&&(e+="\n  var skipProto = typeof iterable == 'function';\n  "),we.enumErrorProps&&(e+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var n=[];if(we.enumPrototypes&&n.push('!(skipProto && index == "prototype")'),we.enumErrorProps&&n.push('!(skipErrorProps && (index == "message" || index == "name"))'),t.useHas&&t.useKeys)e+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",n.length&&(e+="    if ("+n.join(" && ")+") {\n  "),e+=t.loop+";    ",n.length&&(e+="\n    }"),e+="\n  }  ";else if(e+="\n  for (index in iterable) {\n",t.useHas&&n.push("hasOwnProperty.call(iterable, index)"),n.length&&(e+="    if ("+n.join(" && ")+") {\n  "),e+=t.loop+";    ",n.length&&(e+="\n    }"),e+="\n  }    ",we.nonEnumShadows){for(e+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;7>k;k++)e+="\n    index = '"+t.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",t.useHas||(e+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),e+=") {\n      "+t.loop+";\n    }      ";e+="\n  }    "}return(t.array||we.nonEnumArgs)&&(e+="\n}"),e+=t.bottom+";\nreturn result"},xe={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},Te={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",array:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},ke={top:"if (!objectTypes[typeof iterable]) return result;\n"+Te.top,array:!1};we.argsClass||(y=function(t){return t?ue.call(t,"callee"):!1});var Ce=fe||function(t){return t?"object"==typeof t&&he.call(t)==B:!1},Se=f({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),je=de?function(t){return w(t)?we.enumPrototypes&&"function"==typeof t||we.nonEnumArgs&&t.length&&y(t)?Se(t):de(t):[]}:Se,Me=f(Te),Ae=f(xe,{top:xe.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Oe=f(Te,ke,{useHas:!1}),Re=f(Te,ke);b(/x/)&&(b=function(t){return"function"==typeof t&&he.call(t)==W});var Pe=g(function(t,n,i){var a=-1,u=d(),c=t?t.length:0,p=[],f=!n&&c>=U&&u===e,g=i||f?s():p;if(f){var y=o(g);y?(u=r,g=y):(f=!1,g=i?g:(l(g),p))}for(;++a<c;){var v=t[a],m=i?i(v,a,t):v;(n?!a||g[g.length-1]!==m:u(g,m)<0)&&((i||f)&&g.push(m),p.push(v))}return f?(l(g.array),h(g)):i&&l(g),p});p.assign=Ae,p.createCallback=A,p.forEach=T,p.forIn=Oe,p.forOwn=Re,p.keys=je,p.union=M,p.uniq=Pe,p.each=T,p.extend=Ae,p.unique=Pe,p.clone=v,p.find=x,p.identity=O,p.indexOf=S,p.isArguments=y,p.isArray=Ce,p.isEmpty=m,p.isEqual=_,p.isFunction=b,p.isObject=w,p.isString=E,p.size=C,p.sortedIndex=j,p.detect=x,p.findWhere=x,p.VERSION="1.3.1","function"==typeof n&&"object"==typeof n.amd&&n.amd&&n("zvelonet/lib/lodash",[],function(){return p})}(this),function(){var t={}.hasOwnProperty;n("zvelonet/lib/url",["./lodash","./log"],function(e,n){var r,i,o,s,a,u,l;return s="://",r=["source","scheme","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],u=function(){var t,e,n,r,i,o,s,a,u,l,h,c,p,f,d,g,y,v,m,_,b,w,E,x;return e="[^:@]",_="(?!"+e+"+:[^:@/]*@)",v="([^:/?#.]+)",m="(?:"+_+v+":)",b="(?://)",x="("+e+"*)",h=x,w="("+x+":?"+h+")",E="(?:"+w+"?@)",l="([^:/?#]*)",p="(\\d*)",f="(?::"+p+")",t="("+E+"?"+l+f+"?)",r="(?:[?#]|$)",i="(?![^?#/]*\\.[^?#/.]+"+r+")",o="(?:[^?#]"+i+")",n="(/"+o+"*/?)",s="([^?#/]*)",c="("+n+"?"+s+")",d="([^#]*)",g="(?:\\?"+d+")",a="(.*)",u="(?:#"+a+")",y="("+c+g+"?"+u+"?)",new RegExp("^"+(""+m+"?")+(""+b+"?")+t+y)},l=function(){var t,e,n;return e="(?:^|&|;)",t="([^&=;]*)",n="([^&;]*)",new RegExp(""+e+t+"=?"+n,"g")},i=u(),o=l(),a=function(){function a(t){var e,n,r,i,o;if(this._origUrl=t,a.isUrl(this._origUrl))throw new Error("The Url class has no copy constructor");if("string"!=typeof this._origUrl)throw new Error("Cannot create Url object from "+typeof this._origUrl);if(e=a.parse(this._origUrl),null==e||(null!=(r=e.attr)&&null!=(i=r.host)?!i.length:!0))throw new Error('Could not parse url: "'+this._origUrl+'"');o=e.attr,this.scheme=o.scheme,this.host=o.host,this.path=o.path,n=a.getScheme(this.scheme),this.port=parseInt(e.attr.port,10),isNaN(this.port)&&(this.port=n.port),this.pathParts=e.seg.path,this.query=e.query,this.url=this.toString()}return a.TYPE={HOST:0,PATH:1,SCHEME_PORT:2,QUERY:3},a.SCHEME={HTTP:{id:0,name:"http",port:80},HTTPS:{id:1,name:"https",port:443},FTP:{id:2,name:"ftp",port:21}},a.getScheme=function(n){var r,i;i=a.SCHEME;for(r in i)if(t.call(i,r)){if("string"==typeof n&&n.toLowerCase()===a.SCHEME[r].name)return e.clone(a.SCHEME[r]);if("number"==typeof n&&n===a.SCHEME[r].id)return e.clone(a.SCHEME[r])}},a.decodeAll=function(t){var e,n,r;n=t;try{for(;n!==e;)e=decodeURIComponent(n)}catch(i){return r=i,n}return e},a.parse=function(t){var n,s,u,l,h,c,p,f,d,g,y,v,m,_,b,w;if(null==a.parse.cache&&(a.parse.cache={}),"string"==typeof t){if(t in a.parse.cache)return a.parse.cache[t];if(g={attr:{},seg:{}},t=t.replace(/[\t\r\n]/g,"").replace(/(#.*$)/,""),s=t.indexOf("?"),-1!==s&&(c=t.substring(s),t=t.substring(0,s)),d=a.decodeAll(t),null!=d){for(p=i.exec(a.prependHttp(d)),n=y=_=r.length-1;0>=_?0>=y:y>=0;n=0>=_?++y:--y)g.attr[r[n]]=p[n];if(null!=g.attr.host){for(null!=g.attr.query&&g.attr.query.replace(o,function(t,n,r){var i,o;return null==g.query&&(g.query=[]),o={key:n,value:r},i=e.sortedIndex(g.query,o,function(t){var e;return e=t.key,null!=t.value&&(e+=":"+t.value),e}),g.query.splice(i,0,o)}),g.attr.host=encodeURIComponent(g.attr.host).replace(/^\.\.*/,"").replace(/\.\.*$/,"").replace(/\.\.\.*/g,".").toLowerCase(),g.seg.path=[],l=null!=g.attr.path?g.attr.path:"/",h=l.trim().split("/"),v=0,m=h.length;m>v;v++)u=h[v],u.length&&"."!==u&&(".."===u?g.seg.path.pop():u&&(u=encodeURI(u).replace("#","%23"),g.seg.path.push(u)));
if(g.attr.path=g.seg.path.length?"/"+g.seg.path.join("/"):"/",(null!=(b=g.attr.fragment)?b.length:void 0)&&(l+="#"+g.attr.fragment),f=(null!=(w=g.attr.scheme)?w.length:void 0)?a.getScheme(g.attr.scheme.trim()):a.SCHEME.HTTP.name,null!=f)return g.attr.schemea=f.name,null==g.attr.port&&(g.attr.port=f.port),a.parse.cache[t]=g,g}}}},a.prependHttp=function(t){var e,n;if(null!=t)return e=t.indexOf(s),-1===e?""+a.SCHEME.HTTP.name+s+t:0===e?""+a.SCHEME.HTTP.name+t:(n=t.indexOf("/"),-1===n||e>n?""+a.SCHEME.HTTP.name+s+t:t)},a.isUrl=function(t){return t instanceof a},a._queryToStr=function(t){var e,n,r,i;if("string"==typeof t&&t)return"?"+t;if(Array.isArray(t&&t.length)){for(r=0,i=t.length;i>r;r++)e=t[r],"undefined"!=typeof n&&null!==n?n+="&":n="?",n+=""+e.key,null!=e.value&&(n+="="+e.value);return n}return""},a.build=function(t,e,n,r,i){var o;if(null!=e&&e){if(t=a.getScheme(t?t:"http"),o=""+t.name+s,Array.isArray(e)&&e.length)o+=e.join(".");else{if("string"!=typeof e||!e.length)return;o+=e}return null!=n&&"number"==typeof n&&t.port!==n&&(o+=":"+n),Array.isArray(r)?r.length&&(o+="/"+r.join("/")):o+="string"==typeof r?r:"/",o+=a._queryToStr(i),a.factory(o)}},a.factory=function(t){var e,r;if(a.isUrl(t))return t;try{if("string"==typeof t)return new a(t)}catch(i){return r=i,void n("Url Error: "+r.message)}return e=["Cannot create Url object from "+typeof t],null!=t&&e.push(t),n.apply(this,e)},a.hostUrl=function(t){var e;return e=a.factory(t),a.factory(""+e.scheme+"://"+e.host+":"+e.port+"/")},a.sort=function(t,e){return t=a.factory(t),e=a.factory(e),null==t||null==e?0:t.equals(e)?0:t.lessThan(e)?-1:1},a.prototype._parentHost=function(){var t;return t=this.host.split("."),t.length<2?void 0:(t.shift(),t.join("."))},a.prototype._hostParent=function(){var t,e,n;return t=this._parentHost(),n=this.scheme,e=this.port,null!=t||n===a.SCHEME.HTTP.name&&e===a.SCHEME.HTTP.port||(t=this.host,n=a.SCHEME.HTTP.name,e=a.SCHEME.HTTP.port),null!=t?a.build(n,t,e,this.path,this.query):void 0},a.prototype._parentPath=function(){var t;if(this.path&&"/"!==this.path)return this.pathParts.length<=1?"/":(t=e.clone(this.pathParts),t.pop(),"/"+t.join("/"))},a.prototype._pathParent=function(){var t;return(t=this._parentPath())?a.build(this.scheme,this.host,this.port,t,this.query):void 0},a.prototype._queryParent=function(){var t,n;if(null!=(n=this.query)?n.length:void 0)return t=e.clone(this.query),t.pop(),a.build(this.scheme,this.host,this.port,this.path,t)},a.prototype._parentHosts=function(){var t,e;if(null!=this._parentHostsCache)return this._parentHostsCache;for(this._parentHostsCache=[],e=this,t=e.host;t&&(this._parentHostsCache.push(t),e=a.factory(t),null!=e);)t=e._parentHost();return this._parentHostsCache},a.prototype._portLessThan=function(t){var e;return e=a.factory(t),null==e?!1:this.port===e.port?!1:this.port===a.SCHEME.HTTP.port?!0:e.port===a.SCHEME.HTTP.port?!1:this.port<e.port},a.prototype._schemeLessThan=function(t){var e;return e=a.factory(t),null==e?!1:this.scheme===e.scheme?!1:this.scheme===a.SCHEME.HTTP.name?!0:e.scheme===a.SCHEME.HTTP.name?!1:this.scheme<e.scheme},a.prototype._hostLessThan=function(t){var e,n,r,i,o,s,u,l,h,c;if(l=a.factory(t),null==l)return!1;if(this.host===l.host)return!1;if(u=this._parentHosts().reverse(),r=l._parentHosts().reverse(),u.length!==r.length)return u.length<r.length;for(i=h=0,c=u.length;c>h;i=++h){if(o=u[i],e=r[i],s=o.split(".").length,n=e.split(".").length,s!==n)return n>s;if(o!==e)return e>o}return!1},a.prototype._queryLessThan=function(t){var e,n,r,i,o,s,u;if(r=a.factory(t),null==r)return!1;if(null==this.query&&null!=r.query)return!0;if(null==r.query)return!1;if(this.query.length!==r.query.length)return this.query.length<r.query.length;for(u=this.query,e=o=0,s=u.length;s>o;e=++o){if(n=u[e],i=r.query[e],n.key!==i.key)return n.key<i.key;if(null==n.value&&null!=i.value)return!0;if(null==i.value)return!1;if(n.value!==i.value)return n.value<i.value}return!1},a.prototype.parent=function(){var t;return null!=(t=this._queryParent())?t:null!=(t=this._pathParent())?t:this._hostParent()},a.prototype.toString=function(t){var e,n;return n="",t||null==this.scheme||(e=a.getScheme(this.scheme),n=""+e.name+s),n+=this.host,t||this.port===e.port||(n+=":"+this.port),null!=this.path&&(n+=this.path),t||null==this.query||(n+=a._queryToStr(this.query)),n},a.prototype.valueOf=function(){return this.toString()},a.prototype.toJSON=function(){return this._origUrl},a.prototype.parents=function(){var t,e;if(null!=this._parentsCache)return this._parentsCache;for(this._parentsCache=[],t=this;t;)this._parentsCache.unshift(t),t=t.parent();return(this.scheme!==a.SCHEME.HTTP.name||this.port!==a.SCHEME.HTTP.port)&&(e=a.factory(""+this.host+this.path),null!=e&&(this._parentsCache=e.parents().concat(this._parentsCache))),this._parentsCache},a.prototype.forEachParent=function(t){var e,n,r,i,o,s;for(o=this.parents(),s=[],e=r=0,i=o.length;i>r&&(n=o[e],t(n,e===parents.length-1)!==!1);e=++r)s.push(void 0);return s},a.prototype.parts=function(){var t,e,n,r,i,o,s,u,l,h,c,p,f;if(null!=this._partsCache)return this._partsCache;for(this._partsCache=[],e=this.host.split("."),i=this.path.split("/"),o=a.getScheme(this.scheme),i[0].length||i.shift(),s=0,h=e.length;h>s;s++)t=e[s],t&&this._partsCache.unshift({type:a.TYPE.HOST,part:t});for(this._partsCache.push({type:a.TYPE.SCHEME_PORT,part:this.port+"_"+o.id}),u=0,c=i.length;c>u;u++)r=i[u],r&&this._partsCache.push({type:a.TYPE.PATH,part:r});if(null!=this.query)for(f=this.query,l=0,p=f.length;p>l;l++)n=f[l],this._partsCache.push({type:a.TYPE.QUERY,part:n});return this._partsCache},a.prototype.forEachPart=function(t){var e,n,r,i,o,s;for(r=this.parts(),s=[],e=i=0,o=r.length;o>i&&(n=r[e],t(r[e],e===r.length-1)!==!1);e=++i)s.push(void 0);return s},a.prototype.cacheUrls=function(){var t,e;if(null!=this._cacheUrlsCache)return this._cacheUrlsCache;for(this._cacheUrlsCache=[],e=this;null!=e;)this._cacheUrlsCache.unshift(e),e=e._hostParent();return this.scheme!==a.SCHEME.HTTP.name&&(t=a.factory(""+this.host+this.path),null!=t&&(this._cacheUrlsCache=this._cacheUrlsCache.concat(t.cacheUrls()))),this._cacheUrlsCache},a.prototype.forEachCacheUrl=function(t){var e,n,r,i,o,s;for(n=this.cacheUrls(),s=[],r=i=0,o=n.length;o>i&&(e=n[r],t(e,r===n.length-1)!==!1);r=++i)s.push(void 0);return s},a.prototype.equals=function(t,e){var n;return n=a.factory(t),n?null==e||e?n.url===this.url:n.url.toLowerCase()===this.url.toLowerCase():!1},a.prototype.isChildOf=function(t,n){var r,i;return i=a.factory(t),r=e.find(this.parents(),function(t){return t.equals(i,n)}),null!=r},a.prototype.isCacheChildOf=function(t,e){var n,r;return r=a.factory(t),n=!1,this.forEachCacheUrl(function(t){return t.isChildOf(r,e)?(n=!0,!1):!0}),n},a.prototype.lessThan=function(t){var e;return e=a.factory(t),this.equals(e)?!1:this.host!==e.host?this._hostLessThan(e):this.scheme!==e.scheme?this._schemeLessThan(e):this.port!==e.port?this._portLessThan(e):this.path!==e.path?this.path<e.path:this._queryLessThan(e)},a}()})}.call(this),function(){var t={}.hasOwnProperty;n("zvelonet/lib/urlnode",["./lodash","./log","./url"],function(e,n,r){var i,o;return i=!0,o=function(){function o(e){var n,r,i,s,a,u,l,h;if(this._authoritative=!1,null!=e&&(null!=e.d&&(this.data=e.d),null!=e.a&&e.a&&(this._authoritative=!0),null!=e.n&&this.setExpiration(e.n),null!=e.c)){h=e.c;for(u in h)if(t.call(h,u)){i=h[u];for(s in i)t.call(i,s)&&(r=i[s],n=new o(r),n._type=function(){switch(typeof u){case"number":return u;case"string":return parseInt(u,10);default:throw new Error("UrlNode child has invalid type: "+u)}}(),n._part=s,n._parent=this,null==this._children&&(this._children={}),a=null!=(l=this._children)[u]?l[u]:l[u]={},a[s]=n)}}}return o.cacheTime=864e5,o.isUrlNode=function(t){return t instanceof o},o.prototype.unset=function(){return delete this.data,delete this._time,delete this._authoritative},o.prototype.isSet=function(){return null!=this.data&&!this.expired()},o.prototype.nodeForEach=function(e,n){var r,o,s,a,u,l,h;if(o=null!=n&&n?this:this.getRoot(),e.call(o)!==!1){l=o._children,h=[];for(u in l)t.call(l,u)&&(a=l[u],h.push(function(){var n;n=[];for(s in a)t.call(a,s)&&(r=a[s],n.push(r.nodeForEach(e,i)));return n}()));return h}},o.prototype.size=function(){var t;return t=0,this.nodeForEach(function(){return this.isSet()?t+=1:void 0}),t},o.prototype.expire=function(){var t;return t=!1,this.nodeForEach(function(){return this.expired()?(n("clearing "+this.url()+" because it has expired"),this.unset(),this.prune(i),t=!0):void 0}),t&&this.prune(),t},o.prototype.hasChildren=function(){var n,r,i;i=this._children;for(r in i)if(t.call(i,r)&&(n=i[r],!e.isEmpty(n)))return!0;return!1},o.prototype.isRoot=function(){return!(null!=this._parent||null!=this._part||null!=this._type)},o.prototype.prune=function(r){var o,s,a,u,l,h,c,p;r=null!=r&&r?!0:!1,a=r?this:this.getRoot(),h=!r,o=!1,p=a._children;for(c in p)if(t.call(p,c))if(l=p[c],e.isEmpty(l))delete a._children[c],o=!0;else for(u in l)t.call(l,u)&&(s=l[u],s.prune(i)&&(o=!0));if(a.isSet()||a.hasChildren()||a.isRoot()||(n("pruning "+a.url()),o=!0,h=!1,a.rm()),h)for(;a.prune(i););return o},o.prototype.set=function(t,i,s,a){var u,l,h;if(null==i)throw new Error("not storing url without any data: "+t);if(h=r.factory(t),!h)throw new Error("not storing invalid url: "+t);return u=this.getRoot(),s=s?!0:!1,n("storing: "+h+" (authoritative: "+s+")"),l=void 0,h.forEachPart(function(t,n){var r,h,c,p;return"string"==typeof t.part&&(t.part=t.part.toLowerCase()),u.hasChild(t)?u=u._children[t.type][t.part]:(r=new o,r._parent=u,r._part=t.part,r._type=t.type,null==u._children&&(u._children={}),h=null!=(c=u._children)[p=t.type]?c[p]:c[p]={},h[t.part]=r,u=r),n?(a||u.setExpiration(),u._authoritative=s,u.data=e.clone(i),l=u):void 0}),l},o.prototype.getRoot=function(){var t;if(null!=this._rootNode)return this._rootNode;for(t=this;!t.isRoot();)t=t._parent;return this._rootNode=t,this._rootNode},o.prototype.hasChild=function(t){var e;if(null!=this._children&&t.type in this._children&&(e=t.part.toLowerCase(),e in this._children[t.type]))return this._children[t.type][e]},o.prototype.get=function(t,e){var i,o,s;if(s=r.factory(t),!s)throw new Error("not searching for invalid url: "+t);if(n("searching for: "+s),o=this.getRoot(),i=void 0,s.forEachCacheUrl(function(t){var r;return r=o,n("  using url: "+t),t.forEachPart(function(o,a){return r=r.hasChild(o),null==r?(n("      walk break, no child: "+o.part),!1):e&&r.url().equals(s,!1)?(n("    walk found exact url: "+r.url()),i=r,!1):!e&&r.isSet()&&r.isAuthoritativeFor(s)?(n("    walk hit:  "+r.url()),i=r,!1):(n("    walk miss: "+r.url()),a?n("    walk end: "+t):void 0)}),null!=i?!1:void 0}),null==i)n("miss: "+s);else if(i.isSet())n("hit: "+i.url()+" => "+s);else{if(!e)throw new Error("unknown result for: "+s+", "+i);n("miss, returning exact url: "+i+" => "+s)}return i},o.prototype.url=function(){var t,e,n,i,o,s,a,u;if(null!=this._url)return this._url;if(!this.isRoot()){for(e=this,s=i=void 0,t=[],n=[],o=[];null!=(null!=e?e._type:void 0);){switch(e._type){case r.TYPE.HOST:t.push(e._part);break;case r.TYPE.PATH:n.unshift(e._part);break;case r.TYPE.QUERY:o.unshift(e._part);break;case r.TYPE.SCHEME_PORT:if(u=e._part.split("_"),i=u[0],a=u[1],s=r.getScheme(parseInt(a,10)),null==s)throw new Error("invalid scheme: "+e._part);s=s.name;break;default:throw new Error("unknown node type when building url: "+e._type)}e=e._parent}return this._url=r.build(s,t,i,n,o),this._url}},o.prototype.rm=function(){return null!=this._parent?delete this._parent._children[this._type][this._part]:void 0},o.prototype.toJSON=function(e){var n,r,i,o,s,a,u,l,h;i=null!=e&&e?this:this.getRoot(),a={},null!=i._authoritative&&(a.a=i._authoritative),null!=i.data&&(a.d=i.data),null!=(r=i.getExpiration())&&(a.n=r.getTime()),h=i._children;for(u in h)if(t.call(h,u)){s=h[u];for(o in s)t.call(s,o)&&(n=s[o],null==a.c&&(a.c={}),null==(l=a.c)[u]&&(l[u]={}),a.c[u][o]=n.toJSON(!0))}return a},o.prototype.valueOf=function(){return JSON.stringify(this.toJSON(i))},o.prototype.toString=o.valueOf,o.prototype.expired=function(){var t;return t=this.getExpiration(),null!=t&&new Date>=t?!0:!1},o.prototype.setExpiration=function(t){var e;return e=new Date,null!=t&&e.setTime(t-o.cacheTime),this._time=e},o.prototype.getExpiration=function(){var t;if(null!=this._time)return t=new Date,t.setTime(this._time.getTime()+o.cacheTime),t},o.prototype.isAuthoritativeFor=function(t){var e;return e=r.factory(t),null==e||null==this.url()?!1:this.url().equals(e,!1)?!0:this.isSet()&&e.isCacheChildOf(this.url(),!1)?this._authoritative:!1},o}()})}.call(this),function(){var t,e={}.hasOwnProperty;t="cache",n("zvelonet/lib/cache",["./lodash","./log","./storage","./url","./urlnode"],function(t,n,r,i,o){var s;return s=function(){function s(t){this._ns=t,this._root={},this._index="Cache",this.loaded=!1}return s.prototype._forEachMapping=function(t){var n,r,i;this.loadFromStorage(),r=this._root,i=[];for(n in r)if(e.call(r,n)){if(t.call(this,n)===!1)break;i.push(void 0)}return i},s.prototype.getRoot=function(t){var e;if(null!=t)return this.loadFromStorage(),null!=(e=this._root)?e[t]:void 0},s.prototype.clear=function(t,e){var r,o,s,a,u;if(s=this.getRoot(t),a=this.size(),null!=s&&null!=e){if(u=i.factory(e),null==u)return n("not clearing from invalid url "+e),0;o=s.get(u,!0),o&&(n("clearing urls from "+u+" in mapping "+t),o.rm(),s.prune())}else n("clearing all url cache entries"),this._root={};return r=a-this.size(),r>0&&this.write(),r},s.prototype.expire=function(t){var e;return e=!1,this._forEachMapping(function(t){return this._root[t].expire()?e=!0:n("nothing to expire for "+t)}),!t&&e&&this.write(),e},s.prototype.prune=function(){var t;return t=!1,this._forEachMapping(function(e){return this._root[e].prune()?t=!0:void 0}),t&&this.write(),t},s.prototype.write=function(){return r.write(this._index,this.toJSON(!0),this._ns)},s.prototype.toJSON=function(t){var e;return e={},this.expire(t),this._forEachMapping(function(t){return e[t]=this._root[t].toJSON()}),e},s.prototype.loadFromStorage=function(){return this.loaded?void 0:this.loadData(r.read(this._index,{},this._ns))},s.prototype.loadData=function(t){var n;this.loaded=!0,this._root={};for(n in t)e.call(t,n)&&(this._root[n]=new o(t[n]));return this.expire()},s.prototype.get=function(e,r,i){var o,s,a,u,l,h,c,p;if(u=this.getRoot(e),null!=u){if(!Array.isArray(r))return u.get(r,i);if(r.length){if(h=t.uniq(r),1===t.size(h))return this.get(e,h[0],i);for(a={hit:{},miss:[],bulk:!0},c=0,p=h.length;p>c;c++)l=h[c],o=this.get(e,l,i),(null!=o?o.isSet():void 0)?a.hit[l]=o:a.miss.push(l);return t.isEmpty(a.hit)?n("bulk cache miss 0/"+h.length):(s=t.size(a.hit),n(s===h.length?"bulk cache hit "+s+"/"+h.length:"bulk cache partial hit "+s+"/"+h.length),a)}}},s.prototype.size=function(t){var e,n;return null!=t?(n=this.getRoot(t),null==n?0:n.size()):(e=0,this._forEachMapping(function(t){return e+=this._root[t].size()}),e)},s.prototype.set=function(t,e,n,r){return this.getRoot(t)||(this._root[t]=new o),this.getRoot(t).set(e,n,r)},s.prototype.getMappings=function(){var t;return t=[],this._forEachMapping(function(e){return t.push(e)}),t},s.prototype.setExpiration=function(t,e){var r,o;if(null!=t&&(o=i.factory(t),null!=o))return r=!1,this._forEachMapping(function(t){var n,i;return i=this.getRoot(t),null!=i&&(n=i.get(o))?(n.setExpiration(e),r=!0):void 0}),r&&(n("writing after change in expiration"),this.write()),r},s}()})}.call(this),function(){var t,e,r={}.hasOwnProperty;t=["Msxml2.XMLHTTP","Msxml3.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],e=function(){var e,n,r;for(e=r=0;3>=r;e=++r)try{return e?(n=t[e-1],new ActiveXObject(""+n+".XMLHTTP")):new XMLHttpRequest}catch(i){}},n("zvelonet/lib/ajax",["when"],function(t){var n;return n=function(){function n(e){var n,r;if(null!=e)switch(typeof e){case"string":this.url=e;break;case"object":this.url=e.url,this.data=e.data,this.dataType=e.dataType,this.async=e.async,this.timeout=e.timeout,this.method=e.method,this.cache=e.cache}try{if(null==this.url)throw new Error("url is required");this._setDefaults(),this._validateDataType(),n=t.defer(),this._resolver=n.resolver,this.ready=n.promise,this._prep(),"jsonp"===this.dataType?this._execJsonp():this._execXhr()}catch(i){r=i,this._error("Caught: "+r.message)}}return n.prototype._setDefaults=function(){return"string"==typeof this.method&&(this.method=this.method.toUpperCase()),null==this.method&&(this.method="GET"),null==this.async&&(this.async=!0),null==this.dataType&&(this.dataType="json"),null==this.timeout&&(this.timeout=0),null!=this.cache?this.cache:this.cache=!0},n.prototype._validateDataType=function(){if("text"!==this.dataType&&"json"!==this.dataType&&"jsonp"!==this.dataType)throw new Error("invalid dataType: "+this.dataType)},n.prototype._validateMethod=function(){if("GET"!==this.method)throw new Error("TODO(jrubin) method is not yet implemented: "+this.method)},n.prototype._appendQuery=function(t){return this._queryUrl=(""+this._queryUrl+"&"+t).replace(/[&?]{1,2}/,"?")},n.prototype._prep=function(){var t;return this._queryUrl=this.url,this.cache||this._appendQuery("_="+Date.now()),null!=this.data?(t=n.serialize(this.data).join("&"),"GET"===this.method?this._appendQuery(t):this._queryData=t):void 0},n.serialize=function(t,e,i){var o,s,a;null==e&&(e=[],e.add=function(t,e){return this.push(""+encodeURIComponent(t)+"="+encodeURIComponent(e))}),o=Array.isArray(t);for(s in t)if(r.call(t,s))switch(a=t[s],null!=i&&(s=""+i+"["+(o?"":s)+"]"),typeof a){case"array":case"object":n.serialize(a,e,s);break;default:e.add(s,a)}return e},n.prototype._error=function(t){return this._resolver.reject("Ajax: "+t)},n.prototype._success=function(t){var e,n;switch(this.dataType){case"text":case"jsonp":e=t;break;case"json":try{e=JSON.parse(t)}catch(r){return n=r,void this._error("JSON parse error: "+n.message,t)}break;default:throw new Error("unexpected dataType: "+this.dataType)}return this._resolver.resolve(e)},n.prototype._execJsonp=function(){var t,e,n,r,i,o,s,a;if("undefined"==typeof window||null===window||"undefined"==typeof document||null===document)throw new Error("JSONP is not supported on your platform");return s=Math.round(1000001*Math.random()),n="jsonp"+s,this._appendQuery("callback="+n),a=document.createElement("script"),a.setAttribute("src",this._queryUrl),o=document.getElementsByTagName("head")[0],i=function(){clearTimeout(e);try{o.removeChild(a)}catch(t){}window[n]=void 0;try{return delete window[n]}catch(t){}},t=function(t){return null==t&&(t="abort"),i(),"timeout"===t&&(window[n]=function(){}),this._error(t)},r=function(t){return i(),this._success(t)},window[n]=r.bind(this),a.onerror=t.bind(this,"error"),o.appendChild(a),this.timeout>0?e=setTimeout(t.bind(this,"timeout"),this.timeout):void 0},n.prototype._execXhr=function(){var t,n,i,o,s,a,u;if(u=e(),t=function(){return u.onreadystatechange=function(){},u.abort(),this._error("timeout")},this.timeout>0&&(n=setTimeout(t.bind(this),this.timeout)),null==u)throw new Error("could not create xhr");u.open(this.method,this._queryUrl,this.async),i={"X-Requested-With":"XMLHttpRequest"},"GET"!==this.method&&(i["Content-Type"]="application/x-www-form-urlencoded"),i.Accept=function(){switch(this.dataType){case"text":return"text/plain";case"json":return"application/json";default:throw new Error("unexpected dataType: "+this.dataType)}}.call(this);for(o in i)r.call(i,o)&&(a=i[o],u.setRequestHeader(o,a));if(s=function(){return 4===u.readyState?(u.onreadystatechange=function(){},clearTimeout(n),200===u.status?this._success(u.responseText):this._error("status: "+u.status,u)):void 0},!this.async)throw new Error("TODO(jrubin) sync is not yet implemented");return u.onreadystatechange=s.bind(this),u.send(this._queryData)},n}(),function(t){return new n(t).ready}})}.call(this),function(){var t,e,r;r=864e5,t=r,e="https://dl.zvelo.com",n("zvelonet/lib/dlfile",["when","./log","./ajax","./url"],function(n,r,i,o){var s;return s=function(){function s(e,r){var i,o,s,a,u;this.filename=e,this._zn=r,o=n.defer(),this._resolver=o.resolver,this.ready=o.promise;try{if(!(null!=(a=this.filename)?a.length:void 0))throw new Error("filename is required");this._index="DLFile."+this.filename,this._expireDuration=null!=(u=this._zn.fileExpireDuration)?u:t,this._genUrl(),this._genData(),i=this._read(),null!=i&&(this.value=i.value,this.storedAt=i.storedAt),this.expired()?this._fetch():this._resolve()}catch(l){s=l,this._reject("Caught: "+s.message)}}return s.prototype._genFormat=function(){return this.dataType=this._zn.forceXHR?"json":"jsonp"},s.prototype._genUrl=function(){var t,n;if(t=o.hostUrl(null!=(n=this._zn.dlhost)?n:e),null==t)throw new Error("invalid dlhost: "+this._zn.dlhost);return this.url=""+t+this.filename},s.prototype._genData=function(){var t,e;if(!((null!=(t=this._zn.username)?t.length:void 0)&&(null!=(e=this._zn.password)?e.length:void 0)))throw new Error("username and password are required");return null==this.data&&(this.data={}),this.data.format=this._genFormat(),this.data.username=this._zn.username,this.data.password=this._zn.password},s.prototype._read=function(){return this._zn._read(this._index)},s.prototype._write=function(t){return this._zn._write(this._index,t)},s.prototype._delete=function(){return this._zn._delete(this._index)},s.prototype.expired=function(){var t,e,n;return null==this.value||null==this.storedAt?!0:(e=Date.now()-this.storedAt,n=e>this._expireDuration,n?r(""+this.filename+" has expired, fetching another"):(t=Math.round((this._expireDuration-e)/1e3),r(""+this.filename+" expires in "+t+" seconds")),n)},s.prototype._resolve=function(){return this._resolver.resolve(this)},s.prototype._reject=function(t){var e;return e="DLFile: Error fetching "+this.filename,null!=t&&(e+=": "+t),this._resolver.reject(e)},s.prototype._fetch=function(){return r("AJAX: fetching "+this.filename),i(this).then(this._store.bind(this)).otherwise(this._reject.bind(this))},s.prototype._store=function(t,e,n){return(null!=t?t.success:void 0)?(this.value=t[this.filename],this.storedAt=Date.now(),this._write({value:this.value,storedAt:this.storedAt}),this._resolve()):this._reject(n)},s.prototype["delete"]=function(){return delete this.value,delete this.storedAt,this._delete()},s}()})}.call(this),function(){n("hashmash/lib/sha1",[],function(){var t,e,n,r,i,o,s;return t=function(t,e){return t<<e|t>>>32-e},r=function(t){var e,n,r,i;for(n="",e=i=7;i>=0;e=--i)r=t>>>4*e&15,n+=r.toString(16);return n},e=function(t,e,n,r){switch(t){case 0:return e&n^~e&r;case 1:return e^n^r;case 2:return e&n^e&r^n&r;case 3:return e^n^r}},o=function(n){var i,o,s,a,u,l,h,c,p,f,d,g,y,v,m,_,b,w,E,x,T,k,C,S,j,M,A,O,R;for(l=[1518500249,1859775393,2400959708,3395469782],n+=String.fromCharCode(128),E=n.length/4+2,c=Math.ceil(E/16),h=[],b=k=0,O=c-1;O>=0?O>=k:k>=O;b=O>=0?++k:--k)for(h[b]=[],w=C=0;15>=C;w=++C)h[b][w]=n.charCodeAt(64*b+4*w+0)<<24|n.charCodeAt(64*b+4*w+1)<<16|n.charCodeAt(64*b+4*w+2)<<8|n.charCodeAt(64*b+4*w+3)<<0;for(f=4294967296,h[c-1][14]=8*(n.length-1)/f,h[c-1][14]=Math.floor(h[c-1][14]),h[c-1][15]=8*(n.length-1)&4294967295,i=1732584193,o=4023233417,s=2562383102,a=271733878,u=3285377520,d=[],b=S=0,R=c-1;R>=0?R>=S:S>=R;b=R>=0?++S:--S){for(T=j=0;15>=j;T=++j)d[T]=h[b][T];for(T=M=16;79>=M;T=++M)d[T]=t(d[T-3]^d[T-8]^d[T-14]^d[T-16],1);for(g=i,y=o,v=s,m=a,_=u,T=A=0;79>=A;T=++A)x=Math.floor(T/20),p=t(g,5)+e(x,y,v,m)+_+l[x]+d[T]&4294967295,_=m,m=v,v=t(y,30),y=g,g=p;i=i+g&4294967295,o=o+y&4294967295,s=s+v&4294967295,a=a+m&4294967295,u=u+_&4294967295}return r(i)+r(o)+r(s)+r(a)+r(u)},i=function(t){var e,n,r,i,o;for(n=0,r=i=0,o=t.length-1;(o>=0?o>=i:i>=o)&&(e=parseInt(t[r],16),!isNaN(e));r=o>=0?++i:--i){switch(!1){case 0!==e:n+=4;break;case 1!==e:n+=3;break;case!(e>=2&&3>=e):n+=2;break;case!(e>=4&&7>=e):n+=1}if(0!==e)break}return n},s=function(t){var e,n;return e=""+t.challenge+":"+t.counter,n=o(e),i(n)>=t.bits?(t.result=e,!0):(t.counter+=1,!1)},n=function(t){return o(t)},n.leading0s=function(t){return i(t)},n.tryChallenge=function(t){return s(t)},n})}.call(this),function(){n("hashmash/lib/hashmash",["when","./sha1"],function(t,e){var n,r,i;return r=function(t){return"string"==typeof t?6!==t.length?null:t:"number"!=typeof t?null:r(""+t)},i=function(t,e){return e.start=e.end+1,e.start===t.length?!1:(e.end=t.indexOf(":",e.start),-1===e.end?!1:e.end===e.start?!1:!0)},n=function(){function n(t,e,r){var i,o;this._bits=t,this._bits<n.MIN_BITS&&(this._bits=n.MIN_BITS),this._workers=[],this._range={},this._resetRange(),i=n.TaskMaster,null==e&&null!=n.BackupTaskMaster&&(i=n.BackupTaskMaster),r=null!=r?Math.min(r,i.MAX_NUM_WORKERS):i.DEFAULT_NUM_WORKERS,r&&(this._workers=function(){var t,n;for(n=[],o=t=1;r>=1?r>=t:t>=r;o=r>=1?++t:--t)n.push(new i(this._range,e));return n}.call(this))}return n.VERSION=1,n.MIN_BITS=16,n.hash=e,n.date=function(){var t,e,n,r;return n=new Date,r=("0"+(n.getYear()-100)).slice(-2),e=("0"+(n.getMonth()+1)).slice(-2),t=("0"+n.getDate()).slice(-2),""+r+e+t},n.parse=function(t){var e,n,r;return null==t?null:(n={},r={start:0,end:-1,length:function(){return this.end-this.start}},i(t,r)?(n.version=parseInt(t.substr(r.start,r.length()),10),isNaN(n.version)?null:i(t,r)?(n.bits=parseInt(t.substr(r.start,r.length()),10),isNaN(n.bits)?null:i(t,r)?(n.date=parseInt(t.substr(r.start,r.length()),10),isNaN(n.date)?null:i(t,r)?(n.resource=t.substr(r.start,r.length()),n.resource.length&&i(t,r)?(n.rand=t.substr(r.start,r.length()),n.rand.length?(i(t,r),e=(-1===r.end?t.length:r.end)-r.start,n.counter=parseInt(t.substr(r.start,e),10),isNaN(n.counter)?null:n):null):null):null):null):null):null)},n.unparse=function(t){var e,n;return n="",null==t.version?n:(n+=""+t.version+":",null==t.bits?n:(n+=""+t.bits+":",null==t.date?n:(e=r(t.date),null==e?n:(n+=""+e+":",null==t.resource?n:(n+=""+t.resource+":",null==t.rand?n:(n+=t.rand,null==t.counter?n:n+=":"+t.counter))))))},n.prototype._resetRange=function(){return this._range={begin:0,end:-1}},n.prototype._sendData=function(t,e){var n,r,i,o,s;for(o=this._workers,s=[],r=0,i=o.length;i>r;r++)n=o[r],s.push(n.sendData(t,e));return s},n.prototype.stop=function(){var t,e,n,r,i;for(r=this._workers,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t.stop());return i},n.prototype.generate=function(e){var r,i,o,s,a,u;this._resetRange(),u=t.defer(),a=u.resolver,s=u.promise,o={version:n.VERSION,bits:this._bits,date:n.date(),resource:e,rand:Math.random().toString(36).substr(2)},r={challenge:n.unparse(o),counter:0,bits:o.bits};try{this._sendData(a,r)}catch(l){i=l,a.reject(i)}return s.ensure(this.stop.bind(this)),s},n.prototype.validate=function(t){var r,i;if(null!=t&&"string"==typeof t&&null!=this._bits&&(r=n.parse(t),null!=r&&!(r.bits<this._bits||r.bits<n.MIN_BITS||r.version!==n.VERSION||(i=n.date(),r.date<i-1||r.date>i+1||!(e.leading0s(n.hash(t))>=r.bits)))))return r},n}()})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};n("hashmash/lib/taskmaster",["./sha1"],function(t){var n,r,i,o,s,a;return n=99,r=1,a={},i=function(){function t(t){this._range=t,this._sendQueue=[],this._ready=!1}return t.RANGE_INCREMENT=Math.pow(2,15),t.prototype._send=function(t){return this._spawn(),null!=this.sendFn?this._ready?this.sendFn(t):this._sendQueue.push(t):void 0},t.prototype._setGo=function(){var t;for(this._ready=!0,t=[];this._sendQueue.length;)t.push(this._send(this._sendQueue.shift()));return t},t.prototype._spawn=function(){return null==this.worker?this.connect():void 0},t.prototype._incRange=function(){return this._range.begin=this._range.end+1,this._range.end=this._range.begin+t.RANGE_INCREMENT-1},t.prototype._sendRange=function(){return this._incRange(),this._send({m:"range",range:this._range})},t.prototype._gotResult=function(t){if(null==t)throw new Error("TaskMaster expected a result");if(null==this._resolver)throw new Error("TaskMaster requires a resolver");return this._resolver.resolve(t)},t.prototype._gotMessage=function(t){if(null!=(null!=t?t.m:void 0))switch(t.m){case"ready":return this._setGo();case"request_range":return this._sendRange();case"result":return this._gotResult(t.result)}},t.prototype.sendData=function(t,e){if(this._resolver=t,null==this._resolver)throw new Error("TaskMaster requires a resolver");return this._send({m:"data",data:e})},t.prototype.stop=function(){return this._ready=!1,this._sendQueue.length=0,null!=this.worker?(this.disconnect(),delete this.worker,delete this.sendFn):void 0},t}(),a.TaskMaster=i,s=function(t){function n(t,e){this.file=e,n.__super__.constructor.call(this,t)}return e(n,t),n.MAX_NUM_WORKERS=8,n.DEFAULT_NUM_WORKERS=4,n.prototype.connect=function(){var t;return this.worker=new Worker(this.file),t=this,this.worker.onmessage=function(e){return t._gotMessage(e.data)},this.worker.onerror=function(t){throw t.data},this.sendFn=function(t){return this.worker.postMessage(t)}},n.prototype.disconnect=function(){return this.worker.terminate()},n}(i),a.WebTaskMaster=s,o=function(){function e(){}return e.MAX_NUM_WORKERS=1,e.DEFAULT_NUM_WORKERS=1,e.prototype.sendData=function(t,e){if(this._resolver=t,this._data=e,null==this._resolver)throw new Error("TaskMaster requires a resolver");return delete this._stopFlag,this.start()},e.prototype.start=function(){var e,i;for(i=new Date;!(null!=this._stopFlag||null!=this._data.result||new Date-i>=n);)t.tryChallenge(this._data);if(null==this._stopFlag){if(null!=this._data.result){if(null==this._resolver)throw new Error("TaskMaster requires a resolver");return this._resolver.resolve(this._data.result)}return e=this,setTimeout(function(){return e.start()},r)}},e.prototype.stop=function(){return this._stopFlag=!0},e}(),a.TimeoutTaskMaster=o,a})}.call(this),function(){n("hashmash/hashmash",["./lib/hashmash","./lib/taskmaster"],function(t,e){var n=e.WebTaskMaster,r=e.TimeoutTaskMaster;return window.Worker?(t.TaskMaster=n,t.BackupTaskMaster=r):t.TaskMaster=r,t})}(),n("hashmash",["hashmash/hashmash"],function(t){return t}),function(){var t={}.hasOwnProperty;n("zvelonet/lib/cacheurl",["./lodash","./url"],function(e,n){var r;return r=function(){function r(t){if(this._cache=t,null==this._cache)throw new Error("Invalid cache object")}return r.prototype._rebuildCacheResult=function(t,n,r,i){var o,s,a,u,l;if(null!=r){if(null!=r.bulk)return this._rebuildBulkCacheResult(t,r,i);if(null!=(null!=(a=r.data)?a.c:void 0))return o=r.url().url,s={c:e.clone(r.data.c),m:t,u:n,b:r.data.b,fromCache:!0},(null!=i&&null!=(u=i.data)&&null!=(l=u.c)?l.length:void 0)&&(s.r=i.data.c[0]),s}},r.prototype._rebuildBulkCacheResult=function(n,r,i){var o,s,a,u,l,h;u={k:!0,m:n,hit:[],miss:r.miss},h=r.hit;for(l in h)t.call(h,l)&&(a=h[l],null==i||(s=e.find(i.hit,function(t,e){return l===e}),null!=s)?(o=this._rebuildCacheResult(n,l,a,s),null==o&&u.repMiss.push(l),delete o.m,u.hit.push(o)):u.repMiss.push(l));return u},r.prototype._parseCacheBase=function(t){var e,r,i,o;return r=t.b,e=!0,"."===(null!=r?r[0]:void 0)&&(e=!1,r=r.slice(1)),o=n.factory(r),i=n.factory(t.u),{url:o,authoritative:e,queried:i,cacheQueriedUrl:!e&&!o.equals(i)}},r.prototype._saveOne=function(t){var n,r,i,o;return r=t.m,(null!=t&&null!=(o=t.c)?o.length:void 0)?(n=this._parseCacheBase(t),i=this._cache.set(r,n.url,{c:e.clone(t.c),b:t.b},n.authoritative),n.cacheQueriedUrl&&this._cache.set(r,n.queried,{c:e.clone(t.c),b:t.b},!1),null!=t.r&&(t=e.clone(t),t.m="reputation",t.c=[t.r],delete t.r,this._saveOne(t)),i):!1},r.prototype.save=function(t){var n,r,i,o,s,a,u;if(null!=t.k){for(o=!1,n=t.m,u=t.k,s=0,a=u.length;a>s;s++)r=u[s],r.fromCache||(o=!0,i=e.clone(r),i.m=n,this._saveOne(i));if(o)return this._cache.write()}else if(!t.fromCache){if(t.fromCache)return;return this._saveOne(t),this._cache.write()}},r.prototype.lookup=function(t,e){var n,r;return r=this._cache.get(e.m,t),null==r||e.r&&(n=this._cache.get("reputation",t),null==n)?void 0:this._rebuildCacheResult(e.m,t,r,n)},r}()})}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t,e,n){return t[n]=t[e],delete t[e]
},n("zvelonet/lib/znajax",["when","hashmash","./lodash","./ajax","./url","./cacheurl"],function(n,r,i,o,s,a){var u;return u=function(){function u(t,e,n){var r;this.zn=e,this._cache=n;try{this._setup(),this.configure(t),this.execute()}catch(i){r=i,this.reject(r.message)}}return u.pending={},u.prototype._setup=function(){var t;return t=n.defer(),this._resolver=t.resolver,this.complete=t.promise},u.prototype.configure=function(t){switch(typeof t){case"string":this._url=t;break;case"object":this.url=t.url,this.onHashMash=t.onHashMash,this.onAjax=t.onAjax,this.mapping=t.mapping,this.reputation=t.reputation,this.categoryIds=t.categoryIds,this.sync=t.sync,null!=this.url&&(this._url=this.url,delete this.url)}if(null!=this.zn.timeout&&(this.timeout=this.zn.timeout),"string"==typeof this._url){if(!this._url.length||!s.factory(this._url))throw new Error("invalid url: "+this._url)}else{if(!Array.isArray(this._url))throw new Error("invalid url: "+this._url);if(!this._url.length)throw new Error("invalid url: "+this._url);this._url=i.uniq(this._url),1===this._url.length&&(this._url=this._url[0])}return null!=this.data?this.data:this.data={}},u.prototype._checkCache=function(){var t;return this._cache&&null!=this.zn.cache?(this._cacheUrl=new a(this.zn.cache),t=this._cacheUrl.lookup(this._url,this.data),null==t?!1:Array.isArray(this._url)?t.miss.length?(t.hit.length&&(this._cacheHit=t.hit),this._url=t.miss,!1):(this._done({k:t.hit,m:this.data.m,s:!0}),!0):(this._done(t),!0)):!1},u.checkPending=function(t){var e;if("string"==typeof t._url)return e=u.pending[t._url],(null!=e?e.m:void 0)===t.mapping&&(null!=e?e.r:void 0)===t.reputation&&i.isEqual(null!=e?e.c:void 0,t.categoryIds)?e.p:void(null==e&&(u.pending[t._url]={m:t.mapping,r:t.reputation,c:t.categoryIds,p:t.complete},t.complete.ensure(function(){return delete u.pending[t._url]})))},u.prototype.execute=function(){var t,e,n;if(!this._checkCache()){if(n=u.checkPending(this),null!=n)return this.complete=n;try{if(null!=this.zn.serial){if(!this.zn["dia.key"])throw new Error("missing dia.key");return this._ready()}if(Array.isArray(this._url))throw new Error("bulk lookup not allowed for hashmash");return null!=this.onHashMash&&this.onHashMash(),e=new r(this.zn.hashMashBits,this.zn.hashMashWorker),e.generate(encodeURIComponent(this._url)).then(this._ready.bind(this)).otherwise(this.reject.bind(this))}catch(i){return t=i,this.reject(t.message)}}},u.prototype._ready=function(t){if(this._genUrl(),this._genFormat(),null!=this.zn.serial)this.data.u=this._url;else{if(null==t)throw new Error("Unknown error");this.data.h=t}return this.zn.ready.then(this._doAjax.bind(this)).otherwise(this.reject.bind(this))},u.prototype._genFormat=function(){return this.dataType=this.zn.forceXHR?"json":"jsonp"},u.prototype._genUrl=function(){var t;if(t=s.hostUrl(this.zn.znhost),null==t)throw new Error("Invalid zveloNET host: "+this.zn.znhost);return this.url=""+t+this.ZN_PATH,null!=this.zn.serial?this.url+="/"+this.zn["dia.key"]+"/"+this.zn.serial:void 0},u.prototype._doAjax=function(){return null!=this.onAjax&&this.onAjax(),o(this).then(this._done.bind(this)).otherwise(this.reject.bind(this))},u.RENAMES={k:"bulk",u:"url",c:"categories",b:"cacheBase",m:"mapping",r:"reputationId"},u.rename=function(n){var r,i,o,s;o=u.RENAMES,s=[];for(r in o)e.call(o,r)&&(i=o[r],null!=n[r]&&s.push(t(n,r,i)));return s},u.decodeCategoryIds=function(t,e){var n,r,i,o,s,a,l,h,c,p,f,d;if(null==e)return t;if(null!=t.k){for(n=[],c=t.k,s=0,l=c.length;l>s;s++)r=c[s],n.push(u.decodeCategoryIds(r,e));return t.k=n,t}if(null!=t.c){for(o={},p=t.c,a=0,h=p.length;h>a;a++)i=p[a],o[i]=null!=(f=e[i])?f.name:void 0;t.c=o}return null!=t.r&&(t.reputation=null!=(d=e[t.r])?d.name:void 0),t},u.prototype._done=function(t,e,n){var r,o,s,a,l;if(!((null!=t?t.s:void 0)||(null!=t?t.fromCache:void 0)))return this.reject(n,e,t.m);if(delete t.s,null!=this._cacheUrl&&this._cacheUrl.save(t),null!=this._cacheHit&&(null!=t.k?t.k=i.union(this._cacheHit,t.k):(r=t.m,delete t.m,this._cacheHit.push(t),t={k:this._cacheHit,m:r})),u.decodeCategoryIds(t,this.zn["categories.txt"]),null!=t.k)for(l=t.k,s=0,a=l.length;a>s;s++)o=l[s],u.rename(o);return u.rename(t),this.resolve(t)},u.prototype.resolve=function(t){return this._resolver.resolve(t,this)},u.prototype.reject=function(t,e,n){var r,i;return null!=(null!=t?t.status:void 0)&&(r=t.status),i='Error with url: "'+this._url+'"',null!=n&&(i+=": "+n),null!=r&&(i+=" (code: "+r+")"),null!=t&&(i+=", "+t),this._resolver.reject(i,r)},u}()})}.call(this),function(){var t,e={}.hasOwnProperty,r=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};t=!0,n("zvelonet/lib/lookup",["./znajax"],function(e){var n;return n=function(e){function n(e,r){n.__super__.constructor.call(this,e,r,t)}return r(n,e),n.prototype.ZN_PATH="l",n.prototype._validateMapping=function(){var t;if(null==this.mapping&&(this.mapping=this.zn.defaultMapping),-1===(null!=(t=this.zn)?t.mappings.indexOf(this.mapping):void 0))throw new Error("Invalid mapping: "+this.mapping);return this.mapping},n.prototype.configure=function(t){return n.__super__.configure.call(this,t),this.data.m=this._validateMapping(),this.reputation?this.data.r=!0:void 0},n}(e)})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};n("zvelonet/lib/report",["./znajax"],function(t){var n;return n=function(t){function n(t,e){n.__super__.constructor.call(this,t,e)}return e(n,t),n.prototype.ZN_PATH="r",n.prototype.configure=function(t){if(n.__super__.configure.call(this,t),"string"!=typeof this._url)throw new Error("invalid url: "+this._url);if(!Array.isArray(this.categoryIds)||!this.categoryIds.length)throw new Error("invalid category ids => "+this.categoryIds);return this.data.c=this.categoryIds},n}(t)})}.call(this),function(){var t={}.hasOwnProperty;n("zvelonet/lib/zvelonet",["when","./semver","./log","./storage","./cache","./url","./dlfile","./lookup","./report"],function(e,n,r,i,o,s,a,u,l){var h;return h=function(){function s(t){var e;try{this._setup(),this._configure(t),this._init()}catch(n){e=n,this._reject(e.message)}}return s.VERSION="3.0.0",s.prototype._setup=function(){var t;return t=e.defer(),this._resolver=t.resolver,this.ready=t.promise},s.prototype._configure=function(t){return"object"==typeof t&&(this.namespace=t.namespace,this.znhost=t.znhost,this.dlhost=t.dlhost,this.fileExpireDuration=t.fileExpireDuration,this.defaultMapping=t.defaultMapping,this.timeout=t.timeout,this.forceXHR=t.forceXHR,this.useCache=t.useCache,this.sync=t.sync,this.hashMashBits=t.hashMashBits,this.hashMashWorker=t.hashMashWorker,this.username=t.username,this.password=t.password,this.serial=t.serial),null==this.dlhost&&delete this.dlhost,null==this.fileExpireDuration&&delete this.fileExpireDuration,null==this.namespace&&(this.namespace="zvelo.net"),null==this.znhost&&(this.znhost="https://query.zvelo.com"),null==this.defaultMapping&&(this.defaultMapping="zvelodb-v3"),null==this.timeout&&(this.timeout=5e3),null==this.forceXHR&&(this.forceXHR=!1),null==this.useCache&&(this.useCache=!0),null==this.sync&&(this.sync=!1),null==this.hashMashBits&&(this.hashMashBits=18),this.version=s.VERSION,this.useCache?this.cache=new o(this.namespace):delete this.cache},s.prototype._read=function(t,e){return i.read(t,e,this.namespace)},s.prototype._write=function(t,e){return i.write(t,e,this.namespace)},s.prototype._delete=function(t){return i["delete"](t,this.namespace)},s.prototype._init=function(){return this._updateVersion(),e.all(this._loadFiles()).then(this._resolve.bind(this)).otherwise(this._reject.bind(this))},s.prototype._resolve=function(){return r("zvelo.net ready"),this._resolver.resolve(this)},s.prototype._reject=function(t){return r("zvelo.net could not be initialized",t),this._resolver.reject()},s.prototype._updateVersion=function(){var t,e;if(t=this._read("VERSION"),null!=t)switch(e=n.compare(t,s.VERSION),!1){case 0!==e:return r("welcome back to zvelo.net! you haven't changed a bit!"),!1;case!(e>0):return r("You have been cheating on me with another zvelo.net!I don't know what to do with myself!"),!1;case!(0>e):r("welcome back to zvelo.net! It looks like we have some catching up to do...")}return this._write("VERSION",s.VERSION),this.clearCache(),r("now that you have been reacquainted with zvelo.net, lets get to work..."),!0},s.prototype._loadFile=function(t){var e;return null==this._files&&(this._files={}),e=new a(t,this),this._files[t]=e,e.ready.then(function(e){return this[t]=e.value}.bind(this)),e.ready},s.prototype._loadFiles=function(){var t;return t=[this._loadFile("mappings"),this._loadFile("categories.txt")],null!=this.serial&&t.push(this._loadFile("dia.key")),t},s.prototype.clearFiles=function(e){var n;return n=function(){var e,n,r;r=this._files;for(n in r)t.call(r,n)&&(e=r[n],e["delete"](),delete this._files[n],delete this[n]);return delete this._files},this.ready.ensure(n.bind(this)),null!=e&&e?void 0:this.reinit()},s.prototype.reinit=function(){var t;return t=this.ready,this._setup(),t.then(this._init.bind(this)),this.ready},s.prototype.clearCache=function(){var t;return null!=(t=this.cache)?t.clear():void 0},s.prototype.expireCache=function(){var t;return null!=(t=this.cache)?t.expire():void 0},s.prototype.lookup=function(t){return new u(t,this).complete},s.prototype.report=function(t){return new l(t,this).complete},s.categorySort=function(t){var e,n,r;n=[];for(e in t)r=t[e],n.push(r);return n.sort(function(t,e){return t.name===e.name?0:t.name<e.name?-1:1}),n},s.prototype.setSerial=function(t){return this.serial=t,this.reinit()},s}()})}.call(this),function(){n("zvelonet/zvelonet",["./lib/zvelonet"],function(t){return t})}(),n("zvelonet",["zvelonet/zvelonet"],function(t){return t}),function(){n("event",[],function(){var t;return t=function(){function t(){}return t.ONCE=!0,t.prototype.on=function(e,n,r){var i;if(null!=e&&null!=n)return null==this._events&&(this._events={}),null==(i=this._events)[e]&&(i[e]={all:[],once:[]}),r===t.ONCE?this._events[e].once.push(n):this._events[e].all.push(n),this},t.prototype.off=function(t,e){var n,r,i,o;if(null!=t&&null!=e&&null!=(null!=(o=this._events)?o[t]:void 0))return n=this._events[t].all,i=this._events[t].once,(r=null!=i?i.indexOf(e):void 0)>-1&&i.splice(r,1),(r=null!=n?n.indexOf(e):void 0)>-1&&n.splice(r,1),this},t.prototype.trigger=function(t){var e,n,r,i,o,s,a,u,l;if(null!=t&&null!=this._events&&null!=(null!=(a=this._events)?a[t]:void 0)){for(e=Array.prototype.slice.call(arguments,1),u=this._events[t].all,r=0,o=u.length;o>r;r++)n=u[r],n.apply(this,e);for(l=this._events[t].once,i=0,s=l.length;s>i;i++)n=l[i],n.apply(this,e);return this._events[t].once=[],this}},t}()})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};n("modal",["templates","event","element"],function(t,n,r){var i;return i=function(i){function o(e){this.ctx=e,this._configure(),this.el=r(t.modal(this.ctx)),this.el.animate(this.el.hasClass("fade")),this.on("backdrop shown",this._onBackdropShown.bind(this)),this.on("modal shown",this._onModalShown.bind(this)),this.on("modal hidden",this._onModalHidden.bind(this)),this.on("backdrop hidden",this._onBackdropHidden.bind(this))}return e(o,i),o.hideCurrent=function(t){return null==o.current&&"hidden"!==o.status?(null!=t&&t(),!1):(null!=t&&o.current.on("hidden",t,n.ONCE),o.current.hide(),!0)},o.prototype._configure=function(){return null!=this.ctx?this.ctx:this.ctx={}},o.prototype._showBackdrop=function(){return"showing"===this.status?(this.backdrop=r("<div>",this.el.animate()).addClass("modal-backdrop"),this.el.animate()&&this.backdrop.addClass("fade"),r(document.body).append(this.backdrop),this.ctx.close&&this.backdrop.on("click",this.hide.bind(this)),this.backdrop.reflow().addClass("in",this.trigger.bind(this,"backdrop shown"))):void 0},o.prototype._hideBackdrop=function(){return"hiding"===this.status&&null!=this.backdrop?this.backdrop.removeClass("in",this.trigger.bind(this,"backdrop hidden")):void 0},o.prototype._setStatus=function(t){return"hiding"!==this.status||"showing"!==t&&"shown"!==t?(this.status=t,this.trigger(t),!0):!1},o.prototype.setHeader=function(t){return this.el.find("h3").html(t),this},o.prototype.setBody=function(t){return this.el.find("p").html(t),this},o.prototype.show=function(){var t;return"shown"===(t=this.status)||"showing"===t?this:this._setStatus("showing")?(o.hideCurrent(this._show.bind(this)),this):this},o.prototype._show=function(){var t;if(null==o.current)return o.current=this,t=this,this.ctx.close&&(this.onKeyUp=function(e){return 27===e.which?t.hide():void 0},r(document.body).on("keyup",this.onKeyUp)),r(document.body).append(this.el),this._showBackdrop()},o.prototype._onBackdropShown=function(){return"showing"===this.status?(this.el.display("block").reflow(),this.ctx.btn&&this.el.find(".btn.btn-primary").on("click",this.hide.bind(this)),this.ctx.close&&this.el.find(".close").on("click",this.hide.bind(this)),this.el.addClass("in",this.trigger.bind(this,"modal shown"))):void 0},o.prototype._onModalShown=function(){return setTimeout(this._setStatus.bind(this,"shown"),1)},o.prototype._onBackdropHidden=function(){return this._removeBackdrop(),setTimeout(this._setStatus.bind(this,"hidden"),1)},o.prototype._onModalHidden=function(){return r(document.body).remove(this.el.display("none")),this._hideBackdrop()},o.prototype.hide=function(){if("showing"===this.status)return this.on("shown",this.hide.bind(this),n.ONCE);if("shown"===this.status)return this._setStatus("hiding"),this.el.removeClass("in",this.trigger.bind(this,"modal hidden")),this},o.prototype._removeBackdrop=function(){var t;return t=r(document.body),null!=this.onKeyUp&&t.off("keyup",this.onKeyUp),null!=this.backdrop&&t.remove(this.backdrop),o.current===this&&delete o.current,delete this.backdrop,null!=this.ctx.onClose?this.ctx.onClose(this):void 0},o.prototype.toggle=function(){var t;return"shown"===(t=this.status)||"showing"===t?this.hide():this.show()},o}(n)})}.call(this),function(){n("test-a-site",["templates","domReady","zvelonet","modal","element"],function(t,e,n,r,i){var o;return new(o=function(){function o(t){this.baseSelector=t,this.zn=new n({znhost:"https://query.zvelo.com:3333",username:"zvelo.com",password:"7j25jx7XVAe",hashMashWorker:"./js/vendor/hashmash/worker.min.js",useCache:!1}),e(this.onDomReady.bind(this))}return o.prototype.getEl=function(t){return i(document).find(""+this.baseSelector+" "+(t||""))},o.prototype.onDomReady=function(){var t;return t=document.documentElement,t.className=t.className.replace(/\bno-js\b/,"")+" js",i(document).on("keydown",this.onKeyDown.bind(this)),window.onpopstate=this.onPopState.bind(this),this.showLoadingModal(),this.zn.ready.then(this.znReady.bind(this)).then(this.route.bind(this)).otherwise(this.showErrorModal.bind(this))},o.prototype.onKeyDown=function(t){var e,n,i,o,s,a;if(null==r.current&&(o=this.getEl("input"),s=this.getEl("button"),null!=o.el&&null!=s.el&&document.activeElement!==o.el&&!(t.altGraphKey||t.metaKey||t.altKey||t.shiftKey||t.ctrlKey)&&(a=t.keyCode)!==(e=13)&&a!==(n=32)&&a!==(i=65)))return o.focus()},o.prototype.znReady=function(){var t;t=n.categorySort(this.zn["categories.txt"]),this.categories=t.filter(function(t){return 0===t.name.indexOf("Custom User Type ")?!1:!0})},o.prototype.onPopState=function(t){return this.route(t.state)},o.prototype.route=function(t){var e;switch(e=this.getPath(),e.page){case"":e.page="lookup";break;case"report":null==t&&(e.page="lookup")}return this.show(e.page,t,e)},o.prototype.show=function(e,n,r){var i,o,s,a;switch(null!=(o=this.loadingModal)&&o.hide(),this.data=n||{},null==(null!=(s=this.data)?s.url:void 0)&&null==r&&(this.data={}),this.data.page=e,this.getEl().html(t[e](this.data)),i=this.getEl(".btn.lookup").on("click",this.show.bind(this,"lookup")),e){case"lookup":return this.showLookup();case"report":return this.showReport();case"result":if(null!=(null!=(a=this.data)?a.url:void 0))return this.showResult(i);if(null!=r&&(this.show("lookup",i.el),null!=r.arg))return this.doLookup(r.arg)}},o.prototype.showResult=function(){return this.setPath("result",this.data.url),this.getEl(".btn.report").on("click",this.show.bind(this,"report",{url:this.data.url,categories:this.categories}))},o.prototype.showLookup=function(){return this.setPath("lookup"),this.getEl("form").on("submit",this.submitLookup.bind(this))},o.prototype.showReport=function(){return this.setPath("report"),this.getEl("form").on("submit",this.submitReport.bind(this))},o.prototype.showErrorModal=function(){var t,e,n,i,o;for(i=0,o=arguments.length;o>i;i++)t=arguments[i],"function"==typeof t?e=t:n=t;return"undefined"!=typeof console&&null!==console&&console.error(n,null!=n?n.stack:void 0),new r({header:"Error!",btn:"Dismiss",body:n,onClose:e}).show()},o.prototype.showWarning=function(t,e){return new r({header:"Warning",body:t,btn:"OK",close:!0,onClose:e}).show()},o.prototype.showLoadingModal=function(){return this.loadingModal=new r({header:"Loading...",body:"Initializing zveloNET..."}).show()},o.prototype.onHashMash=function(){var t;return null==this.authModal&&(this.authModal=new r({"class":"authorizing",header:"Authorizing..."})),t='<img src="./img/spinner-calculating.gif"><br>\nVerifying user credentials...',this.authModal.setBody(t).show()},o.prototype.onAjax=function(){var t,e;if("shown"===(null!=(e=this.authModal)?e.status:void 0))return t='<img src="./img/spinner-sending.gif"><br>\nQuerying Server...',this.authModal.setBody(t)},o.prototype.doLookup=function(t){var e;return e=this.getEl("input"),null!=e.el?(e.value().length||e.value(t),this.submitLookup()):void 0},o.prototype.submitLookup=function(t){var e;return null!=(null!=t?t.preventDefault:void 0)?t.preventDefault():null!=t&&(t.returnValue=!1),e=this.getEl("input").value(),(null!=e?e.length:void 0)?(document.activeElement.blur(),this.zn.lookup({url:e,reputation:!0,onHashMash:this.onHashMash.bind(this),onAjax:this.onAjax.bind(this)}).then(this.onLookupResponse.bind(this)).otherwise(this.showErrorModal.bind(this,this.show.bind(this,"lookup")))):void 0},o.prototype.submitReport=function(t){var e,n,r,i;return null!=(null!=t?t.preventDefault:void 0)?t.preventDefault():null!=t&&(t.returnValue=!1),n=this.getEl("select"),e=parseInt(null!=(i=n.options(n.selectedIndex()))?i.value:void 0,10),isNaN(e)?this.showWarning("Please choose a category"):(r=this.getEl(".url").text(),document.activeElement.blur(),this.zn.report({url:r,categoryIds:[e],onHashMash:this.onHashMash.bind(this),onAjax:this.onAjax.bind(this)}).then(this.onReportResponse.bind(this)).otherwise(this.showErrorModal.bind(this)))},o.prototype.getPath=function(){var t,e,n,r;return n=location.hash.slice(1).split("/"),e=n.shift(),t=n.join("/"),r={page:e},(null!=t?t.length:void 0)&&(r.arg=t),r},o.prototype.setPath=function(t,e){var n,r,i;return n=this.getPath(),n.page!==t||n.arg!==e?(r=""+t,null!=e&&(r+="/"+e),null!=(null!=(i=window.history)?i.pushState:void 0)?history.pushState(this.data,document.title,""+location.pathname+"#"+r):location.hash="#"+r):void 0},o.prototype.onLookupResponse=function(t){return this.authModal.hide(),this.show("result",t)},o.prototype.onReportResponse=function(){return new r({header:"Thank you",body:"We have received your request.",btn:"Close",close:!0,onClose:this.show.bind(this,"lookup")}).show()},o}())("#zvelonet")})}.call(this),e(["test-a-site"])}();
//# sourceMappingURL=test-a-site.min.js.map