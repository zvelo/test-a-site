!function(){var t,e,n;!function(r){function i(t,e){return _.call(t,e)}function o(t,e){var n,r,i,o,s,a,u,l,c,h,f=e&&e.split("/"),p=m.map,d=p&&p["*"]||{};if(t&&"."===t.charAt(0))if(e){for(f=f.slice(0,f.length-1),t=f.concat(t.split("/")),l=0;l<t.length;l+=1)if(h=t[l],"."===h)t.splice(l,1),l-=1;else if(".."===h){if(1===l&&(".."===t[2]||".."===t[0]))break;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((f||d)&&p){for(n=t.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),f)for(c=f.length;c>0;c-=1)if(i=p[f.slice(0,c).join("/")],i&&(i=i[r])){o=i,s=l;break}if(o)break;!a&&d&&d[r]&&(a=d[r],u=l)}!o&&a&&(o=a,s=u),o&&(n.splice(0,s,o),t=n.join("/"))}return t}function s(t,e){return function(){return p.apply(r,w.call(arguments,0).concat([t,e]))}}function a(t){return function(e){return o(e,t)}}function u(t){return function(e){g[t]=e}}function l(t){if(i(v,t)){var e=v[t];delete v[t],b[t]=!0,f.apply(r,e)}if(!i(g,t)&&!i(b,t))throw new Error("No "+t);return g[t]}function c(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function h(t){return function(){return m&&m.config&&m.config[t]||{}}}var f,p,d,y,g={},v={},m={},b={},_=Object.prototype.hasOwnProperty,w=[].slice;d=function(t,e){var n,r=c(t),i=r[0];return t=r[1],i&&(i=o(i,e),n=l(i)),i?t=n&&n.normalize?n.normalize(t,a(e)):o(t,e):(t=o(t,e),r=c(t),i=r[0],t=r[1],i&&(n=l(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:n}},y={require:function(t){return s(t)},exports:function(t){var e=g[t];return"undefined"!=typeof e?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:h(t)}}},f=function(t,e,n,o){var a,c,h,f,p,m,_=[];if(o=o||t,"function"==typeof n){for(e=!e.length&&n.length?["require","exports","module"]:e,p=0;p<e.length;p+=1)if(f=d(e[p],o),c=f.f,"require"===c)_[p]=y.require(t);else if("exports"===c)_[p]=y.exports(t),m=!0;else if("module"===c)a=_[p]=y.module(t);else if(i(g,c)||i(v,c)||i(b,c))_[p]=l(c);else{if(!f.p)throw new Error(t+" missing "+c);f.p.load(f.n,s(o,!0),u(c),{}),_[p]=g[c]}h=n.apply(g[t],_),t&&(a&&a.exports!==r&&a.exports!==g[t]?g[t]=a.exports:h===r&&m||(g[t]=h))}else t&&(g[t]=n)},t=e=p=function(t,e,n,i,o){return"string"==typeof t?y[t]?y[t](e):l(d(t,e).f):(t.splice||(m=t,e.splice?(t=e,e=n,n=null):t=r),e=e||function(){},"function"==typeof n&&(n=i,i=o),i?f(r,t,e,n):setTimeout(function(){f(r,t,e,n)},4),p)},p.config=function(t){return m=t,m.deps&&p(m.deps,m.callback),p},n=function(t,e,n){e.splice||(n=e,e=[]),i(g,t)||i(v,t)||(v[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("poly/lib/_base",["require","exports","module"],function(t,e){var n;n={}.toString,e.isFunction=function(t){return"function"==typeof t},e.isString=function(t){return"[object String]"==n.call(t)},e.toString=function(t){return n.apply(t)},e.createCaster=function(t,e){return function(n){if(null==n)throw new TypeError(e+" method called on null or undefined");return t(n)}}}),n("poly/function",["./lib/_base"],function(t){function e(e){var n=r[e];return t.isFunction(o[n])}var n,r,i=[].slice,o=Function.prototype;return r={"function-bind":"bind"},e("function-bind")||(n=function(t){var e=i.call(arguments,1),n=this,r=function(){},o=function(){return n.apply(this instanceof r?this:t||{},e.concat(i.call(arguments)))};return r.prototype=this.prototype||{},o.prototype=new r,o},o.bind=n),{}}),function(){function t(t){var e,n,r,s='{"A":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}',u="json"==t;if(u||"json-stringify"==t||"json-parse"==t){if("json-stringify"==t||u){if(e="function"==typeof a.stringify&&T){(r=function(){return 1}).toJSON=r;try{e="0"===a.stringify(0)&&"0"===a.stringify(new Number)&&'""'==a.stringify(new String)&&a.stringify(o)===i&&a.stringify(i)===i&&a.stringify()===i&&"1"===a.stringify(r)&&"[1]"==a.stringify([r])&&"[null]"==a.stringify([i])&&"null"==a.stringify(null)&&"[null,null,null]"==a.stringify([i,o,null])&&a.stringify({A:[r,!0,!1,null,"\0\b\n\f\r	"]})==s&&"1"===a.stringify(null,r)&&"[\n 1,\n 2\n]"==a.stringify([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==a.stringify(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==a.stringify(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==a.stringify(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==a.stringify(new Date(-1))}catch(l){e=!1}}if(!u)return e}if("json-parse"==t||u){if("function"==typeof a.parse)try{if(0===a.parse("0")&&!a.parse(!1)&&(r=a.parse(s),n=5==r.A.length&&1==r.A[0])){try{n=!a.parse('"	"')}catch(l){}if(n)try{n=1!=a.parse("01")}catch(l){}}}catch(l){n=!1}if(!u)return n}return e&&n}}var e,r,i,o={}.toString,s="function"==typeof n&&n.amd,a=!s&&"object"==typeof exports&&exports;a||s?"object"==typeof JSON&&JSON?s?a=JSON:(a.stringify=JSON.stringify,a.parse=JSON.parse):s&&(a=this.JSON={}):a=this.JSON||(this.JSON={});var u,l,c,h,f,p,d,y,g,v,m,b,_,w,E,x,T=new Date(-0xc782b5b800cec);try{T=-109252==T.getUTCFullYear()&&0===T.getUTCMonth()&&1==T.getUTCDate()&&10==T.getUTCHours()&&37==T.getUTCMinutes()&&6==T.getUTCSeconds()&&708==T.getUTCMilliseconds()}catch(C){}t("json")||(T||(w=Math.floor,E=[0,31,59,90,120,151,181,212,243,273,304,334],x=function(t,e){return E[e]+365*(t-1970)+w((t-1969+(e=+(e>1)))/4)-w((t-1901+e)/100)+w((t-1601+e)/400)}),(e={}.hasOwnProperty)||(e=function(t){var n,r={};return(r.__proto__=null,r.__proto__={toString:1},r).toString!=o?e=function(t){var e=this.__proto__,n=(this.__proto__=null,t in this);return this.__proto__=e,n}:(n=r.constructor,e=function(t){var e=(this.constructor||n).prototype;return t in this&&!(t in e&&this[t]===e[t])}),r=null,e.call(this,t)}),r=function(t,n){var r,i,s,a,u=0;(r=function(){this.valueOf=0}).prototype.valueOf=0,i=new r;for(s in i)e.call(i,s)&&u++;return r=i=null,u?a=2==u?function(t,n){var r,i={},s="[object Function]"==o.call(t);for(r in t)s&&"prototype"==r||e.call(i,r)||!(i[r]=1)||!e.call(t,r)||n(r)}:function(t,n){var r,i,s="[object Function]"==o.call(t);for(r in t)s&&"prototype"==r||!e.call(t,r)||(i="constructor"===r)||n(r);(i||e.call(t,r="constructor"))&&n(r)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],a=function(t,n){var r,s,a="[object Function]"==o.call(t);for(r in t)a&&"prototype"==r||!e.call(t,r)||n(r);for(s=i.length;r=i[--s];e.call(t,r)&&n(r));}),a(t,n)},t("json-stringify")||(u={"\\":"\\\\",'"':'\\"',"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},l=function(t,e){return("000000"+(e||0)).slice(-t)},c=function(t){for(var e,n='"',r=0;e=t.charAt(r);r++)n+='\\"\b\f\n\r	'.indexOf(e)>-1?u[e]:u[e]=" ">e?"\\u00"+l(2,e.charCodeAt(0).toString(16)):e;return n+'"'},h=function(t,n,s,a,u,f,p){var d,y,g,v,m,b,_,E,T,C,S,k,j,A,M,N,O=n[t];if("object"==typeof O&&O)if(d=o.call(O),"[object Date]"!=d||e.call(O,"toJSON"))"function"==typeof O.toJSON&&("[object Number]"!=d&&"[object String]"!=d&&"[object Array]"!=d||e.call(O,"toJSON"))&&(O=O.toJSON(t));else if(O>-1/0&&1/0>O){if(x){for(v=w(O/864e5),y=w(v/365.2425)+1970-1;x(y+1,0)<=v;y++);for(g=w((v-x(y,0))/30.42);x(y,g+1)<=v;g++);v=1+v-x(y,g),m=(O%864e5+864e5)%864e5,b=w(m/36e5)%24,_=w(m/6e4)%60,E=w(m/1e3)%60,T=m%1e3}else y=O.getUTCFullYear(),g=O.getUTCMonth(),v=O.getUTCDate(),b=O.getUTCHours(),_=O.getUTCMinutes(),E=O.getUTCSeconds(),T=O.getUTCMilliseconds();O=(0>=y||y>=1e4?(0>y?"-":"+")+l(6,0>y?-y:y):l(4,y))+"-"+l(2,g+1)+"-"+l(2,v)+"T"+l(2,b)+":"+l(2,_)+":"+l(2,E)+"."+l(3,T)+"Z"}else O=null;if(s&&(O=s.call(n,t,O)),null===O)return"null";if(d=o.call(O),"[object Boolean]"==d)return""+O;if("[object Number]"==d)return O>-1/0&&1/0>O?""+O:"null";if("[object String]"==d)return c(O);if("object"==typeof O){for(j=p.length;j--;)if(p[j]===O)throw TypeError();if(p.push(O),C=[],A=f,f+=u,"[object Array]"==d){for(k=0,j=O.length;j>k;M||(M=!0),k++)S=h(k,O,s,a,u,f,p),C.push(S===i?"null":S);N=M?u?"[\n"+f+C.join(",\n"+f)+"\n"+A+"]":"["+C.join(",")+"]":"[]"}else r(a||O,function(t){var e=h(t,O,s,a,u,f,p);e!==i&&C.push(c(t)+":"+(u?" ":"")+e),M||(M=!0)}),N=M?u?"{\n"+f+C.join(",\n"+f)+"\n"+A+"}":"{"+C.join(",")+"}":"{}";return p.pop(),N}},a.stringify=function(t,e,n){var r,i,s,a,u,l;if("function"==typeof e||"object"==typeof e&&e)if("[object Function]"==o.call(e))i=e;else if("[object Array]"==o.call(e))for(s={},a=0,u=e.length;u>a;l=e[a++],("[object String]"==o.call(l)||"[object Number]"==o.call(l))&&(s[l]=1));if(n)if("[object Number]"==o.call(n)){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else"[object String]"==o.call(n)&&(r=n.length<=10?n:n.slice(0,10));return h("",(l={},l[""]=t,l),i,s,r,"",[])}),t("json-parse")||(f=String.fromCharCode,p={"\\":"\\",'"':'"',"/":"/",b:"\b",t:"	",n:"\n",f:"\f",r:"\r"},d=function(){throw b=_=null,SyntaxError()},y=function(){for(var t,e,n,r,i,o=_,s=o.length;s>b;)if(t=o.charAt(b),"	\r\n ".indexOf(t)>-1)b++;else{if("{}[]:,".indexOf(t)>-1)return b++,t;if('"'==t){for(e="@",b++;s>b;)if(t=o.charAt(b)," ">t)d();else if("\\"==t)if(t=o.charAt(++b),'\\"/btnfr'.indexOf(t)>-1)e+=p[t],b++;else if("u"==t){for(n=++b,r=b+4;r>b;b++)t=o.charAt(b),t>="0"&&"9">=t||t>="a"&&"f">=t||t>="A"&&"F">=t||d();e+=f("0x"+o.slice(n,b))}else d();else{if('"'==t)break;e+=t,b++}if('"'==o.charAt(b))return b++,e;d()}else{if(n=b,"-"==t&&(i=!0,t=o.charAt(++b)),t>="0"&&"9">=t){for("0"==t&&(t=o.charAt(b+1),t>="0"&&"9">=t)&&d(),i=!1;s>b&&(t=o.charAt(b),t>="0"&&"9">=t);b++);if("."==o.charAt(b)){for(r=++b;s>r&&(t=o.charAt(r),t>="0"&&"9">=t);r++);r==b&&d(),b=r}if(t=o.charAt(b),"e"==t||"E"==t){for(t=o.charAt(++b),("+"==t||"-"==t)&&b++,r=b;s>r&&(t=o.charAt(r),t>="0"&&"9">=t);r++);r==b&&d(),b=r}return+o.slice(n,b)}if(i&&d(),"true"==o.slice(b,b+4))return b+=4,!0;if("false"==o.slice(b,b+5))return b+=5,!1;if("null"==o.slice(b,b+4))return b+=4,null;d()}}return"$"},g=function(t){var e,n;if("$"==t&&d(),"string"==typeof t){if("@"==t.charAt(0))return t.slice(1);if("["==t){for(e=[];t=y(),"]"!=t;n||(n=!0))n&&(","==t?(t=y(),"]"==t&&d()):d()),","==t&&d(),e.push(g(t));return e}if("{"==t){for(e={};t=y(),"}"!=t;n||(n=!0))n&&(","==t?(t=y(),"}"==t&&d()):d()),(","==t||"string"!=typeof t||"@"!=t.charAt(0)||":"!=y())&&d(),e[t.slice(1)]=g(y());return e}d()}return t},m=function(t,e,n){var r=v(t,e,n);r===i?delete t[e]:t[e]=r},v=function(t,e,n){var i,s=t[e];if("object"==typeof s&&s)if("[object Array]"==o.call(s))for(i=s.length;i--;)m(s,i,n);else r(s,function(t){m(s,t,n)});return n.call(t,e,s)},a.parse=function(t,e){var n,r;return b=0,_=t,n=g(y()),"$"!=y()&&d(),b=_=null,e&&"[object Function]"==o.call(e)?v((r={},r[""]=n,r),"",e):n})),s&&n("poly/support/json3",[],function(){return a})}.call(this),n("poly/json",["./support/json3"],function(t){return t}),n("poly/array",["./lib/_base"],function(t){function e(e){return"[object String]"==t.toString(e)?e.split(""):u(e)}function n(t){return"[object Array]"==p.call(t)}function r(e){var n=a[e];return t.isFunction(f[n])}function i(){return 1}function o(t){return t}function s(n,r,i,o,s,a){var u,l,c,f;if(u=e(n),l=u.length>>>0,s===h&&(s=0),a||(a=1),f=0>a?-1:l,!t.isFunction(r))throw new TypeError(r+" is not a function");if(s==f)return!1;if(f>=s^a>0)throw new TypeError("Invalid length or starting index");for(c=s;c!=f;c+=a)if(c in u&&!i(r.call(o,u[c],c,u),c,u[c]))return!1;return!0}var a,u,l,c,h,f=Array.prototype,p={}.toString;a={"array-foreach":"forEach","array-every":"every","array-some":"some","array-map":"map","array-filter":"filter","array-reduce":"reduce","array-reduceright":"reduceRight","array-indexof":"indexOf","array-lastindexof":"lastIndexOf"},u=t.createCaster(Object,"Array"),r("array-foreach")||(f.forEach=function(t){s(this,t,i,arguments[1])}),r("array-every")||(f.every=function(t){return s(this,t,o,arguments[1])}),r("array-some")||(f.some=function(t){return s(this,t,function(t){return!t},arguments[1])}),r("array-map")||(f.map=function(t){var e,n;return e=this,n=new Array(e.length),s(e,t,function(t,e){return n[e]=t,1},arguments[1]),n}),r("array-filter")||(f.filter=function(t){var e,n;return e=this,n=[],s(e,t,function(t,e,r){return t&&n.push(r),1},arguments[1]),n}),r("array-reduce")&&r("array-reduceright")||(l=function(t,n,r,a){var u,l,c;if(l=c=n>0?-1:e(this).length>>>0,a)u=r;else if(s(this,o,function(t,e){u=t,c=e},null,l+n,n),c==l)throw new TypeError;return s(this,function(e,n,r){u=t(u,e,n,r)},i,null,c+n,n),u},r("array-reduce")||(f.reduce=function(t){return l.call(this,t,1,arguments[1],arguments.length>1)}),r("array-reduceright")||(f.reduceRight=function(t){return l.call(this,t,-1,arguments[1],arguments.length>1)})),r("array-indexof")&&r("array-lastindexof")||(c=function(t,n,r,i){var a=e(t).length>>>0,u=-1;return r=isNaN(r)?i?0:a-1:Number(r),0>r&&(r=a+r-1),s(t,o,function(t,e){return t===n&&(u=e),-1==u},null,r,i?1:-1),u},r("array-indexof")||(f.indexOf=function(t){return c(this,t,arguments[1],!0)}),r("array-lastindexof")||(f.lastIndexOf=function(t){return c(this,t,arguments[1],!1)})),Array.isArray||(Array.isArray=n)}),function(t,e){function r(){for(g=!0,clearTimeout(l);u=m.pop();)u();y&&(e[f]="complete");for(var t;t=d.shift();)t()}function i(){if(!e.body)return!1;h||(h=e.createTextNode(""));try{return e.body.removeChild(e.body.appendChild(h)),h=c,!0}catch(t){return!1}}function o(){var t;return t=p[e[f]]&&i(),!g&&t&&r(),t}function s(){o(),g||(l=setTimeout(s,v))}var a,u,l,c,h,f="readyState",p={loaded:1,interactive:1,complete:1},d=[],y=e&&"string"!=typeof e[f],g=!1,v=10,m=[];a="addEventListener"in t?function(t,e){return t.addEventListener(e,o,!1),function(){t.removeEventListener(e,o,!1)}}:function(t,e){return t.attachEvent("on"+e,o),function(){t.detachEvent(e,o)}},e&&(o()||(m=[a(t,"load"),a(e,"readystatechange"),a(t,"DOMContentLoaded")],l=setTimeout(s,v))),n("domReady",[],function(){function t(t){g?t():d.push(t)}return t.then=t,t.amd=!0,t})}(this,this.document),function(t){function e(t,e,n,r){var i,o,s,a,u,l,c,h,d,y;if((e?e.ownerDocument||e:D)!==O&&N(e),e=e||O,n=n||[],!t||"string"!=typeof t)return n;if(1!==(a=e.nodeType)&&9!==a)return[];if(P&&!r){if(i=me.exec(t))if(s=i[1]){if(9===a){if(o=e.getElementById(s),!o||!o.parentNode)return n;if(o.id===s)return n.push(o),n}else if(e.ownerDocument&&(o=e.ownerDocument.getElementById(s))&&I(e,o)&&o.id===s)return n.push(o),n}else{if(i[2])return te.apply(n,e.getElementsByTagName(t)),n;if((s=i[3])&&x.getElementsByClassName&&e.getElementsByClassName)return te.apply(n,e.getElementsByClassName(s)),n}if(x.qsa&&(!H||!H.test(t))){if(h=c=U,d=e,y=9===a&&t,1===a&&"object"!==e.nodeName.toLowerCase()){for(l=f(t),(c=e.getAttribute("id"))?h=c.replace(we,"\\$&"):e.setAttribute("id",h),h="[id='"+h+"'] ",u=l.length;u--;)l[u]=h+p(l[u]);d=fe.test(t)&&e.parentNode||e,y=l.join(",")}if(y)try{return te.apply(n,d.querySelectorAll(y)),n}catch(g){}finally{c||e.removeAttribute("id")}}}return w(t.replace(le,"$1"),e,n,r)}function r(){function t(n,r){return e.push(n+=" ")>C.cacheLength&&delete t[e.shift()],t[n]=r}var e=[];return t}function i(t){return t[U]=!0,t}function o(t){var e=O.createElement("div");try{return!!t(e)}catch(n){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function s(t,e){for(var n=t.split("|"),r=t.length;r--;)C.attrHandle[n[r]]=e}function a(t,e){var n=e&&t,r=n&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||K)-(~t.sourceIndex||K);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===e)return-1;return t?1:-1}function u(t){return function(e){var n=e.nodeName.toLowerCase();return"input"===n&&e.type===t}}function l(t){return function(e){var n=e.nodeName.toLowerCase();return("input"===n||"button"===n)&&e.type===t}}function c(t){return i(function(e){return e=+e,i(function(n,r){for(var i,o=t([],n.length,e),s=o.length;s--;)n[i=o[s]]&&(n[i]=!(r[i]=n[i]))})})}function h(){}function f(t,n){var r,i,o,s,a,u,l,c=$[t+" "];if(c)return n?0:c.slice(0);for(a=t,u=[],l=C.preFilter;a;){(!r||(i=ce.exec(a)))&&(i&&(a=a.slice(i[0].length)||a),u.push(o=[])),r=!1,(i=he.exec(a))&&(r=i.shift(),o.push({value:r,type:i[0].replace(le," ")}),a=a.slice(r.length));for(s in C.filter)!(i=ge[s].exec(a))||l[s]&&!(i=l[s](i))||(r=i.shift(),o.push({value:r,type:s,matches:i}),a=a.slice(r.length));if(!r)break}return n?a.length:a?e.error(t):$(t,u).slice(0)}function p(t){for(var e=0,n=t.length,r="";n>e;e++)r+=t[e].value;return r}function d(t,e,n){var r=e.dir,i=n&&"parentNode"===r,o=F++;return e.first?function(e,n,o){for(;e=e[r];)if(1===e.nodeType||i)return t(e,n,o)}:function(e,n,s){var a,u,l,c=q+" "+o;if(s){for(;e=e[r];)if((1===e.nodeType||i)&&t(e,n,s))return!0}else for(;e=e[r];)if(1===e.nodeType||i)if(l=e[U]||(e[U]={}),(u=l[r])&&u[0]===c){if((a=u[1])===!0||a===T)return a===!0}else if(u=l[r]=[c],u[1]=t(e,n,s)||T,u[1]===!0)return!0}}function y(t){return t.length>1?function(e,n,r){for(var i=t.length;i--;)if(!t[i](e,n,r))return!1;return!0}:t[0]}function g(t,e,n,r,i){for(var o,s=[],a=0,u=t.length,l=null!=e;u>a;a++)(o=t[a])&&(!n||n(o,r,i))&&(s.push(o),l&&e.push(a));return s}function v(t,e,n,r,o,s){return r&&!r[U]&&(r=v(r)),o&&!o[U]&&(o=v(o,s)),i(function(i,s,a,u){var l,c,h,f=[],p=[],d=s.length,y=i||_(e||"*",a.nodeType?[a]:a,[]),v=!t||!i&&e?y:g(y,f,t,a,u),m=n?o||(i?t:d||r)?[]:s:v;if(n&&n(v,m,a,u),r)for(l=g(m,p),r(l,[],a,u),c=l.length;c--;)(h=l[c])&&(m[p[c]]=!(v[p[c]]=h));if(i){if(o||t){if(o){for(l=[],c=m.length;c--;)(h=m[c])&&l.push(v[c]=h);o(null,m=[],l,u)}for(c=m.length;c--;)(h=m[c])&&(l=o?ne.call(i,h):f[c])>-1&&(i[l]=!(s[l]=h))}}else m=g(m===s?m.splice(d,m.length):m),o?o(null,s,m,u):te.apply(s,m)})}function m(t){for(var e,n,r,i=t.length,o=C.relative[t[0].type],s=o||C.relative[" "],a=o?1:0,u=d(function(t){return t===e},s,!0),l=d(function(t){return ne.call(e,t)>-1},s,!0),c=[function(t,n,r){return!o&&(r||n!==A)||((e=n).nodeType?u(t,n,r):l(t,n,r))}];i>a;a++)if(n=C.relative[t[a].type])c=[d(y(c),n)];else{if(n=C.filter[t[a].type].apply(null,t[a].matches),n[U]){for(r=++a;i>r&&!C.relative[t[r].type];r++);return v(a>1&&y(c),a>1&&p(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(le,"$1"),n,r>a&&m(t.slice(a,r)),i>r&&m(t=t.slice(r)),i>r&&p(t))}c.push(n)}return y(c)}function b(t,n){var r=0,o=n.length>0,s=t.length>0,a=function(i,a,u,l,c){var h,f,p,d=[],y=0,v="0",m=i&&[],b=null!=c,_=A,w=i||s&&C.find.TAG("*",c&&a.parentNode||a),E=q+=null==_?1:Math.random()||.1;for(b&&(A=a!==O&&a,T=r);null!=(h=w[v]);v++){if(s&&h){for(f=0;p=t[f++];)if(p(h,a,u)){l.push(h);break}b&&(q=E,T=++r)}o&&((h=!p&&h)&&y--,i&&m.push(h))}if(y+=v,o&&v!==y){for(f=0;p=n[f++];)p(m,d,a,u);if(i){if(y>0)for(;v--;)m[v]||d[v]||(d[v]=G.call(l));d=g(d)}te.apply(l,d),b&&!i&&d.length>0&&y+n.length>1&&e.uniqueSort(l)}return b&&(q=E,A=_),m};return o?i(a):a}function _(t,n,r){for(var i=0,o=n.length;o>i;i++)e(t,n[i],r);return r}function w(t,e,n,r){var i,o,s,a,u,l=f(t);if(!r&&1===l.length){if(o=l[0]=l[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&x.getById&&9===e.nodeType&&P&&C.relative[o[1].type]){if(e=(C.find.ID(s.matches[0].replace(Ee,xe),e)||[])[0],!e)return n;t=t.slice(o.shift().value.length)}for(i=ge.needsContext.test(t)?0:o.length;i--&&(s=o[i],!C.relative[a=s.type]);)if((u=C.find[a])&&(r=u(s.matches[0].replace(Ee,xe),fe.test(o[0].type)&&e.parentNode||e))){if(o.splice(i,1),t=r.length&&p(o),!t)return te.apply(n,r),n;break}}return j(t,l)(r,e,!P,n,fe.test(t)),n}var E,x,T,C,S,k,j,A,M,N,O,R,P,H,z,L,I,U="sizzle"+-new Date,D=t.document,q=0,F=0,B=r(),$=r(),J=r(),V=!1,W=function(t,e){return t===e?(V=!0,0):0},X="undefined",K=1<<31,Q={}.hasOwnProperty,Y=[],G=Y.pop,Z=Y.push,te=Y.push,ee=Y.slice,ne=Y.indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(this[e]===t)return e;return-1},re="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ie="[\\x20\\t\\r\\n\\f]",oe="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",se=oe.replace("w","w#"),ae="\\["+ie+"*("+oe+")"+ie+"*(?:([*^$|!~]?=)"+ie+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+se+")|)|)"+ie+"*\\]",ue=":("+oe+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+ae.replace(3,8)+")*)|.*)\\)|)",le=new RegExp("^"+ie+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ie+"+$","g"),ce=new RegExp("^"+ie+"*,"+ie+"*"),he=new RegExp("^"+ie+"*([>+~]|"+ie+")"+ie+"*"),fe=new RegExp(ie+"*[+~]"),pe=new RegExp("="+ie+"*([^\\]'\"]*)"+ie+"*\\]","g"),de=new RegExp(ue),ye=new RegExp("^"+se+"$"),ge={ID:new RegExp("^#("+oe+")"),CLASS:new RegExp("^\\.("+oe+")"),TAG:new RegExp("^("+oe.replace("w","w*")+")"),ATTR:new RegExp("^"+ae),PSEUDO:new RegExp("^"+ue),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ie+"*(even|odd|(([+-]|)(\\d*)n|)"+ie+"*(?:([+-]|)"+ie+"*(\\d+)|))"+ie+"*\\)|)","i"),bool:new RegExp("^(?:"+re+")$","i"),needsContext:new RegExp("^"+ie+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ie+"*((?:-\\d)?\\d*)"+ie+"*\\)|)(?=[^-]|$)","i")},ve=/^[^{]+\{\s*\[native \w/,me=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,be=/^(?:input|select|textarea|button)$/i,_e=/^h\d$/i,we=/'|\\/g,Ee=new RegExp("\\\\([\\da-f]{1,6}"+ie+"?|("+ie+")|.)","ig"),xe=function(t,e,n){var r="0x"+e-65536;return r!==r||n?e:0>r?String.fromCharCode(r+65536):String.fromCharCode(55296|r>>10,56320|1023&r)};try{te.apply(Y=ee.call(D.childNodes),D.childNodes),Y[D.childNodes.length].nodeType}catch(Te){te={apply:Y.length?function(t,e){Z.apply(t,ee.call(e))}:function(t,e){for(var n=t.length,r=0;t[n++]=e[r++];);t.length=n-1}}}k=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return e?"HTML"!==e.nodeName:!1},x=e.support={},N=e.setDocument=function(t){var e=t?t.ownerDocument||t:D,n=e.defaultView;return e!==O&&9===e.nodeType&&e.documentElement?(O=e,R=e.documentElement,P=!k(e),n&&n.attachEvent&&n!==n.top&&n.attachEvent("onbeforeunload",function(){N()}),x.attributes=o(function(t){return t.className="i",!t.getAttribute("className")}),x.getElementsByTagName=o(function(t){return t.appendChild(e.createComment("")),!t.getElementsByTagName("*").length}),x.getElementsByClassName=o(function(t){return t.innerHTML="<div class='a'></div><div class='a i'></div>",t.firstChild.className="i",2===t.getElementsByClassName("i").length}),x.getById=o(function(t){return R.appendChild(t).id=U,!e.getElementsByName||!e.getElementsByName(U).length}),x.getById?(C.find.ID=function(t,e){if(typeof e.getElementById!==X&&P){var n=e.getElementById(t);return n&&n.parentNode?[n]:[]}},C.filter.ID=function(t){var e=t.replace(Ee,xe);return function(t){return t.getAttribute("id")===e}}):(delete C.find.ID,C.filter.ID=function(t){var e=t.replace(Ee,xe);return function(t){var n=typeof t.getAttributeNode!==X&&t.getAttributeNode("id");return n&&n.value===e}}),C.find.TAG=x.getElementsByTagName?function(t,e){return typeof e.getElementsByTagName!==X?e.getElementsByTagName(t):void 0}:function(t,e){var n,r=[],i=0,o=e.getElementsByTagName(t);if("*"===t){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},C.find.CLASS=x.getElementsByClassName&&function(t,e){return typeof e.getElementsByClassName!==X&&P?e.getElementsByClassName(t):void 0},z=[],H=[],(x.qsa=ve.test(e.querySelectorAll))&&(o(function(t){t.innerHTML="<select><option selected=''></option></select>",t.querySelectorAll("[selected]").length||H.push("\\["+ie+"*(?:value|"+re+")"),t.querySelectorAll(":checked").length||H.push(":checked")}),o(function(t){var n=e.createElement("input");n.setAttribute("type","hidden"),t.appendChild(n).setAttribute("t",""),t.querySelectorAll("[t^='']").length&&H.push("[*^$]="+ie+"*(?:''|\"\")"),t.querySelectorAll(":enabled").length||H.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),H.push(",.*:")})),(x.matchesSelector=ve.test(L=R.webkitMatchesSelector||R.mozMatchesSelector||R.oMatchesSelector||R.msMatchesSelector))&&o(function(t){x.disconnectedMatch=L.call(t,"div"),L.call(t,"[s!='']:x"),z.push("!=",ue)}),H=H.length&&new RegExp(H.join("|")),z=z.length&&new RegExp(z.join("|")),I=ve.test(R.contains)||R.compareDocumentPosition?function(t,e){var n=9===t.nodeType?t.documentElement:t,r=e&&e.parentNode;return t===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):t.compareDocumentPosition&&16&t.compareDocumentPosition(r)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},W=R.compareDocumentPosition?function(t,n){if(t===n)return V=!0,0;var r=n.compareDocumentPosition&&t.compareDocumentPosition&&t.compareDocumentPosition(n);return r?1&r||!x.sortDetached&&n.compareDocumentPosition(t)===r?t===e||I(D,t)?-1:n===e||I(D,n)?1:M?ne.call(M,t)-ne.call(M,n):0:4&r?-1:1:t.compareDocumentPosition?-1:1}:function(t,n){var r,i=0,o=t.parentNode,s=n.parentNode,u=[t],l=[n];if(t===n)return V=!0,0;if(!o||!s)return t===e?-1:n===e?1:o?-1:s?1:M?ne.call(M,t)-ne.call(M,n):0;if(o===s)return a(t,n);for(r=t;r=r.parentNode;)u.unshift(r);for(r=n;r=r.parentNode;)l.unshift(r);for(;u[i]===l[i];)i++;return i?a(u[i],l[i]):u[i]===D?-1:l[i]===D?1:0},e):O},e.matches=function(t,n){return e(t,null,null,n)},e.matchesSelector=function(t,n){if((t.ownerDocument||t)!==O&&N(t),n=n.replace(pe,"='$1']"),!(!x.matchesSelector||!P||z&&z.test(n)||H&&H.test(n)))try{var r=L.call(t,n);if(r||x.disconnectedMatch||t.document&&11!==t.document.nodeType)return r}catch(i){}return e(n,O,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==O&&N(t),I(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==O&&N(t);var n=C.attrHandle[e.toLowerCase()],r=n&&Q.call(C.attrHandle,e.toLowerCase())?n(t,e,!P):void 0;return void 0===r?x.attributes||!P?t.getAttribute(e):(r=t.getAttributeNode(e))&&r.specified?r.value:null:r},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,n=[],r=0,i=0;if(V=!x.detectDuplicates,M=!x.sortStable&&t.slice(0),t.sort(W),V){for(;e=t[i++];)e===t[i]&&(r=n.push(i));for(;r--;)t.splice(n[r],1)}return t},S=e.getText=function(t){var e,n="",r=0,i=t.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)n+=S(t)}else if(3===i||4===i)return t.nodeValue}else for(;e=t[r];r++)n+=S(e);return n},C=e.selectors={cacheLength:50,createPseudo:i,match:ge,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(Ee,xe),t[3]=(t[4]||t[5]||"").replace(Ee,xe),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,n=!t[5]&&t[2];return ge.CHILD.test(t[0])?null:(t[3]&&void 0!==t[4]?t[2]=t[4]:n&&de.test(n)&&(e=f(n,!0))&&(e=n.indexOf(")",n.length-e)-n.length)&&(t[0]=t[0].slice(0,e),t[2]=n.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(Ee,xe).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=B[t+" "];return e||(e=new RegExp("(^|"+ie+")"+t+"("+ie+"|$)"))&&B(t,function(t){return e.test("string"==typeof t.className&&t.className||typeof t.getAttribute!==X&&t.getAttribute("class")||"")})},ATTR:function(t,n,r){return function(i){var o=e.attr(i,t);return null==o?"!="===n:n?(o+="","="===n?o===r:"!="===n?o!==r:"^="===n?r&&0===o.indexOf(r):"*="===n?r&&o.indexOf(r)>-1:"$="===n?r&&o.slice(-r.length)===r:"~="===n?(" "+o+" ").indexOf(r)>-1:"|="===n?o===r||o.slice(0,r.length+1)===r+"-":!1):!0}},CHILD:function(t,e,n,r,i){var o="nth"!==t.slice(0,3),s="last"!==t.slice(-4),a="of-type"===e;return 1===r&&0===i?function(t){return!!t.parentNode}:function(e,n,u){var l,c,h,f,p,d,y=o!==s?"nextSibling":"previousSibling",g=e.parentNode,v=a&&e.nodeName.toLowerCase(),m=!u&&!a;if(g){if(o){for(;y;){for(h=e;h=h[y];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;d=y="only"===t&&!d&&"nextSibling"}return!0}if(d=[s?g.firstChild:g.lastChild],s&&m){for(c=g[U]||(g[U]={}),l=c[t]||[],p=l[0]===q&&l[1],f=l[0]===q&&l[2],h=p&&g.childNodes[p];h=++p&&h&&h[y]||(f=p=0)||d.pop();)if(1===h.nodeType&&++f&&h===e){c[t]=[q,p,f];break}}else if(m&&(l=(e[U]||(e[U]={}))[t])&&l[0]===q)f=l[1];else for(;(h=++p&&h&&h[y]||(f=p=0)||d.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++f||(m&&((h[U]||(h[U]={}))[t]=[q,f]),h!==e)););return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(t,n){var r,o=C.pseudos[t]||C.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return o[U]?o(n):o.length>1?(r=[t,t,"",n],C.setFilters.hasOwnProperty(t.toLowerCase())?i(function(t,e){for(var r,i=o(t,n),s=i.length;s--;)r=ne.call(t,i[s]),t[r]=!(e[r]=i[s])}):function(t){return o(t,0,r)}):o}},pseudos:{not:i(function(t){var e=[],n=[],r=j(t.replace(le,"$1"));return r[U]?i(function(t,e,n,i){for(var o,s=r(t,null,i,[]),a=t.length;a--;)(o=s[a])&&(t[a]=!(e[a]=o))}):function(t,i,o){return e[0]=t,r(e,null,o,n),!n.pop()}}),has:i(function(t){return function(n){return e(t,n).length>0}}),contains:i(function(t){return function(e){return(e.textContent||e.innerText||S(e)).indexOf(t)>-1}}),lang:i(function(t){return ye.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(Ee,xe).toLowerCase(),function(e){var n;do if(n=P?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return n=n.toLowerCase(),n===t||0===n.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var n=t.location&&t.location.hash;return n&&n.slice(1)===e.id},root:function(t){return t===R},focus:function(t){return t===O.activeElement&&(!O.hasFocus||O.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return t.disabled===!1},disabled:function(t){return t.disabled===!0},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeName>"@"||3===t.nodeType||4===t.nodeType)return!1;return!0},parent:function(t){return!C.pseudos.empty(t)},header:function(t){return _e.test(t.nodeName)},input:function(t){return be.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||e.toLowerCase()===t.type)},first:c(function(){return[0]}),last:c(function(t,e){return[e-1]}),eq:c(function(t,e,n){return[0>n?n+e:n]}),even:c(function(t,e){for(var n=0;e>n;n+=2)t.push(n);return t}),odd:c(function(t,e){for(var n=1;e>n;n+=2)t.push(n);return t}),lt:c(function(t,e,n){for(var r=0>n?n+e:n;--r>=0;)t.push(r);return t}),gt:c(function(t,e,n){for(var r=0>n?n+e:n;++r<e;)t.push(r);return t})}},C.pseudos.nth=C.pseudos.eq;for(E in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C.pseudos[E]=u(E);for(E in{submit:!0,reset:!0})C.pseudos[E]=l(E);h.prototype=C.filters=C.pseudos,C.setFilters=new h,j=e.compile=function(t,e){var n,r=[],i=[],o=J[t+" "];if(!o){for(e||(e=f(t)),n=e.length;n--;)o=m(e[n]),o[U]?r.push(o):i.push(o);o=J(t,b(i,r))}return o},x.sortStable=U.split("").sort(W).join("")===U,x.detectDuplicates=V,N(),x.sortDetached=o(function(t){return 1&t.compareDocumentPosition(O.createElement("div"))}),o(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||s("type|href|height|width",function(t,e,n){return n?void 0:t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),x.attributes&&o(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||s("value",function(t,e,n){return n||"input"!==t.nodeName.toLowerCase()?void 0:t.defaultValue}),o(function(t){return null==t.getAttribute("disabled")})||s(re,function(t,e,n){var r;return n?void 0:(r=t.getAttributeNode(e))&&r.specified?r.value:t[e]===!0?e.toLowerCase():null}),"function"==typeof n&&n.amd?n("sizzle",[],function(){return e}):t.Sizzle=e}(window),/** @license MIT License (c) copyright 2011-2013 original author or authors */
function(t,e){t("when/when",[],function(){function t(t,e,n,i){return r(t).then(e,n,i)}function n(t,e){this.then=t,this.inspect=e}function r(t){return s(function(e){e(t)})}function i(e){return t(e,c)}function o(){function t(t,o,s){e.resolve=e.resolver.resolve=function(e){return i?r(e):(i=!0,t(e),n)},e.reject=e.resolver.reject=function(t){return i?r(c(t)):(i=!0,o(t),n)},e.notify=e.resolver.notify=function(t){return s(t),t}}var e,n,i;return e={promise:I,resolve:I,reject:I,notify:I,resolver:{resolve:I,reject:I,notify:I}},e.promise=n=s(t),e}function s(t){return a(t,L.PromiseStatus&&L.PromiseStatus())}function a(t,e){function r(t,n,r){var i=a(function(e,i,o){function s(s){s.then(t,n,r).then(e,i,o)}y?y.push(s):C(function(){s(d)})},e&&e.observed());return i}function i(){return d?d.inspect():T()}function o(t){y&&(d=u(t),f(y,d),y=I,e&&d.then(function(){e.fulfilled()},function(t){e.rejected(t)}))}function s(t){o(c(t))}function l(t){y&&f(y,h(t))}var p,d,y=[];p=new n(r,i);try{t(o,s,l)}catch(g){s(g)}return p}function u(t){return t instanceof n?t:t===Object(t)&&"then"in t?s(function(e,n,r){C(function(){try{var i=t.then;"function"==typeof i?M(i,t,e,n,r):e(l(t))}catch(o){n(o)}})}):l(t)}function l(t){var e=new n(function(n){try{return"function"==typeof n?u(n(t)):e}catch(r){return c(r)}},function(){return E(t)});return e}function c(t){var e=new n(function(n,r){try{return"function"==typeof r?u(r(t)):e}catch(i){return c(i)}},function(){return x(t)});return e}function h(t){var e=new n(function(n,r,i){try{return"function"==typeof i?h(i(t)):e}catch(o){return h(o)}});return e}function f(t,e){C(function(){for(var n,r=0;n=t[r++];)n(e)})}function p(t){return t&&"function"==typeof t.then}function d(e,n,r,i,o){return t(e,function(e){function a(r,i,o){function s(t){p(t)}function a(t){f(t)}var u,l,c,h,f,p,d,y;if(d=e.length>>>0,u=Math.max(0,Math.min(n,d)),c=[],l=d-u+1,h=[],u)for(p=function(t){h.push(t),--l||(f=p=k,i(h))},f=function(t){c.push(t),--u||(f=p=k,r(c))},y=0;d>y;++y)y in e&&t(e[y],a,s,o);else r(c)}return s(a).then(r,i,o)})}function y(t,e,n,r){function i(t){return e?e(t[0]):t[0]}return d(t,1,i,n,r)}function g(t,e,n,r){return _(t,k).then(e,n,r)}function v(){return _(arguments,k)}function m(t){return _(t,E,x)}function b(t,e){return _(t,e)}function _(e,n,r){return t(e,function(e){function i(i,o,s){function a(e,a){t(e,n,r).then(function(t){u[a]=t,--c||i(u)},o,s)}var u,l,c,h;if(c=l=e.length>>>0,u=[],!c)return i(u),void 0;for(h=0;l>h;h++)h in e?a(e[h],h):--c}return s(i)})}function w(e,n){var r=M(A,arguments,1);return t(e,function(e){var i;return i=e.length,r[0]=function(e,r,o){return t(e,function(e){return t(r,function(t){return n(e,t,o,i)})})},j.apply(e,r)})}function E(t){return{state:"fulfilled",value:t}}function x(t){return{state:"rejected",reason:t}}function T(){return{state:"pending"}}function C(t){1===O.push(t)&&N(S)}function S(){for(var t,e=0;t=O[e++];)t();O=[]}function k(t){return t}t.promise=s,t.resolve=r,t.reject=i,t.defer=o,t.join=v,t.all=g,t.map=b,t.reduce=w,t.settle=m,t.any=y,t.some=d,t.isPromise=p,n.prototype={otherwise:function(t){return this.then(I,t)},ensure:function(t){function e(){return r(t())}return this.then(e,e).yield(this)},yield:function(t){return this.then(function(){return t})},spread:function(t){return this.then(function(e){return g(e,function(e){return t.apply(I,e)})})},always:function(t,e){return this.then(t,t,e)}};var j,A,M,N,O,R,P,H,z,L,I;return O=[],L="undefined"!=typeof console?console:t,R=e.setTimeout,N="function"==typeof setImmediate?setImmediate.bind(e):"object"==typeof process&&process.nextTick?process.nextTick:"object"==typeof vertx?vertx.runOnLoop:function(t){R(t,0)},P=Function.prototype,H=P.call,M=P.bind?H.bind(H):function(t,e){return t.apply(e,A.call(arguments,2))},z=[],A=z.slice,j=z.reduce||function(t){var e,n,r,i,o;if(o=0,e=Object(this),i=e.length>>>0,n=arguments,n.length<=1)for(;;){if(o in e){r=e[o++];break}if(++o>=i)throw new TypeError}else r=n[1];for(;i>o;++o)o in e&&(r=t(r,e[o],o,e));return r},t})}("function"==typeof n&&n.amd?n:function(t){module.exports=t()},this),n("when",["when/when"],function(t){return t}),function(){var t={}.hasOwnProperty;n("zvelonet/lib/semver",[],function(){var e,n,r,i,o,s,a,u,l,c,h,f,p,d,y,g,v,m,b,_,w,E,x,T,C,S,k,j,A,M,N,O;C="\\s*[v=]*\\s*([0-9]+)\\.([0-9]+)\\.([0-9]+)(-[0-9]+-?)?([a-zA-Z-+][a-zA-Z0-9-.:]*)?",s="^((<|>)?=?)s*("+C+")$|^$",O="[v=]*([0-9]+|x|X|\\*)(?:\\.([0-9]+|x|X|\\*)(?:\\.([0-9]+|x|X|\\*)([a-zA-Z-][a-zA-Z0-9-.:]*)?)?)?",N="((?:<|>)=?)?\\s*"+O,a="(?:~>?)",u=""+a+N,c={parse:new RegExp("^\\s*"+C+"\\s*$"),parsePackage:new RegExp("^\\s*([^/]+)[-@]("+C+")\\s*$"),parseRange:new RegExp("^\\s*("+C+")\\s+-\\s+("+C+")\\s*$"),validComparator:new RegExp("^"+s+"$"),parseXRange:new RegExp("^"+N+"$"),parseSpermy:new RegExp("^"+u+"$")},m=function(t){return(""+(t||"")).match(c.parse)},j=function(t){var e;return e=t,[e[1]||"",e[2]||"",e[3]||""].join(".")+(e[4]||"")+(e[5]||"")},S=/(<|>)?=?\s*\*/g,k="",e=new RegExp("((<|>)?=|<|>)\\s*("+C+"|"+O+")","g"),n="$1$3",E=function(t){return t.trim().replace(c.parseXRange,function(t,e,n,r,i){var o,s;return o=!n||"x"===n.toLowerCase()||"*"===n||!r||"x"===r.toLowerCase()||"*"===r||!i||"x"===i.toLowerCase()||"*"===i,s=t,e&&o?((!n||"*"===n||"x"===n.toLowerCase())&&(n=0),(!r||"*"===r||"x"===r.toLowerCase())&&(r=0),(!i||"*"===i||"x"===i.toLowerCase())&&(i=0),s=""+e+n+"."+r+"."+i+"-"):n&&"*"!==n&&"x"!==n.toLowerCase()?r&&"*"!==r&&"x"!==r.toLowerCase()?i&&"*"!==i&&"x"!==i.toLowerCase()||(s=">="+n+"."+r+".0- <"+n+"."+(+r+1)+".0-"):s=">="+n+".0.0- <"+(+n+1)+".0.0-":s="*",s})},x=function(t){return t.split(/\s+/).map(E).join(" ")},_=function(t){return t.trim().replace(c.parseSpermy,function(t,e,n,r,i,o){if(e)throw new Error("Using '"+e+"' with ~ makes no sense. Don't do it.");return n&&"x"!==n.toLowerCase()?r&&"x"!==r.toLowerCase()?i&&"x"!==i.toLowerCase()?(o=o||"-",">="+n+"."+r+"."+(i+o)+" <"+n+"."+(+r+1)+".0-"):">="+n+"."+r+".0- <"+n+"."+(+r+1)+".0-":">="+n+".0.0- <"+(+n+1)+".0.0-":""})},v=function(t){return null==t?-1:parseInt((t||"0").replace(/[^0-9]+/g,""),10)},h=function(t,e){var n,r,i,o;if(t=m(t),e=m(e),!t||!e)return!1;for(n=o=1;4>=o;n=++o){if(t[n]=v(t[n]),e[n]=v(e[n]),t[n]>e[n])return!0;if(t[n]!==e[n])return!1}return r=t[5]||"",i=e[5]||"",r===i?null:r?i?r>i:!1:!0},d=function(t,e){return h(e,t)},f=function(t,e){return!d(t,e)},y=function(t,e){return!h(t,e)},i=function(t,e){return null===h(t,e)},g=function(t,e){return null!==h(t,e)},r=function(t,e){var n;return n=h(t,e),null===n?0:n?1:-1},M=function(t){return"string"!=typeof t?null:m(t)&&t.trim().replace(/^[v=]+/,"")},b=">=$1 <=$7",A=function(t){var r;return r=(t||"").trim().replace(c.parseRange,b).replace(e,n).split(/\s+/).join(" ").split("||").map(function(t){return t.replace(new RegExp("("+a+")\\s+"),"$1").split(" ").map(x).map(_).map(w).join(" ").trim()}).map(function(t){return t.trim().split(/\s+/).filter(function(t){return t.match(c.validComparator)})}).filter(function(t){return t.length})},T=function(t,e){var n,r,o,s,a,u,l,c,f;if(t=M(t),!t)return!1;for(e=A(e),u=0,c=e.length;c>u;u++){for(r=e[u],o=!1,l=0,f=r.length;f>l&&(s=r[l],n=function(){switch(s.charAt(0)){case">":return h;case"<":return d;default:return!1}}(),i=s.charAt("="===!!n),a=!!i+!!n,n||(i=!0),s=s.substr(a),s=""===s?s:M(s),o=""===s||i&&s===t||n&&n(t,s),o);l++);if(o)return!0}return!1},w=function(t){return t.trim().replace(S,k)},o={expressions:c,rangeReplace:b,compare:r,satisfies:T,replaceStars:w,toComparators:A,eq:i,neq:g,gt:h,gte:f,lt:d,lte:y,rcompare:function(t,e){return r(e,t)},clean:function(t){return t=m(t),t?j(t):t},validPackage:function(t){return"string"!=typeof t?null:t.match(c.parsePackage)&&t.trim()},validRange:function(t){var e;return t=w(t),e=A(t),0===e.length?null:e.map(function(t){return t.join(" ")}).join("||")},maxSatisfying:function(t,e){return t.filter(function(t){return T(t,e)}).sort(r).pop()||null},inc:function(t,e){var n,r,i,o,s;if(t=m(t),!t)return null;if(o={major:1,minor:2,patch:3,build:4},i=o[e],null==i)return null;for(n=v(t[i]),t[i]=-1===n?1:n+1,r=s=i;4>=i?4>=s:s>=4;r=4>=i?++s:--s)-1!==v(t[r])&&(t[r]="0");return t[4]&&(t[4]="-"+t[4]),t[5]="",j(t)},cmp:function(t,e,n){switch(e){case">":return h(t,n);case"<":return d(t,n);case">=":return f(t,n);case"<=":return y(t,n);case"==":return i(t,n);case"!=":return g(t,n);case"is":return t===n;case"===":return t===n;case"isnt":return t!==n;case"!==":return t!==n;default:throw new Error("Y U NO USE VALID COMPARATOR!? "+e)}}};for(p in c)t.call(c,p)&&(l=c[p],o[p]=function(t){return(""+(t||"")).match(l)});return o})}.call(this),function(){var t;t=this,n("zvelonet/lib/log",[],function(){return function(){return t.console?console.log(Array.prototype.slice.call(arguments)):void 0}})}.call(this),function(){var t;t="zvelo",n("zvelonet/lib/storage",["./log"],function(e){var n;return n={makeKey:function(e,n){if(null==e)throw new Error("storage cannot use unspecified index");return null==n&&(n=t),""+n+"."+e},inUse:function(){return null!=("undefined"!=typeof window&&null!==window?window.localStorage:void 0)?!0:!1},write:function(t,r,i){var o,s;if(!n.inUse())return!1;s=n.makeKey(t,i),e("storage: writing "+s);try{return localStorage.setItem(s,JSON.stringify(r)),!0}catch(a){return o=a,o===QUOTA_EXCEEDED_ERR&&e("storage: localStorage quota exceeded"),!1}},read:function(t,r,i){var o,s,a,u;if(!n.inUse())return r;if(s=n.makeKey(t,i),a=localStorage.getItem(s),null==a&&null!=r)return e("storage: "+s+" was missing, storing default"),n.write(t,r,i),r;try{return u=JSON.parse(a),e("storage: read "+s),u}catch(l){return o=l,r}},"delete":function(t,e){var r;if(n.inUse())return r=n.makeKey(t,e),localStorage.removeItem(r)}}})}.call(this),function(t){function e(t,e,n){for(var r=(n||0)-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function r(t,n){var r=typeof n;if(t=t.cache,"boolean"==r||null==n)return t[n];"number"!=r&&"string"!=r&&(r="object");var i="number"==r?n:z+n;return t=t[r]||(t[r]={}),"object"==r?t[i]&&e(t[i],n)>-1?0:-1:t[i]?0:-1}function i(t){var e=this.cache,n=typeof t;if("boolean"==n||null==t)e[t]=!0;else{"number"!=n&&"string"!=n&&(n="object");var r="number"==n?t:z+t,i=e[n]||(e[n]={});"object"==n?(i[r]||(i[r]=[])).push(t)==this.array.length&&(e[n]=!1):i[r]=!0}}function o(t){var e=-1,n=t.length,r=a();r["false"]=r["null"]=r["true"]=r.undefined=!1;var o=a();for(o.array=t,o.cache=r,o.push=i;++e<n;)o.push(t[e]);return r.object===!1?(c(o),null):o}function s(){return R.pop()||[]}function a(){return P.pop()||{args:"",array:null,bottom:"",cache:null,"false":!1,firstArg:"",init:"",loop:"","null":!1,number:null,object:null,push:null,shadowedProps:null,string:null,top:"","true":!1,undefined:!1,useHas:!1,useKeys:!1}}function u(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function l(t){t.length=0,R.length<I&&R.push(t)}function c(t){var e=t.cache;e&&c(e),t.array=t.cache=t.object=t.number=t.string=null,P.length<I&&P.push(t)}function h(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,i=n-e||0,o=Array(0>i?0:i);++r<i;)o[r]=t[e+r];return o}function f(){}function p(){var t=a();t.shadowedProps=q,t.array=t.bottom=t.loop=t.top="",t.init="iterable",t.useHas=!0,t.useKeys=!!je;for(var e,n=0;e=arguments[n];n++)for(var r in e)t[r]=e[r];var i=t.args;t.firstArg=/^[^,]+/.exec(i)[0];var o=Function("errorClass, errorProto, hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+i+") {\n"+Ee(t)+"\n}");return c(t),o(V,ne,ue,g,Se,E,je,f,re,Z,_e,Y,ie,ce)}function d(){var t=(t=f.indexOf)===S?e:t;return t}function y(t){return function(e,n,r,i){return"boolean"!=typeof n&&null!=n&&(i=r,r=i&&i[n]===e?O:n,n=!1),null!=r&&(r=f.createCallback(r,i)),t(e,n,r,i)}}function g(t){return ce.call(t)==F}function v(t,e,n,r,i,o){var a=t;if("boolean"!=typeof e&&null!=e&&(r=n,n=e,e=!1),"function"==typeof n){if(n="undefined"==typeof r?n:f.createCallback(n,r,1),a=n(a),"undefined"!=typeof a)return a;a=t}var c=w(a);if(c){var p=ce.call(a);if(!G[p]||!we.nodeClass&&u(a))return a;var d=Se(a)}if(!c||!e)return c?d?h(a):Me({},a):a;var y=be[p];switch(p){case $:case J:return new y(+a);case X:case Y:return new y(a);case Q:return y(a.source,U.exec(a))}var g=!i;i||(i=s()),o||(o=s());for(var m=i.length;m--;)if(i[m]==t)return o[m];return a=d?y(a.length):{},d&&(ue.call(t,"index")&&(a.index=t.index),ue.call(t,"input")&&(a.input=t.input)),i.push(t),o.push(a),(d?Ae:Oe)(t,function(t,r){a[r]=v(t,e,n,O,i,o)}),g&&(l(i),l(o)),a}function m(t){var e=!0;if(!t)return e;var n=ce.call(t),r=t.length;return n==B||n==Y||(we.argsClass?n==F:g(t))||n==K&&"number"==typeof r&&_(t.splice)?!r:(Oe(t,function(){return e=!1}),e)}function b(t,e,n,r,i,o){var a=n===H;if("function"==typeof n&&!a){n=f.createCallback(n,r,2);var c=n(t,e);if("undefined"!=typeof c)return!!c}if(t===e)return 0!==t||1/t==1/e;var h=typeof t,p=typeof e;if(t===t&&(!t||"function"!=h&&"object"!=h)&&(!e||"function"!=p&&"object"!=p))return!1;if(null==t||null==e)return t===e;var d=ce.call(t),y=ce.call(e);if(d==F&&(d=K),y==F&&(y=K),d!=y)return!1;switch(d){case $:case J:return+t==+e;case X:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case Q:case Y:return t==String(e)}var v=d==B;if(!v){if(ue.call(t,"__wrapped__ ")||ue.call(e,"__wrapped__"))return b(t.__wrapped__||t,e.__wrapped__||e,n,r,i,o);if(d!=K||!we.nodeClass&&(u(t)||u(e)))return!1;var m=!we.argsObject&&g(t)?Object:t.constructor,w=!we.argsObject&&g(e)?Object:e.constructor;if(m!=w&&!(_(m)&&m instanceof m&&_(w)&&w instanceof w))return!1}var E=!i;i||(i=s()),o||(o=s());for(var x=i.length;x--;)if(i[x]==t)return o[x]==e;var T=0;if(c=!0,i.push(t),o.push(e),v){if(x=t.length,T=e.length,c=T==t.length,!c&&!a)return c;for(;T--;){var C=x,S=e[T];if(a)for(;C--&&!(c=b(t[C],S,n,r,i,o)););else if(!(c=b(t[T],S,n,r,i,o)))break}return c}return Ne(e,function(e,s,a){return ue.call(a,s)?(T++,c=ue.call(t,s)&&b(t[s],e,n,r,i,o)):void 0}),c&&!a&&Ne(t,function(t,e,n){return ue.call(n,e)?c=--T>-1:void 0}),E&&(l(i),l(o)),c}function _(t){return"function"==typeof t}function w(t){return!(!t||!Z[typeof t])}function E(t){return"string"==typeof t||ce.call(t)==Y}function x(t,e,n){if(e=f.createCallback(e,n),!Se(t)){var r;return Ae(t,function(t,n,i){return e(t,n,i)?(r=t,!1):void 0}),r}for(var i=-1,o=t.length;++i<o;){var s=t[i];if(e(s,i,t))return s}}function T(t,e,n){if(e&&"undefined"==typeof n&&Se(t))for(var r=-1,i=t.length;++r<i&&e(t[r],r,t)!==!1;);else Ae(t,e,n);return t}function C(t){var e=t?t.length:0;return"number"==typeof e?e:je(t).length}function S(t,n,r){if("number"==typeof r){var i=t?t.length:0;r=0>r?ye(0,i+r):r||0}else if(r){var o=j(t,n);return t[o]===n?o:-1}return t?e(t,n,r):-1}function j(t,e,n,r){var i=0,o=t?t.length:i;for(n=n?f.createCallback(n,r,1):N,e=n(e);o>i;){var s=i+o>>>1;n(t[s])<e?i=s+1:o=s}return i}function A(t){return Se(t)||(arguments[0]=t?ge.call(t):ee),Re(se.apply(ee,arguments))}function M(t,e,n){if(null==t)return N;var r=typeof t;if("function"!=r){if("object"!=r)return function(e){return e[t]};var i=je(t);return function(e){for(var n=i.length,r=!1;n--&&(r=b(e[i[n]],t[i[n]],H)););return r}}return"undefined"==typeof e||D&&!D.test(ae.call(t))?t:1===n?function(n){return t.call(e,n)}:2===n?function(n,r){return t.call(e,n,r)}:4===n?function(n,r,i,o){return t.call(e,n,r,i,o)}:function(n,r,i){return t.call(e,n,r,i)}}function N(t){return t}var O,R=[],P=[],H={},z=+new Date+"",L=75,I=40,U=/\w*$/,D=(D=/\bthis\b/)&&D.test(function(){return this})&&D,q=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],F="[object Arguments]",B="[object Array]",$="[object Boolean]",J="[object Date]",V="[object Error]",W="[object Function]",X="[object Number]",K="[object Object]",Q="[object RegExp]",Y="[object String]",G={};G[W]=!1,G[F]=G[B]=G[$]=G[J]=G[X]=G[K]=G[Q]=G[Y]=!0;var Z={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},te=Z[typeof global]&&global;!te||te.global!==te&&te.window!==te||(t=te);var ee=[],ne=Error.prototype,re=Object.prototype,ie=String.prototype;t._;var oe=RegExp("^"+String(re.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),se=(Math.ceil,t.clearTimeout,ee.concat),ae=(Math.floor,Function.prototype.toString),ue=re.hasOwnProperty,le=(ee.push,re.propertyIsEnumerable),ce=(t.setTimeout,re.toString),he=oe.test(he=ce.bind)&&he,fe=oe.test(fe=Object.create)&&fe,pe=oe.test(pe=Array.isArray)&&pe,de=(t.isFinite,t.isNaN,oe.test(de=Object.keys)&&de),ye=Math.max,ge=(Math.min,Math.random,ee.slice),ve=oe.test(t.attachEvent),me=he&&!/\n|true/.test(he+ve),be={};be[B]=Array,be[$]=Boolean,be[J]=Date,be[W]=Function,be[K]=Object,be[X]=Number,be[Q]=RegExp,be[Y]=String;var _e={};_e[B]=_e[J]=_e[X]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},_e[$]=_e[Y]={constructor:!0,toString:!0,valueOf:!0},_e[V]=_e[W]=_e[Q]={constructor:!0,toString:!0},_e[K]={constructor:!0},function(){for(var t=q.length;t--;){var e=q[t];for(var n in _e)ue.call(_e,n)&&!ue.call(_e[n],e)&&(_e[n][e]=!1)}}();var we=f.support={};!function(){var t=function(){this.x=1},e=[];t.prototype={valueOf:1,y:1};for(var n in new t)e.push(n);for(n in arguments);we.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),we.argsClass=g(arguments),we.enumErrorProps=le.call(ne,"message")||le.call(ne,"name"),we.enumPrototypes=le.call(t,"prototype"),we.fastBind=he&&!me,we.nonEnumArgs=0!=n,we.nonEnumShadows=!/valueOf/.test(e),we.unindexedChars="xx"!="x"[0]+Object("x")[0];try{we.nodeClass=!(ce.call(document)==K&&!({toString:0}+""))}catch(r){we.nodeClass=!0}}(1);var Ee=function(t){var e="var index, iterable = "+t.firstArg+", result = "+t.init+";\nif (!iterable) return result;\n"+t.top+";";t.array?(e+="\nvar length = iterable.length; index = -1;\nif ("+t.array+") {  ",we.unindexedChars&&(e+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),e+="\n  while (++index < length) {\n    "+t.loop+";\n  }\n}\nelse {  "):we.nonEnumArgs&&(e+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+t.loop+";\n    }\n  } else {  "),we.enumPrototypes&&(e+="\n  var skipProto = typeof iterable == 'function';\n  "),we.enumErrorProps&&(e+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var n=[];if(we.enumPrototypes&&n.push('!(skipProto && index == "prototype")'),we.enumErrorProps&&n.push('!(skipErrorProps && (index == "message" || index == "name"))'),t.useHas&&t.useKeys)e+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",n.length&&(e+="    if ("+n.join(" && ")+") {\n  "),e+=t.loop+";    ",n.length&&(e+="\n    }"),e+="\n  }  ";else if(e+="\n  for (index in iterable) {\n",t.useHas&&n.push("hasOwnProperty.call(iterable, index)"),n.length&&(e+="    if ("+n.join(" && ")+") {\n  "),e+=t.loop+";    ",n.length&&(e+="\n    }"),e+="\n  }    ",we.nonEnumShadows){for(e+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;7>k;k++)e+="\n    index = '"+t.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",t.useHas||(e+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),e+=") {\n      "+t.loop+";\n    }      ";e+="\n  }    "}return(t.array||we.nonEnumArgs)&&(e+="\n}"),e+=t.bottom+";\nreturn result"},xe={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},Te={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",array:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},Ce={top:"if (!objectTypes[typeof iterable]) return result;\n"+Te.top,array:!1};we.argsClass||(g=function(t){return t?ue.call(t,"callee"):!1});var Se=pe||function(t){return t?"object"==typeof t&&ce.call(t)==B:!1},ke=p({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),je=de?function(t){return w(t)?we.enumPrototypes&&"function"==typeof t||we.nonEnumArgs&&t.length&&g(t)?ke(t):de(t):[]}:ke,Ae=p(Te),Me=p(xe,{top:xe.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Ne=p(Te,Ce,{useHas:!1}),Oe=p(Te,Ce);_(/x/)&&(_=function(t){return"function"==typeof t&&ce.call(t)==W});var Re=y(function(t,n,i){var a=-1,u=d(),h=t?t.length:0,f=[],p=!n&&h>=L&&u===e,y=i||p?s():f;if(p){var g=o(y);g?(u=r,y=g):(p=!1,y=i?y:(l(y),f))}for(;++a<h;){var v=t[a],m=i?i(v,a,t):v;(n?!a||y[y.length-1]!==m:u(y,m)<0)&&((i||p)&&y.push(m),f.push(v))}return p?(l(y.array),c(y)):i&&l(y),f});f.assign=Me,f.createCallback=M,f.forEach=T,f.forIn=Ne,f.forOwn=Oe,f.keys=je,f.union=A,f.uniq=Re,f.each=T,f.extend=Me,f.unique=Re,f.clone=v,f.find=x,f.identity=N,f.indexOf=S,f.isArguments=g,f.isArray=Se,f.isEmpty=m,f.isEqual=b,f.isFunction=_,f.isObject=w,f.isString=E,f.size=C,f.sortedIndex=j,f.detect=x,f.findWhere=x,f.VERSION="1.3.1","function"==typeof n&&"object"==typeof n.amd&&n.amd&&n("zvelonet/lib/lodash",[],function(){return f})}(this),function(){var t={}.hasOwnProperty;n("zvelonet/lib/url",["./lodash","./log"],function(e,n){var r,i,o,s,a,u,l;return s="://",r=["source","scheme","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],u=function(){var t,e,n,r,i,o,s,a,u,l,c,h,f,p,d,y,g,v,m,b,_,w,E,x;return e="[^:@]",b="(?!"+e+"+:[^:@/]*@)",v="([^:/?#.]+)",m="(?:"+b+v+":)",_="(?://)",x="("+e+"*)",c=x,w="("+x+":?"+c+")",E="(?:"+w+"?@)",l="([^:/?#]*)",f="(\\d*)",p="(?::"+f+")",t="("+E+"?"+l+p+"?)",r="(?:[?#]|$)",i="(?![^?#/]*\\.[^?#/.]+"+r+")",o="(?:[^?#]"+i+")",n="(/"+o+"*/?)",s="([^?#/]*)",h="("+n+"?"+s+")",d="([^#]*)",y="(?:\\?"+d+")",a="(.*)",u="(?:#"+a+")",g="("+h+y+"?"+u+"?)",new RegExp("^"+(""+m+"?")+(""+_+"?")+t+g)},l=function(){var t,e,n;return e="(?:^|&|;)",t="([^&=;]*)",n="([^&;]*)",new RegExp(""+e+t+"=?"+n,"g")},i=u(),o=l(),a=function(){function a(t){var e,n,r,i;if(this._origUrl=t,a.isUrl(this._origUrl))throw new Error("The Url class has no copy constructor");if("string"!=typeof this._origUrl)throw new Error("Cannot create Url object from "+typeof this._origUrl);if(e=a.parse(this._origUrl),null==e||!(null!=(n=e.attr)?null!=(r=n.host)?r.length:void 0:void 0))throw new Error('Could not parse url: "'+this._origUrl+'"');i=e.attr,this.scheme=i.scheme,this.host=i.host,this.path=i.path,this.port=parseInt(e.attr.port,10),this.pathParts=e.seg.path,this.query=e.query,this.url=this.toString()}return a.TYPE={HOST:0,PATH:1,SCHEME_PORT:2,QUERY:3},a.SCHEME={HTTP:{id:0,name:"http",port:80},HTTPS:{id:1,name:"https",port:443},FTP:{id:2,name:"ftp",port:21}},a.getScheme=function(n){var r,i;i=a.SCHEME;for(r in i)if(t.call(i,r)){if("string"==typeof n&&n.toLowerCase()===a.SCHEME[r].name)return e.clone(a.SCHEME[r]);if("number"==typeof n&&n===a.SCHEME[r].id)return e.clone(a.SCHEME[r])}},a.decodeAll=function(t){var e,n,r;n=t;try{for(;n!==e;)e=decodeURIComponent(n)}catch(i){return r=i,n}return e},a.parse=function(t){var n,s,u,l,c,h,f,p,d,y,g,v,m,b,_;if(null==a.parse.cache&&(a.parse.cache={}),"string"==typeof t){if(t in a.parse.cache)return a.parse.cache[t];if(y={attr:{},seg:{}},t=t.replace(/[\t\r\n]/g,"").replace(/(#.*$)/,""),s=t.indexOf("?"),-1!==s&&(h=t.substring(s),t=t.substring(0,s)),d=a.decodeAll(t),null!=d){for(f=i.exec(a.prependHttp(d)),n=g=b=r.length-1;0>=b?0>=g:g>=0;n=0>=b?++g:--g)y.attr[r[n]]=f[n];if(null!=y.attr.host){for(null!=y.attr.query&&y.attr.query.replace(o,function(t,n,r){var i,o;return null==y.query&&(y.query=[]),o={key:n,value:r},i=e.sortedIndex(y.query,o,function(t){var e;return e=t.key,null!=t.value&&(e+=":"+t.value),e}),y.query.splice(i,0,o)}),y.attr.host=encodeURIComponent(y.attr.host.replace(/^\.\.*/,"").replace(/\.\.*$/,"").replace(/\.\.\.*/g,".").toLowerCase()),y.seg.path=[],l=null!=y.attr.path?y.attr.path:"/",null!=y.attr.fragment&&(l+="#"+y.attr.fragment),c=l.trim().split("/"),v=0,m=c.length;m>v;v++)u=c[v],u.length&&"."!==u&&(".."===u?y.seg.path.pop():u&&(u=encodeURI(u).replace("#","%23"),y.seg.path.push(u)));if(y.attr.path=y.seg.path.length?"/"+y.seg.path.join("/"):"/",p=(null!=(_=y.attr.scheme)?_.length:void 0)?a.getScheme(y.attr.scheme.trim()):a.SCHEME.HTTP.name,null!=p)return y.attr.schemea=p.name,null==y.attr.port&&(y.attr.port=p.port),a.parse.cache[t]=y,y}}}},a.prependHttp=function(t){var e,n;if(null!=t)return e=t.indexOf(s),-1===e?""+a.SCHEME.HTTP.name+s+t:0===e?""+a.SCHEME.HTTP.name+t:(n=t.indexOf("/"),-1===n||e>n?""+a.SCHEME.HTTP.name+s+t:t)},a.isUrl=function(t){return t instanceof a},a._queryToStr=function(t){var e,n,r,i;if("string"==typeof t&&t)return"?"+t;if(Array.isArray(t&&t.length)){for(r=0,i=t.length;i>r;r++)e=t[r],"undefined"!=typeof n&&null!==n?n+="&":n="?",n+=""+e.key,null!=e.value&&(n+="="+e.value);return n}return""},a.build=function(t,e,n,r,i){var o;if(null!=e&&e){if(t=t?a.getScheme(t):a.getScheme("http"),o=""+t.name+s,Array.isArray(e)&&e.length)o+=e.join(".");else{if("string"!=typeof e||!e.length)return;o+=e}return null!=n&&"number"==typeof n&&(n=parseInt(n,10),t.port!==n&&(o+=":"+n)),Array.isArray(r)?r.length&&(o+="/"+r.join("/")):o+="string"==typeof r?r:"/",o+=a._queryToStr(i),a.factory(o)}},a.factory=function(t){var e,r;if(a.isUrl(t))return t;try{if("string"==typeof t)return new a(t)}catch(i){return r=i,n("Url Error: "+r.message),void 0}return e=["Cannot create Url object from "+typeof t],null!=t&&e.push(t),n.apply(this,e)},a.hostUrl=function(t){var e;return e=a.factory(t),a.factory(""+e.scheme+"://"+e.host+":"+e.port+"/")},a.sort=function(t,e){return t=a.factory(t),e=a.factory(e),null==t||null==e?0:t.equals(e)?0:t.lessThan(e)?-1:1},a.prototype._parentHost=function(){var t;return t=this.host.split("."),t.length<2?void 0:(t.shift(),t.join("."))},a.prototype._hostParent=function(){var t,e,n;return t=this._parentHost(),n=this.scheme,e=this.port,null!=t||n===a.SCHEME.HTTP.name&&e===a.SCHEME.HTTP.port||(t=this.host,n=a.SCHEME.HTTP.name,e=a.SCHEME.HTTP.port),null!=t?a.build(n,t,e,this.path,this.query):void 0},a.prototype._parentPath=function(){var t;if(this.path&&"/"!==this.path)return this.pathParts.length<=1?"/":(t=e.clone(this.pathParts),t.pop(),"/"+t.join("/"))},a.prototype._pathParent=function(){var t;return(t=this._parentPath())?a.build(this.scheme,this.host,this.port,t,this.query):void 0},a.prototype._queryParent=function(){var t,n;if(null!=(n=this.query)?n.length:void 0)return t=e.clone(this.query),t.pop(),a.build(this.scheme,this.host,this.port,this.path,t)},a.prototype._parentHosts=function(){var t,e;if(null!=this._parentHostsCache)return this._parentHostsCache;for(this._parentHostsCache=[],e=this,t=e.host;t&&(this._parentHostsCache.push(t),e=a.factory(t),null!=e);)t=e._parentHost();return this._parentHostsCache},a.prototype._portLessThan=function(t){var e;return e=a.factory(t),null==e?!1:this.port===e.port?!1:this.port===a.SCHEME.HTTP.port?!0:e.port===a.SCHEME.HTTP.port?!1:this.port<e.port},a.prototype._schemeLessThan=function(t){var e;return e=a.factory(t),null==e?!1:this.scheme===e.scheme?!1:this.scheme===a.SCHEME.HTTP.name?!0:e.scheme===a.SCHEME.HTTP.name?!1:this.scheme<e.scheme},a.prototype._hostLessThan=function(t){var e,n,r,i,o,s,u,l,c,h;if(l=a.factory(t),null==l)return!1;if(this.host===l.host)return!1;if(u=this._parentHosts().reverse(),r=l._parentHosts().reverse(),u.length!==r.length)return u.length<r.length;for(i=c=0,h=u.length;h>c;i=++c){if(o=u[i],e=r[i],s=o.split(".").length,n=e.split(".").length,s!==n)return n>s;if(o!==e)return e>o}return!1},a.prototype._queryLessThan=function(t){var e,n,r,i,o,s,u;if(r=a.factory(t),null==r)return!1;if(null==this.query&&null!=r.query)return!0;if(null==r.query)return!1;if(this.query.length!==r.query.length)return this.query.length<r.query.length;for(u=this.query,e=o=0,s=u.length;s>o;e=++o){if(n=u[e],i=r.query[e],n.key!==i.key)return n.key<i.key;if(null==n.value&&null!=i.value)return!0;if(null==i.value)return!1;if(n.value!==i.value)return n.value<i.value}return!1},a.prototype.parent=function(){var t;return null!=(t=this._queryParent())?t:null!=(t=this._pathParent())?t:this._hostParent()},a.prototype.toString=function(t){var e,n;return n="",t||null==this.scheme||(e=a.getScheme(this.scheme),n=""+e.name+s),n+=this.host,t||null==this.port||this.port===e.port||(n+=":"+this.port),null!=this.path&&(n+=this.path),t||null==this.query||(n+=a._queryToStr(this.query)),n},a.prototype.valueOf=function(){return this.toString()},a.prototype.toJSON=function(){return this._origUrl},a.prototype.parents=function(){var t,e;if(null!=this._parentsCache)return this._parentsCache;for(this._parentsCache=[],t=this;t;)this._parentsCache.unshift(t),t=t.parent();return(this.scheme!==a.SCHEME.HTTP.name||this.port!==a.SCHEME.HTTP.port)&&(e=a.factory(""+this.host+this.path),null!=e&&(this._parentsCache=e.parents().concat(this._parentsCache))),this._parentsCache},a.prototype.forEachParent=function(t){var e,n,r,i,o,s;for(o=this.parents(),s=[],e=r=0,i=o.length;i>r&&(n=o[e],t(n,e===parents.length-1)!==!1);e=++r)s.push(void 0);return s},a.prototype.parts=function(){var t,e,n,r,i,o,s,u,l,c,h,f,p;if(null!=this._partsCache)return this._partsCache;for(this._partsCache=[],e=this.host.split("."),i=this.path.split("/"),o=a.getScheme(this.scheme),i[0].length||i.shift(),s=0,c=e.length;c>s;s++)t=e[s],t&&this._partsCache.unshift({type:a.TYPE.HOST,part:t});for(this._partsCache.push({type:a.TYPE.SCHEME_PORT,part:this.port+"_"+o.id}),u=0,h=i.length;h>u;u++)r=i[u],r&&this._partsCache.push({type:a.TYPE.PATH,part:r});if(null!=this.query)for(p=this.query,l=0,f=p.length;f>l;l++)n=p[l],this._partsCache.push({type:a.TYPE.QUERY,part:n});return this._partsCache},a.prototype.forEachPart=function(t){var e,n,r,i,o,s;for(r=this.parts(),s=[],e=i=0,o=r.length;o>i&&(n=r[e],t(r[e],e===r.length-1)!==!1);e=++i)s.push(void 0);return s},a.prototype.cacheUrls=function(){var t,e;if(null!=this._cacheUrlsCache)return this._cacheUrlsCache;for(this._cacheUrlsCache=[],e=this;null!=e;)this._cacheUrlsCache.unshift(e),e=e._hostParent();return this.scheme!==a.SCHEME.HTTP.name&&(t=a.factory(""+this.host+this.path),null!=t&&(this._cacheUrlsCache=this._cacheUrlsCache.concat(t.cacheUrls()))),this._cacheUrlsCache},a.prototype.forEachCacheUrl=function(t){var e,n,r,i,o,s;for(n=this.cacheUrls(),s=[],r=i=0,o=n.length;o>i&&(e=n[r],t(e,r===n.length-1)!==!1);r=++i)s.push(void 0);return s},a.prototype.equals=function(t,e){var n;return n=a.factory(t),n?null==e||e?n.url===this.url:n.url.toLowerCase()===this.url.toLowerCase():!1},a.prototype.isChildOf=function(t,n){var r,i;return i=a.factory(t),r=e.find(this.parents(),function(t){return t.equals(i,n)}),null!=r},a.prototype.isCacheChildOf=function(t,e){var n,r;return r=a.factory(t),n=!1,this.forEachCacheUrl(function(t){return t.isChildOf(r,e)?(n=!0,!1):!0}),n},a.prototype.lessThan=function(t){var e;return e=a.factory(t),this.equals(e)?!1:this.host!==e.host?this._hostLessThan(e):this.scheme!==e.scheme?this._schemeLessThan(e):this.port!==e.port?this._portLessThan(e):this.path!==e.path?this.path<e.path:this._queryLessThan(e)},a}()})}.call(this),function(){var t={}.hasOwnProperty;
n("zvelonet/lib/urlnode",["./lodash","./log","./url"],function(e,n,r){var i,o;return i=!0,o=function(){function o(e){var n,r,i,s,a,u,l,c;if(this._authoritative=!1,null!=e&&(null!=e.d&&(this.data=e.d),null!=e.a&&e.a&&(this._authoritative=!0),null!=e.n&&this.setExpiration(e.n),null!=e.c)){c=e.c;for(u in c)if(t.call(c,u)){i=c[u];for(s in i)t.call(i,s)&&(r=i[s],n=new o(r),n._type=function(){switch(typeof u){case"number":return u;case"string":return parseInt(u,10);default:throw new Error("UrlNode child has invalid type: "+u)}}(),n._part=s,n._parent=this,null==this._children&&(this._children={}),a=null!=(l=this._children)[u]?(l=this._children)[u]:l[u]={},a[s]=n)}}}return o.cacheTime=864e5,o.isUrlNode=function(t){return t instanceof o},o.prototype.unset=function(){return delete this.data,delete this._time,delete this._authoritative},o.prototype.isSet=function(){return null!=this.data&&!this.expired()},o.prototype.nodeForEach=function(e,n){var r,o,s,a,u,l,c;if(o=null!=n&&n?this:this.getRoot(),e.call(o)!==!1){l=o._children,c=[];for(u in l)t.call(l,u)&&(a=l[u],c.push(function(){var n;n=[];for(s in a)t.call(a,s)&&(r=a[s],n.push(r.nodeForEach(e,i)));return n}()));return c}},o.prototype.size=function(){var t;return t=0,this.nodeForEach(function(){return this.isSet()?t+=1:void 0}),t},o.prototype.expire=function(){var t;return t=!1,this.nodeForEach(function(){return this.expired()?(n("clearing "+this.url()+" because it has expired"),this.unset(),this.prune(i),t=!0):void 0}),t&&this.prune(),t},o.prototype.hasChildren=function(){var n,r,i;i=this._children;for(r in i)if(t.call(i,r)&&(n=i[r],!e.isEmpty(n)))return!0;return!1},o.prototype.isRoot=function(){return!(null!=this._parent||null!=this._part||null!=this._type)},o.prototype.prune=function(r){var o,s,a,u,l,c,h,f;r=null!=r&&r?!0:!1,a=r?this:this.getRoot(),c=!r,o=!1,f=a._children;for(h in f)if(t.call(f,h))if(l=f[h],e.isEmpty(l))delete a._children[h],o=!0;else for(u in l)t.call(l,u)&&(s=l[u],s.prune(i)&&(o=!0));if(a.isSet()||a.hasChildren()||a.isRoot()||(n("pruning "+a.url()),o=!0,c=!1,a.rm()),c)for(;a.prune(i););return o},o.prototype.set=function(t,i,s,a){var u,l,c;if(null==i)throw new Error("not storing url without any data: "+t);if(c=r.factory(t),!c)throw new Error("not storing invalid url: "+t);return u=this.getRoot(),s=s?!0:!1,n("storing: "+c+" (authoritative: "+s+")"),l=void 0,c.forEachPart(function(t,n){var r,c,h,f;return"string"==typeof t.part&&(t.part=t.part.toLowerCase()),u.hasChild(t)?u=u._children[t.type][t.part]:(r=new o,r._parent=u,r._part=t.part,r._type=t.type,null==u._children&&(u._children={}),c=null!=(h=u._children)[f=t.type]?(h=u._children)[f=t.type]:h[f]={},c[t.part]=r,u=r),n?(a||u.setExpiration(),u._authoritative=s,u.data=e.clone(i),l=u):void 0}),l},o.prototype.getRoot=function(){var t;if(null!=this._rootNode)return this._rootNode;for(t=this;!t.isRoot();)t=t._parent;return this._rootNode=t,this._rootNode},o.prototype.hasChild=function(t){var e;if(null!=this._children&&t.type in this._children&&(e=t.part.toLowerCase(),e in this._children[t.type]))return this._children[t.type][e]},o.prototype.get=function(t,e){var i,o,s;if(s=r.factory(t),!s)throw new Error("not searching for invalid url: "+t);if(n("searching for: "+s),o=this.getRoot(),i=void 0,s.forEachCacheUrl(function(t){var r;return r=o,n("  using url: "+t),t.forEachPart(function(o,a){return r=r.hasChild(o),null==r?(n("      walk break, no child: "+o.part),!1):e&&r.url().equals(s,!1)?(n("    walk found exact url: "+r.url()),i=r,!1):!e&&r.isSet()&&r.isAuthoritativeFor(s)?(n("    walk hit:  "+r.url()),i=r,!1):(n("    walk miss: "+r.url()),a?n("    walk end: "+t):void 0)}),null!=i?!1:void 0}),null==i)n("miss: "+s);else if(i.isSet())n("hit: "+i.url()+" => "+s);else{if(!e)throw new Error("unknown result for: "+s+", "+i);n("miss, returning exact url: "+i+" => "+s)}return i},o.prototype.url=function(){var t,e,n,i,o,s,a,u;if(null!=this._url)return this._url;if(!this.isRoot()){for(e=this,s=i=void 0,t=[],n=[],o=[];null!=(null!=e?e._type:void 0);){switch(e._type){case r.TYPE.HOST:t.push(e._part);break;case r.TYPE.PATH:n.unshift(e._part);break;case r.TYPE.QUERY:o.unshift(e._part);break;case r.TYPE.SCHEME_PORT:if(u=e._part.split("_"),i=u[0],a=u[1],s=r.getScheme(parseInt(a,10)),null==s)throw new Error("invalid scheme: "+e._part);s=s.name;break;default:throw new Error("unknown node type when building url: "+e._type)}e=e._parent}return this._url=r.build(s,t,i,n,o),this._url}},o.prototype.rm=function(){return null!=this._parent?delete this._parent._children[this._type][this._part]:void 0},o.prototype.toJSON=function(e){var n,r,i,o,s,a,u,l,c;i=null!=e&&e?this:this.getRoot(),a={},null!=i._authoritative&&(a.a=i._authoritative),null!=i.data&&(a.d=i.data),null!=(r=i.getExpiration())&&(a.n=r.getTime()),c=i._children;for(u in c)if(t.call(c,u)){s=c[u];for(o in s)t.call(s,o)&&(n=s[o],null==a.c&&(a.c={}),null==(l=a.c)[u]&&(l[u]={}),a.c[u][o]=n.toJSON(!0))}return a},o.prototype.valueOf=function(){return JSON.stringify(this.toJSON(i))},o.prototype.toString=o.valueOf,o.prototype.expired=function(){var t;return t=this.getExpiration(),null!=t&&new Date>=t?!0:!1},o.prototype.setExpiration=function(t){var e;return e=new Date,null!=t&&e.setTime(t-o.cacheTime),this._time=e},o.prototype.getExpiration=function(){var t;if(null!=this._time)return t=new Date,t.setTime(this._time.getTime()+o.cacheTime),t},o.prototype.isAuthoritativeFor=function(t){var e;return e=r.factory(t),null==e||null==this.url()?!1:this.url().equals(e,!1)?!0:this.isSet()&&e.isCacheChildOf(this.url(),!1)?this._authoritative:!1},o}()})}.call(this),function(){var t,e={}.hasOwnProperty;t="cache",n("zvelonet/lib/cache",["./lodash","./log","./storage","./url","./urlnode"],function(t,n,r,i,o){var s;return s=function(){function s(t){this._ns=t,this._root={},this._index="Cache",this.loaded=!1}return s.prototype._forEachMapping=function(t){var n,r,i;this.loadFromStorage(),r=this._root,i=[];for(n in r)if(e.call(r,n)){if(t.call(this,n)===!1)break;i.push(void 0)}return i},s.prototype.getRoot=function(t){var e;if(null!=t)return this.loadFromStorage(),null!=(e=this._root)?e[t]:void 0},s.prototype.clear=function(t,e){var r,o,s,a,u;if(s=this.getRoot(t),a=this.size(),null!=s&&null!=e){if(u=i.factory(e),null==u)return n("not clearing from invalid url "+e),0;o=s.get(u,!0),o&&(n("clearing urls from "+u+" in mapping "+t),o.rm(),s.prune())}else n("clearing all url cache entries"),this._root={};return r=a-this.size(),r>0&&this.write(),r},s.prototype.expire=function(t){var e;return e=!1,this._forEachMapping(function(t){return this._root[t].expire()?e=!0:n("nothing to expire for "+t)}),!t&&e&&this.write(),e},s.prototype.prune=function(){var t;return t=!1,this._forEachMapping(function(e){return this._root[e].prune()?t=!0:void 0}),t&&this.write(),t},s.prototype.write=function(){return r.write(this._index,this.toJSON(!0),this._ns)},s.prototype.toJSON=function(t){var e;return e={},this.expire(t),this._forEachMapping(function(t){return e[t]=this._root[t].toJSON()}),e},s.prototype.loadFromStorage=function(){return this.loaded?void 0:this.loadData(r.read(this._index,{},this._ns))},s.prototype.loadData=function(t){var n;this.loaded=!0,this._root={};for(n in t)e.call(t,n)&&(this._root[n]=new o(t[n]));return this.expire()},s.prototype.get=function(e,r,i){var o,s,a,u,l,c,h,f;if(u=this.getRoot(e),null!=u){if(!Array.isArray(r))return u.get(r,i);if(r.length){if(c=t.uniq(r),1===t.size(c))return this.get(e,c[0],i);for(a={hit:{},miss:[],bulk:!0},h=0,f=c.length;f>h;h++)l=c[h],o=this.get(e,l,i),(null!=o?o.isSet():void 0)?a.hit[l]=o:a.miss.push(l);return t.isEmpty(a.hit)?n("bulk cache miss 0/"+c.length):(s=t.size(a.hit),s===c.length?n("bulk cache hit "+s+"/"+c.length):n("bulk cache partial hit "+s+"/"+c.length),a)}}},s.prototype.size=function(t){var e,n;return null!=t?(n=this.getRoot(t),null==n?0:n.size()):(e=0,this._forEachMapping(function(t){return e+=this._root[t].size()}),e)},s.prototype.set=function(t,e,n,r){return this.getRoot(t)||(this._root[t]=new o),this.getRoot(t).set(e,n,r)},s.prototype.getMappings=function(){var t;return t=[],this._forEachMapping(function(e){return t.push(e)}),t},s.prototype.setExpiration=function(t,e){var r,o;if(null!=t&&(o=i.factory(t),null!=o))return r=!1,this._forEachMapping(function(t){var n,i;return i=this.getRoot(t),null!=i&&(n=i.get(o))?(n.setExpiration(e),r=!0):void 0}),r&&(n("writing after change in expiration"),this.write()),r},s}()})}.call(this),function(){var t,e,r={}.hasOwnProperty;t=["Msxml2.XMLHTTP","Msxml3.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],e=function(){var e,n,r;for(e=r=0;3>=r;e=++r)try{return e?(n=t[e-1],new ActiveXObject(""+n+".XMLHTTP")):new XMLHttpRequest}catch(i){}},n("zvelonet/lib/ajax",["when"],function(t){var n;return n=function(){function n(e){var n,r;if(null!=e)switch(typeof e){case"string":this.url=e;break;case"object":this.url=e.url,this.data=e.data,this.dataType=e.dataType,this.async=e.async,this.timeout=e.timeout,this.method=e.method,this.cache=e.cache}try{if(null==this.url)throw new Error("url is required");this._setDefaults(),this._validateDataType(),n=t.defer(),this._resolver=n.resolver,this.ready=n.promise,this._prep(),"jsonp"===this.dataType?this._execJsonp():this._execXhr()}catch(i){r=i,this._error(r.message)}}return n.prototype._setDefaults=function(){return"string"==typeof this.method&&(this.method=this.method.toUpperCase()),null==this.method&&(this.method="GET"),null==this.async&&(this.async=!0),null==this.dataType&&(this.dataType="json"),null==this.timeout&&(this.timeout=0),null!=this.cache?this.cache:this.cache=!0},n.prototype._validateDataType=function(){if("text"!==this.dataType&&"json"!==this.dataType&&"jsonp"!==this.dataType)throw new Error("invalid dataType: "+this.dataType)},n.prototype._validateMethod=function(){if("GET"!==this.method)throw new Error("TODO(jrubin) method is not yet implemented: "+this.method)},n.prototype._appendQuery=function(t){return this._queryUrl=(""+this._queryUrl+"&"+t).replace(/[&?]{1,2}/,"?")},n.prototype._prep=function(){var t;return this._queryUrl=this.url,this.cache||this._appendQuery("_="+Date.now()),null!=this.data?(t=n.serialize(this.data).join("&"),"GET"===this.method?this._appendQuery(t):this._queryData=t):void 0},n.serialize=function(t,e,i){var o,s,a;null==e&&(e=[],e.add=function(t,e){return this.push(""+encodeURIComponent(t)+"="+encodeURIComponent(e))}),o=Array.isArray(t);for(s in t)if(r.call(t,s))switch(a=t[s],null!=i&&(s=""+i+"["+(o?"":s)+"]"),typeof a){case"array":case"object":n.serialize(a,e,s);break;default:e.add(s,a)}return e},n.prototype._error=function(t){return this._resolver.reject("Ajax: "+t)},n.prototype._success=function(t){var e,n;switch(this.dataType){case"text":case"jsonp":e=t;break;case"json":try{e=JSON.parse(t)}catch(r){return n=r,this._error("JSON parse error: "+n.message,t),void 0}break;default:throw new Error("unexpected dataType: "+this.dataType)}return this._resolver.resolve(e)},n.prototype._execJsonp=function(){var t,e,n,r,i,o,s,a;if("undefined"==typeof window||null===window||"undefined"==typeof document||null===document)throw new Error("JSONP is not supported on your platform");return s=Math.round(1000001*Math.random()),n="jsonp"+s,this._appendQuery("callback="+n),a=document.createElement("script"),a.setAttribute("src",this._queryUrl),o=document.getElementsByTagName("head")[0],i=function(){clearTimeout(e);try{o.removeChild(a)}catch(t){}return delete window[n]},t=function(t){return null==t&&(t="abort"),i(),"timeout"===t&&(window[n]=function(){}),this._error(t)},r=function(t){return i(),this._success(t)},window[n]=r.bind(this),a.onerror=t.bind(this,"error"),o.appendChild(a),this.timeout>0?e=setTimeout(t.bind(this,"timeout"),this.timeout):void 0},n.prototype._execXhr=function(){var t,n,i,o,s,a,u;if(u=e(),t=function(){return u.onreadystatechange=function(){},u.abort(),this._error("timeout")},this.timeout>0&&(n=setTimeout(t.bind(this),this.timeout)),null==u)throw new Error("could not create xhr");u.open(this.method,this._queryUrl,this.async),i={"X-Requested-With":"XMLHttpRequest"},"GET"!==this.method&&(i["Content-Type"]="application/x-www-form-urlencoded"),i.Accept=function(){switch(this.dataType){case"text":return"text/plain";case"json":return"application/json";default:throw new Error("unexpected dataType: "+this.dataType)}}.call(this);for(o in i)r.call(i,o)&&(a=i[o],u.setRequestHeader(o,a));if(s=function(){return 4===u.readyState?(u.onreadystatechange=function(){},clearTimeout(n),200===u.status?this._success(u.responseText):this._error("status: "+u.status,u)):void 0},!this.async)throw new Error("TODO(jrubin) sync is not yet implemented");return u.onreadystatechange=s.bind(this),u.send(this._queryData)},n}(),function(t){return new n(t).ready}})}.call(this),function(){var t,e,r;r=864e5,t=r,e="https://dl.zvelo.com",n("zvelonet/lib/dlfile",["when","./log","./ajax","./url"],function(n,r,i,o){var s;return s=function(){function s(e,r){var i,o,s,a,u;this.filename=e,this._zn=r,o=n.defer(),this._resolver=o.resolver,this.ready=o.promise;try{if(!(null!=(a=this.filename)?a.length:void 0))throw new Error("filename is required");this._index="DLFile."+this.filename,this._expireDuration=null!=(u=this._zn.fileExpireDuration)?u:t,this._genUrl(),this._genData(),i=this._read(),null!=i&&(this.value=i.value,this.storedAt=i.storedAt),this.expired()?this._fetch():this._resolve()}catch(l){s=l,this._reject(s.message)}}return s.prototype._genFormat=function(){return this.dataType=this._zn.forceXHR?"json":"jsonp"},s.prototype._genUrl=function(){var t,n;if(t=o.hostUrl(null!=(n=this._zn.dlhost)?n:e),null==t)throw new Error("invalid dlhost: "+this._zn.dlhost);return this.url=""+t+this.filename},s.prototype._genData=function(){var t,e;if(!((null!=(t=this._zn.username)?t.length:void 0)&&(null!=(e=this._zn.password)?e.length:void 0)))throw new Error("username and password are required");return null==this.data&&(this.data={}),this.data.format=this._genFormat(),this.data.username=this._zn.username,this.data.password=this._zn.password},s.prototype._read=function(){return this._zn._read(this._index)},s.prototype._write=function(t){return this._zn._write(this._index,t)},s.prototype._delete=function(){return this._zn._delete(this._index)},s.prototype.expired=function(){var t,e,n;return null==this.value||null==this.storedAt?!0:(e=Date.now()-this.storedAt,n=e>this._expireDuration,n?r(""+this.filename+" has expired, fetching another"):(t=Math.round((this._expireDuration-e)/1e3),r(""+this.filename+" expires in "+t+" seconds")),n)},s.prototype._resolve=function(){return this._resolver.resolve(this)},s.prototype._reject=function(t){var e;return e="DLFile: Error fetching "+this.filename,null!=t&&(e+=": "+t),this._resolver.reject(e)},s.prototype._fetch=function(){return r("AJAX: fetching "+this.filename),i(this).then(this._store.bind(this)).otherwise(this._reject.bind(this))},s.prototype._store=function(t,e,n){return(null!=t?t.success:void 0)?(this.value=t[this.filename],this.storedAt=Date.now(),this._write({value:this.value,storedAt:this.storedAt}),this._resolve()):this._reject(n)},s.prototype["delete"]=function(){return delete this.value,delete this.storedAt,this._delete()},s}()})}.call(this),function(){n("hashmash/lib/sha1",[],function(){var t,e,n,r,i,o,s;return t=function(t,e){return t<<e|t>>>32-e},r=function(t){var e,n,r,i;for(n="",e=i=7;i>=0;e=--i)r=15&t>>>4*e,n+=r.toString(16);return n},e=function(t,e,n,r){switch(t){case 0:return e&n^~e&r;case 1:return e^n^r;case 2:return e&n^e&r^n&r;case 3:return e^n^r}},o=function(n){var i,o,s,a,u,l,c,h,f,p,d,y,g,v,m,b,_,w,E,x,T,C,S,k,j,A,M,N,O;for(l=[1518500249,1859775393,2400959708,3395469782],n+=String.fromCharCode(128),E=n.length/4+2,h=Math.ceil(E/16),c=[],_=C=0,N=h-1;N>=0?N>=C:C>=N;_=N>=0?++C:--C)for(c[_]=[],w=S=0;15>=S;w=++S)c[_][w]=n.charCodeAt(64*_+4*w+0)<<24|n.charCodeAt(64*_+4*w+1)<<16|n.charCodeAt(64*_+4*w+2)<<8|n.charCodeAt(64*_+4*w+3)<<0;for(p=4294967296,c[h-1][14]=8*(n.length-1)/p,c[h-1][14]=Math.floor(c[h-1][14]),c[h-1][15]=4294967295&8*(n.length-1),i=1732584193,o=4023233417,s=2562383102,a=271733878,u=3285377520,d=[],_=k=0,O=h-1;O>=0?O>=k:k>=O;_=O>=0?++k:--k){for(T=j=0;15>=j;T=++j)d[T]=c[_][T];for(T=A=16;79>=A;T=++A)d[T]=t(d[T-3]^d[T-8]^d[T-14]^d[T-16],1);for(y=i,g=o,v=s,m=a,b=u,T=M=0;79>=M;T=++M)x=Math.floor(T/20),f=4294967295&t(y,5)+e(x,g,v,m)+b+l[x]+d[T],b=m,m=v,v=t(g,30),g=y,y=f;i=4294967295&i+y,o=4294967295&o+g,s=4294967295&s+v,a=4294967295&a+m,u=4294967295&u+b}return r(i)+r(o)+r(s)+r(a)+r(u)},i=function(t){var e,n,r,i,o;for(n=0,r=i=0,o=t.length-1;(o>=0?o>=i:i>=o)&&(e=parseInt(t[r],16),!isNaN(e));r=o>=0?++i:--i){switch(!1){case 0!==e:n+=4;break;case 1!==e:n+=3;break;case!(e>=2&&3>=e):n+=2;break;case!(e>=4&&7>=e):n+=1}if(0!==e)break}return n},s=function(t){var e,n;return e=""+t.challenge+":"+t.counter,n=o(e),i(n)>=t.bits?(t.result=e,!0):(t.counter+=1,!1)},n=function(t){return o(t)},n.leading0s=function(t){return i(t)},n.tryChallenge=function(t){return s(t)},n})}.call(this),function(){n("hashmash/lib/hashmash",["when","./sha1"],function(t,e){var n,r,i;return r=function(t){return"string"==typeof t?6!==t.length?null:t:"number"!=typeof t?null:r(""+t)},i=function(t,e){return e.start=e.end+1,e.start===t.length?!1:(e.end=t.indexOf(":",e.start),-1===e.end?!1:e.end===e.start?!1:!0)},n=function(){function n(t,e,r){var i,o;this._bits=t,this._bits<n.MIN_BITS&&(this._bits=n.MIN_BITS),this._workers=[],this._range={},this._resetRange(),i=n.TaskMaster,null==e&&null!=n.BackupTaskMaster&&(i=n.BackupTaskMaster),r=null!=r?Math.min(r,i.MAX_NUM_WORKERS):i.DEFAULT_NUM_WORKERS,r&&(this._workers=function(){var t,n;for(n=[],o=t=1;r>=1?r>=t:t>=r;o=r>=1?++t:--t)n.push(new i(this._range,e));return n}.call(this))}return n.VERSION=1,n.MIN_BITS=16,n.hash=e,n.date=function(){var t,e,n,r;return n=new Date,r=("0"+(n.getYear()-100)).slice(-2),e=("0"+(n.getMonth()+1)).slice(-2),t=("0"+n.getDate()).slice(-2),""+r+e+t},n.parse=function(t){var e,n,r;return null==t?null:(n={},r={start:0,end:-1,length:function(){return this.end-this.start}},i(t,r)?(n.version=parseInt(t.substr(r.start,r.length()),10),isNaN(n.version)?null:i(t,r)?(n.bits=parseInt(t.substr(r.start,r.length()),10),isNaN(n.bits)?null:i(t,r)?(n.date=parseInt(t.substr(r.start,r.length()),10),isNaN(n.date)?null:i(t,r)?(n.resource=t.substr(r.start,r.length()),n.resource.length?i(t,r)?(n.rand=t.substr(r.start,r.length()),n.rand.length?(i(t,r),e=(-1===r.end?t.length:r.end)-r.start,n.counter=parseInt(t.substr(r.start,e),10),isNaN(n.counter)?null:n):null):null:null):null):null):null):null)},n.unparse=function(t){var e,n;return n="",null==t.version?n:(n+=""+t.version+":",null==t.bits?n:(n+=""+t.bits+":",null==t.date?n:(e=r(t.date),null==e?n:(n+=""+e+":",null==t.resource?n:(n+=""+t.resource+":",null==t.rand?n:(n+=t.rand,null==t.counter?n:n+=":"+t.counter))))))},n.prototype._resetRange=function(){return this._range={begin:0,end:-1}},n.prototype._sendData=function(t,e){var n,r,i,o,s;for(o=this._workers,s=[],r=0,i=o.length;i>r;r++)n=o[r],s.push(n.sendData(t,e));return s},n.prototype.stop=function(){var t,e,n,r,i;for(r=this._workers,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t.stop());return i},n.prototype.generate=function(e){var r,i,o,s,a,u;this._resetRange(),u=t.defer(),a=u.resolver,s=u.promise,o={version:n.VERSION,bits:this._bits,date:n.date(),resource:e,rand:Math.random().toString(36).substr(2)},r={challenge:n.unparse(o),counter:0,bits:o.bits};try{this._sendData(a,r)}catch(l){i=l,a.reject(i)}return s.ensure(this.stop.bind(this)),s},n.prototype.validate=function(t){var r,i;if(null!=t&&"string"==typeof t&&null!=this._bits&&(r=n.parse(t),null!=r&&!(r.bits<this._bits||r.bits<n.MIN_BITS||r.version!==n.VERSION||(i=n.date(),r.date<i-1||r.date>i+1||!(e.leading0s(n.hash(t))>=r.bits)))))return r},n}()})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};n("hashmash/lib/taskmaster",["./sha1"],function(t){var n,r,i,o,s,a;return n=99,r=1,a={},i=function(){function t(t){this._range=t,this._sendQueue=[],this._ready=!1}return t.RANGE_INCREMENT=Math.pow(2,15),t.prototype._send=function(t){return this._spawn(),null!=this.sendFn?this._ready?this.sendFn(t):this._sendQueue.push(t):void 0},t.prototype._setGo=function(){var t;for(this._ready=!0,t=[];this._sendQueue.length;)t.push(this._send(this._sendQueue.shift()));return t},t.prototype._spawn=function(){return null==this.worker?this.connect():void 0},t.prototype._incRange=function(){return this._range.begin=this._range.end+1,this._range.end=this._range.begin+t.RANGE_INCREMENT-1},t.prototype._sendRange=function(){return this._incRange(),this._send({m:"range",range:this._range})},t.prototype._gotResult=function(t){if(null==t)throw new Error("TaskMaster expected a result");if(null==this._resolver)throw new Error("TaskMaster requires a resolver");return this._resolver.resolve(t)},t.prototype._gotMessage=function(t){if(null!=(null!=t?t.m:void 0))switch(t.m){case"ready":return this._setGo();case"request_range":return this._sendRange();case"result":return this._gotResult(t.result)}},t.prototype.sendData=function(t,e){if(this._resolver=t,null==this._resolver)throw new Error("TaskMaster requires a resolver");return this._send({m:"data",data:e})},t.prototype.stop=function(){return this._ready=!1,this._sendQueue.length=0,null!=this.worker?(this.disconnect(),delete this.worker,delete this.sendFn):void 0},t}(),a.TaskMaster=i,s=function(t){function n(t,e){this.file=e,n.__super__.constructor.call(this,t)}return e(n,t),n.MAX_NUM_WORKERS=8,n.DEFAULT_NUM_WORKERS=4,n.prototype.connect=function(){var t;return this.worker=new Worker(this.file),t=this,this.worker.onmessage=function(e){return t._gotMessage(e.data)},this.worker.onerror=function(t){throw t.data},this.sendFn=function(t){return this.worker.postMessage(t)}},n.prototype.disconnect=function(){return this.worker.terminate()},n}(i),a.WebTaskMaster=s,o=function(){function e(){}return e.MAX_NUM_WORKERS=1,e.DEFAULT_NUM_WORKERS=1,e.prototype.sendData=function(t,e){if(this._resolver=t,this._data=e,null==this._resolver)throw new Error("TaskMaster requires a resolver");return delete this._stopFlag,this.start()},e.prototype.start=function(){var e,i;for(i=new Date;!(null!=this._stopFlag||null!=this._data.result||new Date-i>=n);)t.tryChallenge(this._data);if(null==this._stopFlag){if(null!=this._data.result){if(null==this._resolver)throw new Error("TaskMaster requires a resolver");return this._resolver.resolve(this._data.result)}return e=this,setTimeout(function(){return e.start()},r)}},e.prototype.stop=function(){return this._stopFlag=!0},e}(),a.TimeoutTaskMaster=o,a})}.call(this),function(){n("hashmash/hashmash",["./lib/hashmash","./lib/taskmaster"],function(t,e){var n=e.WebTaskMaster,r=e.TimeoutTaskMaster;return window.Worker?(t.TaskMaster=n,t.BackupTaskMaster=r):t.TaskMaster=r,t})}(),n("hashmash",["hashmash/hashmash"],function(t){return t}),function(){var t={}.hasOwnProperty;n("zvelonet/lib/cacheurl",["./lodash","./url"],function(e,n){var r;return r=function(){function r(t){if(this._cache=t,null==this._cache)throw new Error("Invalid cache object")}return r.prototype._rebuildCacheResult=function(t,n,r,i){var o,s,a,u,l;if(null!=r){if(null!=r.bulk)return this._rebuildBulkCacheResult(t,r,i);if(null!=(null!=(a=r.data)?a.c:void 0))return o=r.url().url,s={c:e.clone(r.data.c),m:t,u:n,b:r.data.b,fromCache:!0},(null!=i?null!=(u=i.data)?null!=(l=u.c)?l.length:void 0:void 0:void 0)&&(s.r=i.data.c[0]),s}},r.prototype._rebuildBulkCacheResult=function(n,r,i){var o,s,a,u,l,c;u={k:!0,m:n,hit:[],miss:r.miss},c=r.hit;for(l in c)t.call(c,l)&&(a=c[l],null==i||(s=e.find(i.hit,function(t,e){return l===e}),null!=s)?(o=this._rebuildCacheResult(n,l,a,s),null==o&&u.repMiss.push(l),delete o.m,u.hit.push(o)):u.repMiss.push(l));return u},r.prototype._parseCacheBase=function(t){var e,r,i,o;return r=t.b,e=!0,"."===(null!=r?r[0]:void 0)&&(e=!1,r=r.slice(1)),o=n.factory(r),i=n.factory(t.u),{url:o,authoritative:e,queried:i,cacheQueriedUrl:!e&&!o.equals(i)}},r.prototype._saveOne=function(t){var n,r,i,o;return r=t.m,(null!=t?null!=(o=t.c)?o.length:void 0:void 0)?(n=this._parseCacheBase(t),i=this._cache.set(r,n.url,{c:e.clone(t.c),b:t.b},n.authoritative),n.cacheQueriedUrl&&this._cache.set(r,n.queried,{c:e.clone(t.c),b:t.b},!1),null!=t.r&&(t=e.clone(t),t.m="reputation",t.c=[t.r],delete t.r,this._saveOne(t)),i):!1},r.prototype.save=function(t){var n,r,i,o,s,a,u;if(null!=t.k){for(o=!1,n=t.m,u=t.k,s=0,a=u.length;a>s;s++)r=u[s],r.fromCache||(o=!0,i=e.clone(r),i.m=n,this._saveOne(i));if(o)return this._cache.write()}else if(!t.fromCache){if(t.fromCache)return;return this._saveOne(t),this._cache.write()}},r.prototype.lookup=function(t,e){var n,r;return r=this._cache.get(e.m,t),null==r||e.r&&(n=this._cache.get("reputation",t),null==n)?void 0:this._rebuildCacheResult(e.m,t,r,n)},r}()})}.call(this),function(){var t,e={}.hasOwnProperty;t=function(t,e,n){return t[n]=t[e],delete t[e]},n("zvelonet/lib/znajax",["when","hashmash","./lodash","./ajax","./url","./cacheurl"],function(n,r,i,o,s,a){var u;return u=function(){function u(t,e,n){var r;this.zn=e,this._cache=n;try{this._setup(),this.configure(t),this.execute()}catch(i){r=i,this.reject(r.message)}}return u.pending={},u.prototype._setup=function(){var t;return t=n.defer(),this._resolver=t.resolver,this.complete=t.promise},u.prototype.configure=function(t){switch(typeof t){case"string":this._url=t;break;case"object":this.url=t.url,this.onHashMash=t.onHashMash,this.onAjax=t.onAjax,this.mapping=t.mapping,this.reputation=t.reputation,this.categoryIds=t.categoryIds,this.sync=t.sync,null!=this.url&&(this._url=this.url,delete this.url)}if(null!=this.zn.timeout&&(this.timeout=this.zn.timeout),"string"==typeof this._url){if(!this._url.length||!s.factory(this._url))throw new Error("invalid url: "+this._url)}else{if(!Array.isArray(this._url))throw new Error("invalid url: "+this._url);if(!this._url.length)throw new Error("invalid url: "+this._url);this._url=i.uniq(this._url),1===this._url.length&&(this._url=this._url[0])}return null!=this.data?this.data:this.data={}},u.prototype._checkCache=function(){var t;return this._cache&&null!=this.zn.cache?(this._cacheUrl=new a(this.zn.cache),t=this._cacheUrl.lookup(this._url,this.data),null==t?!1:Array.isArray(this._url)?t.miss.length?(t.hit.length&&(this._cacheHit=t.hit),this._url=t.miss,!1):(this._done({k:t.hit,m:this.data.m,s:!0}),!0):(this._done(t),!0)):!1},u.checkPending=function(t){var e;if("string"==typeof t._url)return e=u.pending[t._url],(null!=e?e.m:void 0)===t.mapping&&(null!=e?e.r:void 0)===t.reputation&&i.isEqual(null!=e?e.c:void 0,t.categoryIds)?e.p:(null==e&&(u.pending[t._url]={m:t.mapping,r:t.reputation,c:t.categoryIds,p:t.complete},t.complete.ensure(function(){return delete u.pending[t._url]})),void 0)},u.prototype.execute=function(){var t,e,n;if(!this._checkCache()){if(n=u.checkPending(this),null!=n)return this.complete=n;try{if(null!=this.zn.serial){if(!this.zn["dia.key"])throw new Error("missing dia.key");return this._ready()}if(Array.isArray(this._url))throw new Error("bulk lookup not allowed for hashmash");return null!=this.onHashMash&&this.onHashMash(),e=new r(this.zn.hashMashBits,this.zn.hashMashWorker),e.generate(encodeURIComponent(this._url)).then(this._ready.bind(this)).otherwise(this.reject.bind(this))}catch(i){return t=i,this.reject(t.message)}}},u.prototype._ready=function(t){if(this._genUrl(),this._genFormat(),null!=this.zn.serial)this.data.u=this._url;else{if(null==t)throw new Error("Unknown error");this.data.h=t}return this.zn.ready.then(this._doAjax.bind(this)).otherwise(this.reject.bind(this))},u.prototype._genFormat=function(){return this.dataType=this.zn.forceXHR?"json":"jsonp"},u.prototype._genUrl=function(){var t;if(t=s.hostUrl(this.zn.znhost),null==t)throw new Error("Invalid zveloNET host: "+this.zn.znhost);return this.url=""+t+this.ZN_PATH,null!=this.zn.serial?this.url+="/"+this.zn["dia.key"]+"/"+this.zn.serial:void 0},u.prototype._doAjax=function(){return null!=this.onAjax&&this.onAjax(),o(this).then(this._done.bind(this)).otherwise(this.reject.bind(this))},u.RENAMES={k:"bulk",u:"url",c:"categories",b:"cacheBase",m:"mapping",r:"reputationId"},u.rename=function(n){var r,i,o,s;o=u.RENAMES,s=[];for(r in o)e.call(o,r)&&(i=o[r],null!=n[r]&&s.push(t(n,r,i)));return s},u.decodeCategoryIds=function(t,e){var n,r,i,o,s,a,l,c,h,f,p,d;if(null==e)return t;if(null!=t.k){for(n=[],h=t.k,s=0,l=h.length;l>s;s++)r=h[s],n.push(u.decodeCategoryIds(r,e));return t.k=n,t}if(null!=t.c){for(o={},f=t.c,a=0,c=f.length;c>a;a++)i=f[a],o[i]=null!=(p=e[i])?p.name:void 0;t.c=o}return null!=t.r&&(t.reputation=null!=(d=e[t.r])?d.name:void 0),t},u.prototype._done=function(t,e,n){var r,o,s,a,l;if(!((null!=t?t.s:void 0)||(null!=t?t.fromCache:void 0)))return this.reject(n,e,t.m);if(delete t.s,null!=this._cacheUrl&&this._cacheUrl.save(t),null!=this._cacheHit&&(null!=t.k?t.k=i.union(this._cacheHit,t.k):(r=t.m,delete t.m,this._cacheHit.push(t),t={k:this._cacheHit,m:r})),u.decodeCategoryIds(t,this.zn["categories.txt"]),null!=t.k)for(l=t.k,s=0,a=l.length;a>s;s++)o=l[s],u.rename(o);return u.rename(t),this.resolve(t)},u.prototype.resolve=function(t){return this._resolver.resolve(t,this)},u.prototype.reject=function(t,e,n){var r,i;return null!=(null!=t?t.status:void 0)&&(r=t.status),i='Error with url: "'+this._url+'"',null!=n&&(i+=": "+n),null!=r&&(i+=" (code: "+r+")"),null!=t&&(i+=", "+t),this._resolver.reject(i,r)},u}()})}.call(this),function(){var t,e={}.hasOwnProperty,r=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};t=!0,n("zvelonet/lib/lookup",["./znajax"],function(e){var n;return n=function(e){function n(e,r){n.__super__.constructor.call(this,e,r,t)}return r(n,e),n.prototype.ZN_PATH="l",n.prototype._validateMapping=function(){var t;if(null==this.mapping&&(this.mapping=this.zn.defaultMapping),-1===(null!=(t=this.zn)?t.mappings.indexOf(this.mapping):void 0))throw new Error("Invalid mapping: "+this.mapping);return this.mapping},n.prototype.configure=function(t){return n.__super__.configure.call(this,t),this.data.m=this._validateMapping(),this.reputation?this.data.r=!0:void 0},n}(e)})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};n("zvelonet/lib/report",["./znajax"],function(t){var n;return n=function(t){function n(t,e){n.__super__.constructor.call(this,t,e)}return e(n,t),n.prototype.ZN_PATH="r",n.prototype.configure=function(t){if(n.__super__.configure.call(this,t),"string"!=typeof this._url)throw new Error("invalid url: "+this._url);if(!Array.isArray(this.categoryIds)||!this.categoryIds.length)throw new Error("invalid category ids => "+this.categoryIds);return this.data.c=this.categoryIds},n}(t)})}.call(this),function(){var t={}.hasOwnProperty;n("zvelonet/lib/zvelonet",["when","./semver","./log","./storage","./cache","./url","./dlfile","./lookup","./report"],function(e,n,r,i,o,s,a,u,l){var c;return c=function(){function s(t){var e;try{this._setup(),this._configure(t),this._init()}catch(n){e=n,this._reject(e.message)}}return s.VERSION="3.0.0",s.prototype._setup=function(){var t;return t=e.defer(),this._resolver=t.resolver,this.ready=t.promise},s.prototype._configure=function(t){return"object"==typeof t&&(this.namespace=t.namespace,this.znhost=t.znhost,this.dlhost=t.dlhost,this.fileExpireDuration=t.fileExpireDuration,this.defaultMapping=t.defaultMapping,this.timeout=t.timeout,this.forceXHR=t.forceXHR,this.useCache=t.useCache,this.sync=t.sync,this.hashMashBits=t.hashMashBits,this.hashMashWorker=t.hashMashWorker,this.username=t.username,this.password=t.password,this.serial=t.serial),null==this.dlhost&&delete this.dlhost,null==this.fileExpireDuration&&delete this.fileExpireDuration,null==this.namespace&&(this.namespace="zvelo.net"),null==this.znhost&&(this.znhost="https://query.zvelo.com"),null==this.defaultMapping&&(this.defaultMapping="zvelodb-v3"),null==this.timeout&&(this.timeout=5e3),null==this.forceXHR&&(this.forceXHR=!1),null==this.useCache&&(this.useCache=!0),null==this.sync&&(this.sync=!1),null==this.hashMashBits&&(this.hashMashBits=19),this.version=s.VERSION,this.useCache?this.cache=new o(this.namespace):delete this.cache
},s.prototype._read=function(t,e){return i.read(t,e,this.namespace)},s.prototype._write=function(t,e){return i.write(t,e,this.namespace)},s.prototype._delete=function(t){return i["delete"](t,this.namespace)},s.prototype._init=function(){return this._updateVersion(),e.all(this._loadFiles()).then(this._resolve.bind(this)).otherwise(this._reject.bind(this))},s.prototype._resolve=function(){return r("zvelo.net ready"),this._resolver.resolve(this)},s.prototype._reject=function(t){return r("zvelo.net could not be initialized",t),this._resolver.reject()},s.prototype._updateVersion=function(){var t,e;if(t=this._read("VERSION"),null!=t)switch(e=n.compare(t,s.VERSION),!1){case 0!==e:return r("welcome back to zvelo.net! you haven't changed a bit!"),!1;case!(e>0):return r("You have been cheating on me with another zvelo.net!I don't know what to do with myself!"),!1;case!(0>e):r("welcome back to zvelo.net! It looks like we have some catching up to do...")}return this._write("VERSION",s.VERSION),this.clearCache(),r("now that you have been reacquainted with zvelo.net, lets get to work..."),!0},s.prototype._loadFile=function(t){var e;return null==this._files&&(this._files={}),e=new a(t,this),this._files[t]=e,e.ready.then(function(e){return this[t]=e.value}.bind(this)),e.ready},s.prototype._loadFiles=function(){var t;return t=[this._loadFile("mappings"),this._loadFile("categories.txt")],null!=this.serial&&t.push(this._loadFile("dia.key")),t},s.prototype.clearFiles=function(e){var n;return n=function(){var e,n,r;r=this._files;for(n in r)t.call(r,n)&&(e=r[n],e["delete"](),delete this._files[n],delete this[n]);return delete this._files},this.ready.ensure(n.bind(this)),null!=e&&e?void 0:this.reinit()},s.prototype.reinit=function(){var t;return t=this.ready,this._setup(),t.then(this._init.bind(this)),this.ready},s.prototype.clearCache=function(){var t;return null!=(t=this.cache)?t.clear():void 0},s.prototype.expireCache=function(){var t;return null!=(t=this.cache)?t.expire():void 0},s.prototype.lookup=function(t){return new u(t,this).complete},s.prototype.report=function(t){return new l(t,this).complete},s.categorySort=function(t){var e,n,r;n=[];for(e in t)r=t[e],n.push(r);return n.sort(function(t,e){return t.name===e.name?0:t.name<e.name?-1:1}),n},s.prototype.setSerial=function(t){return this.serial=t,this.reinit()},s}()})}.call(this),function(){n("zvelonet/zvelonet",["./lib/zvelonet"],function(t){return t})}(),n("zvelonet",["zvelonet/zvelonet"],function(t){return t}),/*

Copyright (C) 2011 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/
function(t){var e={};e.VERSION="1.0.0",e.COMPILER_REVISION=4,e.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},e.helpers={},e.partials={};var r=Object.prototype.toString,i="[object Function]",o="[object Object]";e.registerHelper=function(t,n,i){if(r.call(t)===o){if(i||n)throw new e.Exception("Arg not supported with multiple helpers");e.Utils.extend(this.helpers,t)}else i&&(n.not=i),this.helpers[t]=n},e.registerPartial=function(t,n){r.call(t)===o?e.Utils.extend(this.partials,t):this.partials[t]=n},e.registerHelper("helperMissing",function(e){if(2===arguments.length)return t;throw new Error("Missing helper: '"+e+"'")}),e.registerHelper("blockHelperMissing",function(t,n){var o=n.inverse||function(){},s=n.fn,a=r.call(t);return a===i&&(t=t.call(this)),t===!0?s(this):t===!1||null==t?o(this):"[object Array]"===a?t.length>0?e.helpers.each(t,n):o(this):s(t)}),e.K=function(){},e.createFrame=Object.create||function(t){e.K.prototype=t;var n=new e.K;return e.K.prototype=null,n},e.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(t,n){if(e.logger.level<=t){var r=e.logger.methodMap[t];"undefined"!=typeof console&&console[r]&&console[r].call(console,n)}}},e.log=function(t,n){e.logger.log(t,n)},e.registerHelper("each",function(t,n){var o,s=n.fn,a=n.inverse,u=0,l="",c=r.call(t);if(c===i&&(t=t.call(this)),n.data&&(o=e.createFrame(n.data)),t&&"object"==typeof t)if(t instanceof Array)for(var h=t.length;h>u;u++)o&&(o.index=u),l+=s(t[u],{data:o});else for(var f in t)t.hasOwnProperty(f)&&(o&&(o.key=f),l+=s(t[f],{data:o}),u++);return 0===u&&(l=a(this)),l}),e.registerHelper("if",function(t,n){var o=r.call(t);return o===i&&(t=t.call(this)),!t||e.Utils.isEmpty(t)?n.inverse(this):n.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn})}),e.registerHelper("with",function(t,n){var o=r.call(t);return o===i&&(t=t.call(this)),e.Utils.isEmpty(t)?void 0:n.fn(t)}),e.registerHelper("log",function(t,n){var r=n.data&&null!=n.data.level?parseInt(n.data.level,10):1;e.log(r,t)});var s=["description","fileName","lineNumber","message","name","number","stack"];e.Exception=function(){for(var t=Error.prototype.constructor.apply(this,arguments),e=0;e<s.length;e++)this[s[e]]=t[s[e]]},e.Exception.prototype=new Error,e.SafeString=function(t){this.string=t},e.SafeString.prototype.toString=function(){return this.string.toString()};var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},u=/[&<>"'`]/g,l=/[&<>"'`]/,c=function(t){return a[t]||"&amp;"};e.Utils={extend:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},escapeExpression:function(t){return t instanceof e.SafeString?t.toString():null==t||t===!1?"":(t=t.toString(),l.test(t)?t.replace(u,c):t)},isEmpty:function(t){return t||0===t?"[object Array]"===r.call(t)&&0===t.length?!0:!1:!0}},e.VM={template:function(t){var n={escapeExpression:e.Utils.escapeExpression,invokePartial:e.VM.invokePartial,programs:[],program:function(t,n,r){var i=this.programs[t];return r?i=e.VM.program(t,n,r):i||(i=this.programs[t]=e.VM.program(t,n)),i},merge:function(t,n){var r=t||n;return t&&n&&(r={},e.Utils.extend(r,n),e.Utils.extend(r,t)),r},programWithDepth:e.VM.programWithDepth,noop:e.VM.noop,compilerInfo:null};return function(r,i){i=i||{};var o=t.call(n,e,r,i.helpers,i.partials,i.data),s=n.compilerInfo||[],a=s[0]||1,u=e.COMPILER_REVISION;if(a!==u){if(u>a){var l=e.REVISION_CHANGES[u],c=e.REVISION_CHANGES[a];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+l+") or downgrade your runtime to an older version ("+c+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+s[1]+")."}return o}},programWithDepth:function(t,e,n){var r=Array.prototype.slice.call(arguments,3),i=function(t,i){return i=i||{},e.apply(this,[t,i.data||n].concat(r))};return i.program=t,i.depth=r.length,i},program:function(t,e,n){var r=function(t,r){return r=r||{},e(t,r.data||n)};return r.program=t,r.depth=0,r},noop:function(){return""},invokePartial:function(n,r,i,o,s,a){var u={helpers:o,partials:s,data:a};if(n===t)throw new e.Exception("The partial "+r+" could not be found");if(n instanceof Function)return n(i,u);if(e.compile)return s[r]=e.compile(n,{data:a!==t}),s[r](i,u);throw new e.Exception("The partial "+r+" could not be compiled when running in runtime-only mode")}},e.template=e.VM.template,"object"==typeof module&&module.exports?module.exports=e:"function"==typeof n&&n.amd?n("handlebars",[],function(){return e}):this.Handlebars=e}.call(this),n("templates",["handlebars"],function(t){return this.JST=this.JST||{},this.JST.lookup=t.template(function(t,e,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{},'<form>\n  <input type="text"\n         class="input-block-level"\n         placeholder="http://zvelo.com"\n         autocomplete="off"\n         spellcheck="false">\n  <button type="submit" class="btn btn-large btn-primary">Lookup</button>\n</form>\n'}),this.JST.modal=t.template(function(t,e,n,r,i){function o(t,e){var r,i="";return i+=" ",(r=n["class"])?r=r.call(t,{hash:{},data:e}):(r=t["class"],r=typeof r===c?r.apply(t):r),i+=h(r)}function s(){return'\n    <button type="button" class="close"></button>\n    '}function a(t,e){var r,i="";return i+='\n    <button class="btn btn-primary">',(r=n.btn)?r=r.call(t,{hash:{},data:e}):(r=t.btn,r=typeof r===c?r.apply(t):r),i+=h(r)+"</button>\n    "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{};var u,l="",c="function",h=this.escapeExpression,f=this;return l+='<div class="modal',u=n["if"].call(e,e["class"],{hash:{},inverse:f.noop,fn:f.program(1,o,i),data:i}),(u||0===u)&&(l+=u),l+='">\n  <div class="modal-header">\n    ',u=n["if"].call(e,e.close,{hash:{},inverse:f.noop,fn:f.program(3,s,i),data:i}),(u||0===u)&&(l+=u),l+="\n\n    <h3>",(u=n.header)?u=u.call(e,{hash:{},data:i}):(u=e.header,u=typeof u===c?u.apply(e):u),l+=h(u)+'</h3>\n  </div>\n  <div class="modal-body">\n    <p>',(u=n.body)?u=u.call(e,{hash:{},data:i}):(u=e.body,u=typeof u===c?u.apply(e):u),(u||0===u)&&(l+=u),l+='</p>\n  </div>\n  <div class="modal-footer">\n    ',u=n["if"].call(e,e.btn,{hash:{},inverse:f.noop,fn:f.program(5,a,i),data:i}),(u||0===u)&&(l+=u),l+="\n  </div>\n</div>\n"}),this.JST.report=t.template(function(t,e,n,r,i){function o(t){var e,n="";return n+='\n      <option value="'+l((e=t.id,typeof e===u?e.apply(t):e))+'">'+l((e=t.name,typeof e===u?e.apply(t):e))+"</option>\n      "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{};var s,a="",u="function",l=this.escapeExpression,c=this;return a+='<form>\n  <p class="lead url">',(s=n.url)?s=s.call(e,{hash:{},data:i}):(s=e.url,s=typeof s===u?s.apply(e):s),a+=l(s)+'</p>\n\n  <div class="categories">\n    <select>\n      <option value="">-- Suggest a Category --</option>\n      ',s=n.each.call(e,e.categories,{hash:{},inverse:c.noop,fn:c.program(1,o,i),data:i}),(s||0===s)&&(a+=s),a+='\n    </select>\n  </div>\n\n  <div class="controls">\n    <button type="submit" class="btn btn-danger report">Report Miscategorization</button>\n    <button type="button" class="btn btn-primary lookup">Return to Lookup</button>\n  </div>\n</form>\n'}),this.JST.result=t.template(function(t,e,n,r,i){function o(t){var e="";return e+='\n  <span class="span4 btn btn-large btn-inverse category" disabled>'+l(typeof t===u?t.apply(t):t)+"</span>\n  "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{};var s,a="",u="function",l=this.escapeExpression,c=this;return a+='<div class="row-fluid">\n  <div class="span10">\n    <p class="lead url" title="',(s=n.url)?s=s.call(e,{hash:{},data:i}):(s=e.url,s=typeof s===u?s.apply(e):s),a+=l(s)+'">',(s=n.url)?s=s.call(e,{hash:{},data:i}):(s=e.url,s=typeof s===u?s.apply(e):s),a+=l(s)+'</p>\n  </div>\n\n  <div class="span2 reputation ',(s=n.reputationId)?s=s.call(e,{hash:{},data:i}):(s=e.reputationId,s=typeof s===u?s.apply(e):s),a+=l(s)+'">\n    <p>',(s=n.reputation)?s=s.call(e,{hash:{},data:i}):(s=e.reputation,s=typeof s===u?s.apply(e):s),a+=l(s)+'</p>\n  </div>\n</div>\n\n<div class="categories row-fluid">\n  ',s=n.each.call(e,e.categories,{hash:{},inverse:c.noop,fn:c.program(1,o,i),data:i}),(s||0===s)&&(a+=s),a+='\n</div>\n\n<div class="controls row-fluid">\n  <button class="span3 btn btn-large btn-primary lookup" title="Lookup another URL">Lookup Another</button>\n  <button class="span3 btn btn-large btn-warning report" title="Report this URL as miscategorized">Miscategorized?</button>\n</div>\n'}),this.JST.uncategorized=t.template(function(t,e,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{};var o,s="",a="function",u=this.escapeExpression;return s+='<p class="lead url">',(o=n.url)?o=o.call(e,{hash:{},data:i}):(o=e.url,o=typeof o===a?o.apply(e):o),s+=u(o)+'</p>\n\n<p class="uncategorized">\nThis URL has not yet been categorized. It has been submitted for classification.\n</p>\n\n<div class="controls">\n  <button class="btn btn-primary lookup">Lookup Another</button>\n</div>\n'}),this.JST}),function(){var t,e,r,i;e=function(t,e){return(" "+t.className+" ").indexOf(" "+e+" ")>-1},t=function(t,e){return t.className+=" "+e},r=function(t,e){var n;return n=new RegExp("(?:^|\\s)"+e+"(?!\\S)","g"),t.className=t.className.replace(n,"")},i=function(){var t,e,n;t=document.createElement("zveloFakeElement"),n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(e in n)if(null!=t.style[e])return n[e]}(),n("modal",["templates"],function(e){var n;return n=function(){function n(r){this.ctx=r,this._configure(),this.el=n._createEl(e.modal(this.ctx)),t(this.el,"fade")}return n.hide=function(t){return null==n.shown?(null!=t&&t(),!1):(n.shown.hide(t),!0)},n.prototype._configure=function(){return null!=this.ctx?this.ctx:this.ctx={}},n._createEl=function(t){var e;return e=document.createElement("div"),e.innerHTML=t,e.firstChild},n._transitionEnd=function(t,e){var n;return null==i?(null!=e&&e(),void 0):(n=function(){return t.removeEventListener(i,n,!0),e()},t.addEventListener(i,n,!0))},n.prototype._backdrop=function(e){var i;return i=this,this.isShown?(this.backdrop=n._createEl('<div class="modal-backdrop"/>'),t(this.backdrop,"fade"),document.body.appendChild(this.backdrop),this.backdrop.addEventListener("click",function(){return i.ctx.close?i.hide():void 0}),this.backdrop.offsetWidth,t(this.backdrop,"in"),n._transitionEnd(this.backdrop,e)):this.isShown||null==this.backdrop?void 0:(r(this.backdrop,"in"),n._transitionEnd(this.backdrop,e))},n.prototype.setHeader=function(t){return this.ctx.header=t,this.el.innerHTML=e.modal(this.ctx),this},n.prototype.setBody=function(t){return this.ctx.body=t,this.el.innerHTML=e.modal(this.ctx),this},n.prototype.show=function(){return this.isShown?this:(n.hide(this._show.bind(this)),this)},n.prototype._show=function(){var e;if(!this.isShown&&null==n.shown)return n.shown=this,this.isShown=!0,e=this,this.ctx.close&&(this.onKeyUp=function(t){return 27===t.which?e.hide():void 0},document.body.addEventListener("keyup",this.onKeyUp,!0)),document.body.appendChild(this.el),this._backdrop(function(){var n,r;return e.el.style.display="block",e.el.offsetWidth,t(e.el,"in"),e.ctx.btn&&(n=e.el.getElementsByClassName("btn btn-primary")[0],n.addEventListener("click",e.hide.bind(e),!0)),e.ctx.close?(r=e.el.getElementsByClassName("close")[0],r.addEventListener("click",e.hide.bind(e),!0)):void 0})},n.prototype.hide=function(t){var e;return this.isShown&&n.shown===this?(delete n.shown,this.isShown=!1,e=this,r(this.el,"in"),n._transitionEnd(this.el,function(){return e._remove(),null!=i?e._hideWithTransition(t):e._hideModal(t)}),this):this},n.prototype._hideWithTransition=function(t){var e,r;return e=this,r=setTimeout(function(){return e._hideModal(t)},500),n._transitionEnd(this.el,function(){return clearTimeout(r),e._hideModal(t)}),this},n.prototype._hideModal=function(t){var e;return this.el.style.display="none",e=this,this._backdrop(function(){return e._removeBackdrop(t)}),this},n.prototype._removeBackdrop=function(t){return null!=this.backdrop&&document.body.removeChild(this.backdrop),delete this.backdrop,null!=this.onKeyUp&&document.body.removeEventListener("keyup",this.onKeyUp,!0),null!=this.ctx.onClose&&this.ctx.onClose(this),"function"==typeof t?t(this):void 0},n.prototype._remove=function(){return document.body.removeChild(this.el),r(this.el,"in")},n.prototype.toggle=function(){return this.isShown?this.hide():this.show()},n}()})}.call(this),function(){n("example",["domReady","sizzle","zvelonet","modal","templates"],function(t,e,n,r,i){var o,s;return s=function(t){return e("#zvelonet "+(t||""))[0]},o=function(){function e(){this.zn=new n({znhost:"https://query.zvelo.com:3333",username:"zvelo.com",password:"7j25jx7XVAe",hashMashWorker:"./js/vendor/hashmash/worker.min.js"}),t(this.onDomReady.bind(this))}return e.prototype.onDomReady=function(){var t,e,n;return this.showLoadingModal(),n=this.zn.ready.then(this.znReady.bind(this)).then(this.show.bind(this,"lookup")),t=window.location.hash.slice(1),e=t?n.then(this.doLookup.bind(this,t)):n.then(r.hide),e.otherwise(this.showErrorModal.bind(this))},e.prototype.znReady=function(){var t;return t=n.categorySort(this.zn["categories.txt"]),this.categories=t.filter(function(t){return 0===t.name.indexOf("Custom User Type ")?!1:!0})},e.prototype.show=function(t,e){var n;switch(this.ctx=e||{},s().innerHTML=i[t](this.ctx),n=s(".btn.lookup"),null!=n&&n.addEventListener("click",this.show.bind(this,"lookup")),t){case"lookup":return window.location.hash="",s("input").focus(),s("form").addEventListener("submit",this.submitLookup.bind(this));case"result":return n.focus(),s(".btn.report").addEventListener("click",this.show.bind(this,"report",{url:this.ctx.url,categories:this.categories}));case"report":return s("form").addEventListener("submit",this.submitReport.bind(this)),s("select").focus();case"uncategorized":return n.focus()}},e.prototype.showErrorModal=function(){var t,e,n,i,o,s;for(o=0,s=arguments.length;s>o;o++)t=arguments[o],"function"==typeof t?e=t:n=t;return"undefined"!=typeof console&&null!==console&&console.error(n),i=function(){return this.hide(),null!=e?e():void 0},new r({header:"Error!",btn:"Dismiss",body:n,onClose:i}).show()},e.prototype.showWarning=function(t,e){return new r({header:"Warning",body:t,btn:"OK",onClose:e}).show()},e.prototype.showLoadingModal=function(){return new r({header:"Loading...",body:"Initializing zveloNET..."}).show()},e.prototype.onHashMash=function(){var t;return null==this.authModal&&(this.authModal=new r({"class":"authorizing",header:"Authorizing..."})),t='<img src="./img/spinner-calculating.gif"><br>\nVerifying user credentials...',this.authModal.setBody(t).show()},e.prototype.onAjax=function(){var t,e;if(null!=(e=this.authModal)?e.isShown:void 0)return t='<img src="./img/spinner-sending.gif"><br>\nQuerying Server...',this.authModal.setBody(t)},e.prototype.doLookup=function(t){return this.zn.lookup({url:t,reputation:!0,onHashMash:this.onHashMash.bind(this),onAjax:this.onAjax.bind(this)}).then(this.onLookupResponse.bind(this)).otherwise(this.showErrorModal.bind(this,this.show.bind(this,"lookup")))},e.prototype.doReport=function(t,e){return this.zn.report({url:t,categoryIds:[e],onHashMash:this.onHashMash.bind(this,"show"),onAjax:this.onAjax.bind(this)}).then(this.onReportResponse.bind(this)).otherwise(this.showErrorModal.bind(this))},e.prototype.submitLookup=function(t){var e;return t.preventDefault(),document.activeElement.blur(),e=s("input").value,(null!=e?e.length:void 0)?this.doLookup(e):void 0},e.prototype.submitReport=function(t){var e,n,r;return t.preventDefault(),document.activeElement.blur(),e=parseInt(null!=(r=s("select :selected"))?r.value:void 0,10),isNaN(e)?this.showWarning("Please choose a category"):(n=s(".url").textContent,this.doReport(n,e))},e.prototype.onLookupResponse=function(t){return window.location.hash="#"+t.url,r.hide(),null!=(null!=t?t.categories:void 0)&&Object.keys(t.categories).length?this.show("result",t):this.show("uncategorized",t)},e.prototype.onReportResponse=function(){return new r({header:"Thank you",body:"We have received your request.",btn:"Close",close:!0,onClose:this.show.bind(this,"lookup")}).show()},e}(),new o})}.call(this),e(["poly/function","poly/json","poly/array","example"])}();
//# sourceMappingURL=example.min.js.map